<!doctype html><html lang=es class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Curso end-to-end para construir un portafolio ML/MLOps profesional desde cero"><meta name=author content=DuqueOM><link href=https://duqueom.github.io/Guia_MLOps/docs/13_DOCKER/ rel=canonical><link href=../12_CI_CD/ rel=prev><link href=../14_FASTAPI/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>13 â€” Docker - GuÃ­a MLOps â€” Portfolio Edition v2</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=deep-purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#13-docker-avanzado-para-ml class=md-skip> Saltar a contenido </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Cabecera> <a href=../.. title="GuÃ­a MLOps â€” Portfolio Edition v2" class="md-header__button md-logo" aria-label="GuÃ­a MLOps â€” Portfolio Edition v2" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> GuÃ­a MLOps â€” Portfolio Edition v2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 13 â€” Docker </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=deep-purple aria-label="Cambiar a modo oscuro" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=deep-purple aria-label="Cambiar a modo claro" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Cambiar a modo claro" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=BÃºsqueda placeholder=BÃºsqueda autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Buscar> <button type=reset class="md-search__icon md-icon" title=Limpiar aria-label=Limpiar tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Inicializando bÃºsqueda </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/DuqueOM/Guia_MLOps title="Ir al repositorio" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> Guia_MLOps </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=PestaÃ±as data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../ class=md-tabs__link> Inicio </a> </li> <li class=md-tabs__item> <a href=../00_INDICE/ class=md-tabs__link> Ãndice Principal </a> </li> <li class=md-tabs__item> <a href=../SYLLABUS/ class=md-tabs__link> Syllabus </a> </li> <li class=md-tabs__item> <a href=../MAPA_PORTAFOLIO_1TO1/ class=md-tabs__link> Mapa 1:1 Portafolio </a> </li> <li class=md-tabs__item> <a href=../PLAN_ESTUDIOS/ class=md-tabs__link> Plan de Estudios </a> </li> <li class=md-tabs__item> <a href=../01_PYTHON_MODERNO/ class=md-tabs__link> Fase 1 - Fundamentos </a> </li> <li class=md-tabs__item> <a href=../07_SKLEARN_PIPELINES/ class=md-tabs__link> Fase 2 - ML Engineering </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../11_TESTING_ML/ class=md-tabs__link> Fase 3 - MLOps Core </a> </li> <li class=md-tabs__item> <a href=../17_DESPLIEGUE/ class=md-tabs__link> Fase 4 - ProducciÃ³n </a> </li> <li class=md-tabs__item> <a href=../19_DOCUMENTACION/ class=md-tabs__link> Fase 5 - Senior/Staff </a> </li> <li class=md-tabs__item> <a href=../apoyo/ class=md-tabs__link> Material de Apoyo </a> </li> <li class=md-tabs__item> <a href=../study_tools/ class=md-tabs__link> Herramientas de Estudio </a> </li> <li class=md-tabs__item> <a href=../../exams/EXAM_01_SETUP/ class=md-tabs__link> ExÃ¡menes </a> </li> <li class=md-tabs__item> <a href=../SIMULACRO_ENTREVISTA_JUNIOR/ class=md-tabs__link> Simulacros de Entrevista </a> </li> <li class=md-tabs__item> <a href=../../notebooks/labs/LAB_01_DOCKER_DEBUG/ class=md-tabs__link> Laboratorios </a> </li> <li class=md-tabs__item> <a href=../templates/ class=md-tabs__link> Plantillas </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=NavegaciÃ³n data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="GuÃ­a MLOps â€” Portfolio Edition v2" class="md-nav__button md-logo" aria-label="GuÃ­a MLOps â€” Portfolio Edition v2" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> GuÃ­a MLOps â€” Portfolio Edition v2 </label> <div class=md-nav__source> <a href=https://github.com/DuqueOM/Guia_MLOps title="Ir al repositorio" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> Guia_MLOps </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Inicio </span> </a> </li> <li class=md-nav__item> <a href=../00_INDICE/ class=md-nav__link> <span class=md-ellipsis> Ãndice Principal </span> </a> </li> <li class=md-nav__item> <a href=../SYLLABUS/ class=md-nav__link> <span class=md-ellipsis> Syllabus </span> </a> </li> <li class=md-nav__item> <a href=../MAPA_PORTAFOLIO_1TO1/ class=md-nav__link> <span class=md-ellipsis> Mapa 1:1 Portafolio </span> </a> </li> <li class=md-nav__item> <a href=../PLAN_ESTUDIOS/ class=md-nav__link> <span class=md-ellipsis> Plan de Estudios </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Fase 1 - Fundamentos </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Fase 1 - Fundamentos </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01_PYTHON_MODERNO/ class=md-nav__link> <span class=md-ellipsis> 01 â€” Python Moderno </span> </a> </li> <li class=md-nav__item> <a href=../02_DISENO_SISTEMAS/ class=md-nav__link> <span class=md-ellipsis> 02 â€” DiseÃ±o de Sistemas </span> </a> </li> <li class=md-nav__item> <a href=../03_ESTRUCTURA_PROYECTO/ class=md-nav__link> <span class=md-ellipsis> 03 â€” Estructura de Proyecto </span> </a> </li> <li class=md-nav__item> <a href=../04_ENTORNOS/ class=md-nav__link> <span class=md-ellipsis> 04 â€” Entornos </span> </a> </li> <li class=md-nav__item> <a href=../05_GIT_PROFESIONAL/ class=md-nav__link> <span class=md-ellipsis> 05 â€” Git Profesional </span> </a> </li> <li class=md-nav__item> <a href=../06_VERSIONADO_DATOS/ class=md-nav__link> <span class=md-ellipsis> 06 â€” Versionado de Datos </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Fase 2 - ML Engineering </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Fase 2 - ML Engineering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../07_SKLEARN_PIPELINES/ class=md-nav__link> <span class=md-ellipsis> 07 â€” sklearn Pipelines </span> </a> </li> <li class=md-nav__item> <a href=../08_INGENIERIA_FEATURES/ class=md-nav__link> <span class=md-ellipsis> 08 â€” IngenierÃ­a de Features </span> </a> </li> <li class=md-nav__item> <a href=../09_TRAINING_PROFESIONAL/ class=md-nav__link> <span class=md-ellipsis> 09 â€” Training Profesional </span> </a> </li> <li class=md-nav__item> <a href=../10_EXPERIMENT_TRACKING/ class=md-nav__link> <span class=md-ellipsis> 10 â€” Experiment Tracking </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8 checked> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex> <span class=md-ellipsis> Fase 3 - MLOps Core </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=true> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Fase 3 - MLOps Core </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../11_TESTING_ML/ class=md-nav__link> <span class=md-ellipsis> 11 â€” Testing ML </span> </a> </li> <li class=md-nav__item> <a href=../12_CI_CD/ class=md-nav__link> <span class=md-ellipsis> 12 â€” CI/CD </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 13 â€” Docker </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 13 â€” Docker </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Tabla de contenidos </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#contenido class=md-nav__link> <span class=md-ellipsis> ğŸ“‹ Contenido </span> </a> <nav class=md-nav aria-label="ğŸ“‹ Contenido"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mapa-mental-de-conceptos-docker-para-ml class=md-nav__link> <span class=md-ellipsis> ğŸ§  Mapa Mental de Conceptos: Docker para ML </span> </a> </li> <li class=md-nav__item> <a href=#ejercicio-puente-dockerfile-minimo class=md-nav__link> <span class=md-ellipsis> ğŸ’» Ejercicio Puente: Dockerfile MÃ­nimo </span> </a> </li> <li class=md-nav__item> <a href=#ejercicio-puente-containerizacion class=md-nav__link> <span class=md-ellipsis> ğŸ’» Ejercicio Puente: ContainerizaciÃ³n </span> </a> </li> <li class=md-nav__item> <a href=#practica-del-portafolio-docker-en-bankchurn class=md-nav__link> <span class=md-ellipsis> ğŸ› ï¸ PrÃ¡ctica del Portafolio: Docker en BankChurn </span> </a> </li> <li class=md-nav__item> <a href=#checkpoint-de-conocimiento class=md-nav__link> <span class=md-ellipsis> âœ… Checkpoint de Conocimiento </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#131-dockerfile-basico-vs-optimizado class=md-nav__link> <span class=md-ellipsis> 13.1 Dockerfile BÃ¡sico vs Optimizado </span> </a> <nav class=md-nav aria-label="13.1 Dockerfile BÃ¡sico vs Optimizado"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nivel-1-basico-no-usar-en-produccion class=md-nav__link> <span class=md-ellipsis> âŒ Nivel 1: BÃ¡sico (No usar en producciÃ³n) </span> </a> </li> <li class=md-nav__item> <a href=#nivel-2-optimizado class=md-nav__link> <span class=md-ellipsis> âœ… Nivel 2: Optimizado </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#132-multi-stage-builds class=md-nav__link> <span class=md-ellipsis> 13.2 Multi-Stage Builds </span> </a> <nav class=md-nav aria-label="13.2 Multi-Stage Builds"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#el-concepto class=md-nav__link> <span class=md-ellipsis> El Concepto </span> </a> </li> <li class=md-nav__item> <a href=#implementacion class=md-nav__link> <span class=md-ellipsis> ImplementaciÃ³n </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#133-mejores-practicas class=md-nav__link> <span class=md-ellipsis> 13.3 Mejores PrÃ¡cticas </span> </a> <nav class=md-nav aria-label="13.3 Mejores PrÃ¡cticas"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dockerignore class=md-nav__link> <span class=md-ellipsis> .dockerignore </span> </a> </li> <li class=md-nav__item> <a href=#layer-caching class=md-nav__link> <span class=md-ellipsis> Layer Caching </span> </a> </li> <li class=md-nav__item> <a href=#security-non-root-user class=md-nav__link> <span class=md-ellipsis> Security: Non-Root User </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#134-dockerfile-real-del-portafolio class=md-nav__link> <span class=md-ellipsis> 13.4 Dockerfile Real del Portafolio </span> </a> <nav class=md-nav aria-label="13.4 Dockerfile Real del Portafolio"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bankchurn-predictordockerfile class=md-nav__link> <span class=md-ellipsis> BankChurn-Predictor/Dockerfile </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#135-docker-compose-para-ml class=md-nav__link> <span class=md-ellipsis> 13.5 Docker Compose para ML </span> </a> <nav class=md-nav aria-label="13.5 Docker Compose para ML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-composedemoyml-portafolio class=md-nav__link> <span class=md-ellipsis> docker-compose.demo.yml (Portafolio) </span> </a> </li> <li class=md-nav__item> <a href=#comandos-utiles class=md-nav__link> <span class=md-ellipsis> Comandos Ãštiles </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#136-docker-compose-avanzado-para-mlops-nuevo class=md-nav__link> <span class=md-ellipsis> 13.6 Docker Compose Avanzado para MLOps â­ NUEVO </span> </a> <nav class=md-nav aria-label="13.6 Docker Compose Avanzado para MLOps â­ NUEVO"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1361-profiles-servicios-opcionales class=md-nav__link> <span class=md-ellipsis> 13.6.1 Profiles: Servicios Opcionales </span> </a> </li> <li class=md-nav__item> <a href=#1362-healthchecks-avanzados-y-dependencies class=md-nav__link> <span class=md-ellipsis> 13.6.2 Healthchecks Avanzados y Dependencies </span> </a> </li> <li class=md-nav__item> <a href=#1363-networking-para-microservicios-ml class=md-nav__link> <span class=md-ellipsis> 13.6.3 Networking para Microservicios ML </span> </a> </li> <li class=md-nav__item> <a href=#1364-volumes-para-persistencia-y-desarrollo class=md-nav__link> <span class=md-ellipsis> 13.6.4 Volumes para Persistencia y Desarrollo </span> </a> </li> <li class=md-nav__item> <a href=#1365-variables-de-entorno-y-secrets class=md-nav__link> <span class=md-ellipsis> 13.6.5 Variables de Entorno y Secrets </span> </a> </li> <li class=md-nav__item> <a href=#1366-el-stack-completo-del-portafolio class=md-nav__link> <span class=md-ellipsis> 13.6.6 El Stack Completo del Portafolio </span> </a> </li> <li class=md-nav__item> <a href=#ejercicio-crear-tu-stack-docker-compose class=md-nav__link> <span class=md-ellipsis> ğŸ”§ Ejercicio: Crear Tu Stack Docker Compose </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#137-ingenieria-inversa-pedagogica-dockerfile-del-portafolio class=md-nav__link> <span class=md-ellipsis> 13.7 ğŸ”¬ IngenierÃ­a Inversa PedagÃ³gica: Dockerfile del Portafolio </span> </a> <nav class=md-nav aria-label="13.7 ğŸ”¬ IngenierÃ­a Inversa PedagÃ³gica: Dockerfile del Portafolio"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1371-el-por-que-arquitectonico class=md-nav__link> <span class=md-ellipsis> 13.7.1 ğŸ¯ El "Por QuÃ©" ArquitectÃ³nico </span> </a> </li> <li class=md-nav__item> <a href=#1372-anatomia-linea-por-linea-bankchurn-predictordockerfile class=md-nav__link> <span class=md-ellipsis> 13.7.2 ğŸ” AnatomÃ­a LÃ­nea por LÃ­nea: BankChurn-Predictor/Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=#1373-laboratorio-de-replicacion-escribe-el-dockerfile-tu-mismo class=md-nav__link> <span class=md-ellipsis> 13.7.3 ğŸ§ª Laboratorio de ReplicaciÃ³n: Escribe el Dockerfile TÃº Mismo </span> </a> </li> <li class=md-nav__item> <a href=#1374-troubleshooting-preventivo-los-5-errores-mas-comunes class=md-nav__link> <span class=md-ellipsis> 13.7.4 ğŸš¨ Troubleshooting Preventivo: Los 5 Errores MÃ¡s Comunes </span> </a> </li> <li class=md-nav__item> <a href=#1375-checklist-de-replicacion-completa class=md-nav__link> <span class=md-ellipsis> 13.7.5 ğŸ“‹ Checklist de ReplicaciÃ³n Completa </span> </a> </li> <li class=md-nav__item> <a href=#1376-anatomia-del-dockerignore-real-del-portafolio class=md-nav__link> <span class=md-ellipsis> 13.7.6 ğŸ“ AnatomÃ­a del .dockerignore Real del Portafolio </span> </a> </li> <li class=md-nav__item> <a href=#1377-conexion-docker-kubernetes-de-imagen-a-produccion class=md-nav__link> <span class=md-ellipsis> 13.7.7 ğŸ”— ConexiÃ³n Docker â†’ Kubernetes: De Imagen a ProducciÃ³n </span> </a> </li> <li class=md-nav__item> <a href=#1378-metricas-de-exito-como-saber-que-lo-hiciste-bien class=md-nav__link> <span class=md-ellipsis> 13.7.8 ğŸ“Š MÃ©tricas de Ã‰xito: Â¿CÃ³mo Saber que lo Hiciste Bien? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#errores-habituales-y-como-depurarlos-en-docker-para-ml class=md-nav__link> <span class=md-ellipsis> ğŸ§¨ Errores habituales y cÃ³mo depurarlos en Docker para ML </span> </a> <nav class=md-nav aria-label="ğŸ§¨ Errores habituales y cÃ³mo depurarlos en Docker para ML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-imagenes-demasiado-grandes class=md-nav__link> <span class=md-ellipsis> 1) ImÃ¡genes demasiado grandes </span> </a> </li> <li class=md-nav__item> <a href=#2-errores-de-permisos-al-correr-como-non-root class=md-nav__link> <span class=md-ellipsis> 2) Errores de permisos al correr como non-root </span> </a> </li> <li class=md-nav__item> <a href=#3-modelo-o-artefactos-no-encontrados-dentro-del-contenedor class=md-nav__link> <span class=md-ellipsis> 3) Modelo o artefactos no encontrados dentro del contenedor </span> </a> </li> <li class=md-nav__item> <a href=#4-contenedores-que-arrancan-pero-el-healthcheck-falla class=md-nav__link> <span class=md-ellipsis> 4) Contenedores que arrancan pero el healthcheck falla </span> </a> </li> <li class=md-nav__item> <a href=#5-patron-general-de-debugging-con-docker class=md-nav__link> <span class=md-ellipsis> 5) PatrÃ³n general de debugging con Docker </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#checkpoint class=md-nav__link> <span class=md-ellipsis> âœ… Checkpoint </span> </a> </li> <li class=md-nav__item> <a href=#consejos-profesionales class=md-nav__link> <span class=md-ellipsis> ğŸ’¼ Consejos Profesionales </span> </a> <nav class=md-nav aria-label="ğŸ’¼ Consejos Profesionales"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#para-entrevistas class=md-nav__link> <span class=md-ellipsis> Para Entrevistas </span> </a> </li> <li class=md-nav__item> <a href=#para-proyectos-reales class=md-nav__link> <span class=md-ellipsis> Para Proyectos Reales </span> </a> </li> <li class=md-nav__item> <a href=#dockerfile-optimizado class=md-nav__link> <span class=md-ellipsis> Dockerfile Optimizado </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#recursos-externos-del-modulo class=md-nav__link> <span class=md-ellipsis> ğŸ“º Recursos Externos del MÃ³dulo </span> </a> <nav class=md-nav aria-label="ğŸ“º Recursos Externos del MÃ³dulo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#videos class=md-nav__link> <span class=md-ellipsis> ğŸ¬ Videos </span> </a> </li> <li class=md-nav__item> <a href=#documentacion class=md-nav__link> <span class=md-ellipsis> ğŸ“„ DocumentaciÃ³n </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#decision-tecnica-adr-006-docker-multi-stage class=md-nav__link> <span class=md-ellipsis> âš–ï¸ DecisiÃ³n TÃ©cnica: ADR-006 Docker Multi-stage </span> </a> </li> <li class=md-nav__item> <a href=#ejercicios-del-modulo class=md-nav__link> <span class=md-ellipsis> ğŸ”§ Ejercicios del MÃ³dulo </span> </a> <nav class=md-nav aria-label="ğŸ”§ Ejercicios del MÃ³dulo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ejercicio-131-dockerfile-multi-stage class=md-nav__link> <span class=md-ellipsis> Ejercicio 13.1: Dockerfile Multi-stage </span> </a> </li> <li class=md-nav__item> <a href=#ejercicio-132-docker-compose-stack class=md-nav__link> <span class=md-ellipsis> Ejercicio 13.2: Docker Compose Stack </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#glosario-del-modulo class=md-nav__link> <span class=md-ellipsis> ğŸ”— Glosario del MÃ³dulo </span> </a> </li> <li class=md-nav__item> <a href=#la-trampa-errores-comunes-de-este-modulo class=md-nav__link> <span class=md-ellipsis> ğŸª¤ La Trampa â€” Errores Comunes de Este MÃ³dulo </span> </a> <nav class=md-nav aria-label="ğŸª¤ La Trampa â€” Errores Comunes de Este MÃ³dulo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#trampa-1-dockerfile-que-solo-funciona-en-tu-maquina class=md-nav__link> <span class=md-ellipsis> Trampa 1: Dockerfile que solo funciona en tu mÃ¡quina </span> </a> </li> <li class=md-nav__item> <a href=#trampa-2-container-que-muere-sin-logs class=md-nav__link> <span class=md-ellipsis> Trampa 2: Container que muere sin logs </span> </a> </li> <li class=md-nav__item> <a href=#trampa-3-imagen-docker-gigante-2gb class=md-nav__link> <span class=md-ellipsis> Trampa 3: Imagen Docker gigante (2GB+) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quiz-del-modulo-semanas-17-18 class=md-nav__link> <span class=md-ellipsis> ğŸ“ Quiz del MÃ³dulo â€” Semanas 17-18 </span> </a> <nav class=md-nav aria-label="ğŸ“ Quiz del MÃ³dulo â€” Semanas 17-18"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quiz-semana-17-docker class=md-nav__link> <span class=md-ellipsis> Quiz Semana 17: Docker </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../14_FASTAPI/ class=md-nav__link> <span class=md-ellipsis> 14 â€” FastAPI </span> </a> </li> <li class=md-nav__item> <a href=../15_STREAMLIT/ class=md-nav__link> <span class=md-ellipsis> 15 â€” Streamlit </span> </a> </li> <li class=md-nav__item> <a href=../16_OBSERVABILIDAD/ class=md-nav__link> <span class=md-ellipsis> 16 â€” Observabilidad </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Fase 4 - ProducciÃ³n </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Fase 4 - ProducciÃ³n </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../17_DESPLIEGUE/ class=md-nav__link> <span class=md-ellipsis> 17 â€” Despliegue </span> </a> </li> <li class=md-nav__item> <a href=../18_INFRAESTRUCTURA/ class=md-nav__link> <span class=md-ellipsis> 18 â€” Infraestructura </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Fase 5 - Senior/Staff </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Fase 5 - Senior/Staff </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../19_DOCUMENTACION/ class=md-nav__link> <span class=md-ellipsis> 19 â€” DocumentaciÃ³n </span> </a> </li> <li class=md-nav__item> <a href=../20_OBSERVABILIDAD_AVANZADA_DRIFT/ class=md-nav__link> <span class=md-ellipsis> 20 â€” Observabilidad Avanzada </span> </a> </li> <li class=md-nav__item> <a href=../21_CLOUD_FINOPS/ class=md-nav__link> <span class=md-ellipsis> 21 â€” Cloud FinOps </span> </a> </li> <li class=md-nav__item> <a href=../22_IAC_EMPRESARIAL/ class=md-nav__link> <span class=md-ellipsis> 22 â€” IaC Empresarial </span> </a> </li> <li class=md-nav__item> <a href=../23_PROYECTO_INTEGRADOR/ class=md-nav__link> <span class=md-ellipsis> 23 â€” Proyecto Integrador </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> Material de Apoyo </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Material de Apoyo </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../apoyo/ class=md-nav__link> <span class=md-ellipsis> Ãndice Apoyo </span> </a> </li> <li class=md-nav__item> <a href=../apoyo/GLOSARIO/ class=md-nav__link> <span class=md-ellipsis> Glosario MLOps </span> </a> </li> <li class=md-nav__item> <a href=../apoyo/CHECKLIST/ class=md-nav__link> <span class=md-ellipsis> Checklist Profesional </span> </a> </li> <li class=md-nav__item> <a href=../apoyo/RECURSOS/ class=md-nav__link> <span class=md-ellipsis> Recursos Externos </span> </a> </li> <li class=md-nav__item> <a href=../apoyo/RUBRICA_EVALUACION/ class=md-nav__link> <span class=md-ellipsis> RÃºbrica de EvaluaciÃ³n </span> </a> </li> <li class=md-nav__item> <a href=../apoyo/PLANTILLAS/ class=md-nav__link> <span class=md-ellipsis> Plantillas </span> </a> </li> <li class=md-nav__item> <a href=../apoyo/GUIA_AUDIOVISUAL/ class=md-nav__link> <span class=md-ellipsis> GuÃ­a Audiovisual </span> </a> </li> <li class=md-nav__item> <a href=../apoyo/MAINTENANCE_GUIDE/ class=md-nav__link> <span class=md-ellipsis> GuÃ­a de Mantenimiento </span> </a> </li> <li class=md-nav__item> <a href=../apoyo/GUIA_SCRIPTS_OPERACIONALES/ class=md-nav__link> <span class=md-ellipsis> Scripts Operacionales </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> Herramientas de Estudio </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Herramientas de Estudio </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../study_tools/ class=md-nav__link> <span class=md-ellipsis> Ãndice </span> </a> </li> <li class=md-nav__item> <a href=../study_tools/PROTOCOLO_E/ class=md-nav__link> <span class=md-ellipsis> Protocolo E </span> </a> </li> <li class=md-nav__item> <a href=../study_tools/DIARIO_ERRORES/ class=md-nav__link> <span class=md-ellipsis> Diario de Errores </span> </a> </li> <li class=md-nav__item> <a href=../study_tools/CIERRE_SEMANAL/ class=md-nav__link> <span class=md-ellipsis> Cierre Semanal </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_13> <label class=md-nav__link for=__nav_13 id=__nav_13_label tabindex=0> <span class=md-ellipsis> ExÃ¡menes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_13_label aria-expanded=false> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> ExÃ¡menes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../exams/EXAM_01_SETUP/ class=md-nav__link> <span class=md-ellipsis> Exam 01 â€” Setup </span> </a> </li> <li class=md-nav__item> <a href=../../exams/EXAM_02_PIPELINE/ class=md-nav__link> <span class=md-ellipsis> Exam 02 â€” Pipeline </span> </a> </li> <li class=md-nav__item> <a href=../../exams/EXAM_03_TESTING/ class=md-nav__link> <span class=md-ellipsis> Exam 03 â€” Testing </span> </a> </li> <li class=md-nav__item> <a href=../../exams/EXAM_04_DEPLOYMENT/ class=md-nav__link> <span class=md-ellipsis> Exam 04 â€” Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../exams/EXAM_05_PRODUCTION/ class=md-nav__link> <span class=md-ellipsis> Exam 05 â€” Production </span> </a> </li> <li class=md-nav__item> <a href=../../exams/EXAM_06_INTEGRATION/ class=md-nav__link> <span class=md-ellipsis> Exam 06 â€” Integration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_14> <label class=md-nav__link for=__nav_14 id=__nav_14_label tabindex=0> <span class=md-ellipsis> Simulacros de Entrevista </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_14_label aria-expanded=false> <label class=md-nav__title for=__nav_14> <span class="md-nav__icon md-icon"></span> Simulacros de Entrevista </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../SIMULACRO_ENTREVISTA_JUNIOR/ class=md-nav__link> <span class=md-ellipsis> Junior </span> </a> </li> <li class=md-nav__item> <a href=../SIMULACRO_ENTREVISTA_MID/ class=md-nav__link> <span class=md-ellipsis> Mid </span> </a> </li> <li class=md-nav__item> <a href=../SIMULACRO_ENTREVISTA_SENIOR_PARTE1/ class=md-nav__link> <span class=md-ellipsis> Senior Parte 1 </span> </a> </li> <li class=md-nav__item> <a href=../SIMULACRO_ENTREVISTA_SENIOR_PARTE2/ class=md-nav__link> <span class=md-ellipsis> Senior Parte 2 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_15> <label class=md-nav__link for=__nav_15 id=__nav_15_label tabindex=0> <span class=md-ellipsis> Laboratorios </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_15_label aria-expanded=false> <label class=md-nav__title for=__nav_15> <span class="md-nav__icon md-icon"></span> Laboratorios </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../notebooks/labs/LAB_01_DOCKER_DEBUG/ class=md-nav__link> <span class=md-ellipsis> LAB 01 â€” Docker Debug </span> </a> </li> <li class=md-nav__item> <a href=../../notebooks/labs/LAB_02_PANDAS_PERFORMANCE/ class=md-nav__link> <span class=md-ellipsis> LAB 02 â€” Pandas Performance </span> </a> </li> <li class=md-nav__item> <a href=../../notebooks/labs/LAB_03_DEPENDENCY_CONFLICTS/ class=md-nav__link> <span class=md-ellipsis> LAB 03 â€” Dependency Conflicts </span> </a> </li> <li class=md-nav__item> <a href=../../notebooks/07_08_sklearn_pipelines/ class=md-nav__link> <span class=md-ellipsis> ğŸ”§ Notebook Interactivo: sklearn Pipelines y Feature Engineering </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_16> <label class=md-nav__link for=__nav_16 id=__nav_16_label tabindex=0> <span class=md-ellipsis> Plantillas </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_16_label aria-expanded=false> <label class=md-nav__title for=__nav_16> <span class="md-nav__icon md-icon"></span> Plantillas </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../templates/ class=md-nav__link> <span class=md-ellipsis> Ãndice Plantillas </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Tabla de contenidos </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#contenido class=md-nav__link> <span class=md-ellipsis> ğŸ“‹ Contenido </span> </a> <nav class=md-nav aria-label="ğŸ“‹ Contenido"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mapa-mental-de-conceptos-docker-para-ml class=md-nav__link> <span class=md-ellipsis> ğŸ§  Mapa Mental de Conceptos: Docker para ML </span> </a> </li> <li class=md-nav__item> <a href=#ejercicio-puente-dockerfile-minimo class=md-nav__link> <span class=md-ellipsis> ğŸ’» Ejercicio Puente: Dockerfile MÃ­nimo </span> </a> </li> <li class=md-nav__item> <a href=#ejercicio-puente-containerizacion class=md-nav__link> <span class=md-ellipsis> ğŸ’» Ejercicio Puente: ContainerizaciÃ³n </span> </a> </li> <li class=md-nav__item> <a href=#practica-del-portafolio-docker-en-bankchurn class=md-nav__link> <span class=md-ellipsis> ğŸ› ï¸ PrÃ¡ctica del Portafolio: Docker en BankChurn </span> </a> </li> <li class=md-nav__item> <a href=#checkpoint-de-conocimiento class=md-nav__link> <span class=md-ellipsis> âœ… Checkpoint de Conocimiento </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#131-dockerfile-basico-vs-optimizado class=md-nav__link> <span class=md-ellipsis> 13.1 Dockerfile BÃ¡sico vs Optimizado </span> </a> <nav class=md-nav aria-label="13.1 Dockerfile BÃ¡sico vs Optimizado"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#nivel-1-basico-no-usar-en-produccion class=md-nav__link> <span class=md-ellipsis> âŒ Nivel 1: BÃ¡sico (No usar en producciÃ³n) </span> </a> </li> <li class=md-nav__item> <a href=#nivel-2-optimizado class=md-nav__link> <span class=md-ellipsis> âœ… Nivel 2: Optimizado </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#132-multi-stage-builds class=md-nav__link> <span class=md-ellipsis> 13.2 Multi-Stage Builds </span> </a> <nav class=md-nav aria-label="13.2 Multi-Stage Builds"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#el-concepto class=md-nav__link> <span class=md-ellipsis> El Concepto </span> </a> </li> <li class=md-nav__item> <a href=#implementacion class=md-nav__link> <span class=md-ellipsis> ImplementaciÃ³n </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#133-mejores-practicas class=md-nav__link> <span class=md-ellipsis> 13.3 Mejores PrÃ¡cticas </span> </a> <nav class=md-nav aria-label="13.3 Mejores PrÃ¡cticas"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dockerignore class=md-nav__link> <span class=md-ellipsis> .dockerignore </span> </a> </li> <li class=md-nav__item> <a href=#layer-caching class=md-nav__link> <span class=md-ellipsis> Layer Caching </span> </a> </li> <li class=md-nav__item> <a href=#security-non-root-user class=md-nav__link> <span class=md-ellipsis> Security: Non-Root User </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#134-dockerfile-real-del-portafolio class=md-nav__link> <span class=md-ellipsis> 13.4 Dockerfile Real del Portafolio </span> </a> <nav class=md-nav aria-label="13.4 Dockerfile Real del Portafolio"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bankchurn-predictordockerfile class=md-nav__link> <span class=md-ellipsis> BankChurn-Predictor/Dockerfile </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#135-docker-compose-para-ml class=md-nav__link> <span class=md-ellipsis> 13.5 Docker Compose para ML </span> </a> <nav class=md-nav aria-label="13.5 Docker Compose para ML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-composedemoyml-portafolio class=md-nav__link> <span class=md-ellipsis> docker-compose.demo.yml (Portafolio) </span> </a> </li> <li class=md-nav__item> <a href=#comandos-utiles class=md-nav__link> <span class=md-ellipsis> Comandos Ãštiles </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#136-docker-compose-avanzado-para-mlops-nuevo class=md-nav__link> <span class=md-ellipsis> 13.6 Docker Compose Avanzado para MLOps â­ NUEVO </span> </a> <nav class=md-nav aria-label="13.6 Docker Compose Avanzado para MLOps â­ NUEVO"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1361-profiles-servicios-opcionales class=md-nav__link> <span class=md-ellipsis> 13.6.1 Profiles: Servicios Opcionales </span> </a> </li> <li class=md-nav__item> <a href=#1362-healthchecks-avanzados-y-dependencies class=md-nav__link> <span class=md-ellipsis> 13.6.2 Healthchecks Avanzados y Dependencies </span> </a> </li> <li class=md-nav__item> <a href=#1363-networking-para-microservicios-ml class=md-nav__link> <span class=md-ellipsis> 13.6.3 Networking para Microservicios ML </span> </a> </li> <li class=md-nav__item> <a href=#1364-volumes-para-persistencia-y-desarrollo class=md-nav__link> <span class=md-ellipsis> 13.6.4 Volumes para Persistencia y Desarrollo </span> </a> </li> <li class=md-nav__item> <a href=#1365-variables-de-entorno-y-secrets class=md-nav__link> <span class=md-ellipsis> 13.6.5 Variables de Entorno y Secrets </span> </a> </li> <li class=md-nav__item> <a href=#1366-el-stack-completo-del-portafolio class=md-nav__link> <span class=md-ellipsis> 13.6.6 El Stack Completo del Portafolio </span> </a> </li> <li class=md-nav__item> <a href=#ejercicio-crear-tu-stack-docker-compose class=md-nav__link> <span class=md-ellipsis> ğŸ”§ Ejercicio: Crear Tu Stack Docker Compose </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#137-ingenieria-inversa-pedagogica-dockerfile-del-portafolio class=md-nav__link> <span class=md-ellipsis> 13.7 ğŸ”¬ IngenierÃ­a Inversa PedagÃ³gica: Dockerfile del Portafolio </span> </a> <nav class=md-nav aria-label="13.7 ğŸ”¬ IngenierÃ­a Inversa PedagÃ³gica: Dockerfile del Portafolio"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1371-el-por-que-arquitectonico class=md-nav__link> <span class=md-ellipsis> 13.7.1 ğŸ¯ El "Por QuÃ©" ArquitectÃ³nico </span> </a> </li> <li class=md-nav__item> <a href=#1372-anatomia-linea-por-linea-bankchurn-predictordockerfile class=md-nav__link> <span class=md-ellipsis> 13.7.2 ğŸ” AnatomÃ­a LÃ­nea por LÃ­nea: BankChurn-Predictor/Dockerfile </span> </a> </li> <li class=md-nav__item> <a href=#1373-laboratorio-de-replicacion-escribe-el-dockerfile-tu-mismo class=md-nav__link> <span class=md-ellipsis> 13.7.3 ğŸ§ª Laboratorio de ReplicaciÃ³n: Escribe el Dockerfile TÃº Mismo </span> </a> </li> <li class=md-nav__item> <a href=#1374-troubleshooting-preventivo-los-5-errores-mas-comunes class=md-nav__link> <span class=md-ellipsis> 13.7.4 ğŸš¨ Troubleshooting Preventivo: Los 5 Errores MÃ¡s Comunes </span> </a> </li> <li class=md-nav__item> <a href=#1375-checklist-de-replicacion-completa class=md-nav__link> <span class=md-ellipsis> 13.7.5 ğŸ“‹ Checklist de ReplicaciÃ³n Completa </span> </a> </li> <li class=md-nav__item> <a href=#1376-anatomia-del-dockerignore-real-del-portafolio class=md-nav__link> <span class=md-ellipsis> 13.7.6 ğŸ“ AnatomÃ­a del .dockerignore Real del Portafolio </span> </a> </li> <li class=md-nav__item> <a href=#1377-conexion-docker-kubernetes-de-imagen-a-produccion class=md-nav__link> <span class=md-ellipsis> 13.7.7 ğŸ”— ConexiÃ³n Docker â†’ Kubernetes: De Imagen a ProducciÃ³n </span> </a> </li> <li class=md-nav__item> <a href=#1378-metricas-de-exito-como-saber-que-lo-hiciste-bien class=md-nav__link> <span class=md-ellipsis> 13.7.8 ğŸ“Š MÃ©tricas de Ã‰xito: Â¿CÃ³mo Saber que lo Hiciste Bien? </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#errores-habituales-y-como-depurarlos-en-docker-para-ml class=md-nav__link> <span class=md-ellipsis> ğŸ§¨ Errores habituales y cÃ³mo depurarlos en Docker para ML </span> </a> <nav class=md-nav aria-label="ğŸ§¨ Errores habituales y cÃ³mo depurarlos en Docker para ML"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-imagenes-demasiado-grandes class=md-nav__link> <span class=md-ellipsis> 1) ImÃ¡genes demasiado grandes </span> </a> </li> <li class=md-nav__item> <a href=#2-errores-de-permisos-al-correr-como-non-root class=md-nav__link> <span class=md-ellipsis> 2) Errores de permisos al correr como non-root </span> </a> </li> <li class=md-nav__item> <a href=#3-modelo-o-artefactos-no-encontrados-dentro-del-contenedor class=md-nav__link> <span class=md-ellipsis> 3) Modelo o artefactos no encontrados dentro del contenedor </span> </a> </li> <li class=md-nav__item> <a href=#4-contenedores-que-arrancan-pero-el-healthcheck-falla class=md-nav__link> <span class=md-ellipsis> 4) Contenedores que arrancan pero el healthcheck falla </span> </a> </li> <li class=md-nav__item> <a href=#5-patron-general-de-debugging-con-docker class=md-nav__link> <span class=md-ellipsis> 5) PatrÃ³n general de debugging con Docker </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#checkpoint class=md-nav__link> <span class=md-ellipsis> âœ… Checkpoint </span> </a> </li> <li class=md-nav__item> <a href=#consejos-profesionales class=md-nav__link> <span class=md-ellipsis> ğŸ’¼ Consejos Profesionales </span> </a> <nav class=md-nav aria-label="ğŸ’¼ Consejos Profesionales"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#para-entrevistas class=md-nav__link> <span class=md-ellipsis> Para Entrevistas </span> </a> </li> <li class=md-nav__item> <a href=#para-proyectos-reales class=md-nav__link> <span class=md-ellipsis> Para Proyectos Reales </span> </a> </li> <li class=md-nav__item> <a href=#dockerfile-optimizado class=md-nav__link> <span class=md-ellipsis> Dockerfile Optimizado </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#recursos-externos-del-modulo class=md-nav__link> <span class=md-ellipsis> ğŸ“º Recursos Externos del MÃ³dulo </span> </a> <nav class=md-nav aria-label="ğŸ“º Recursos Externos del MÃ³dulo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#videos class=md-nav__link> <span class=md-ellipsis> ğŸ¬ Videos </span> </a> </li> <li class=md-nav__item> <a href=#documentacion class=md-nav__link> <span class=md-ellipsis> ğŸ“„ DocumentaciÃ³n </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#decision-tecnica-adr-006-docker-multi-stage class=md-nav__link> <span class=md-ellipsis> âš–ï¸ DecisiÃ³n TÃ©cnica: ADR-006 Docker Multi-stage </span> </a> </li> <li class=md-nav__item> <a href=#ejercicios-del-modulo class=md-nav__link> <span class=md-ellipsis> ğŸ”§ Ejercicios del MÃ³dulo </span> </a> <nav class=md-nav aria-label="ğŸ”§ Ejercicios del MÃ³dulo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ejercicio-131-dockerfile-multi-stage class=md-nav__link> <span class=md-ellipsis> Ejercicio 13.1: Dockerfile Multi-stage </span> </a> </li> <li class=md-nav__item> <a href=#ejercicio-132-docker-compose-stack class=md-nav__link> <span class=md-ellipsis> Ejercicio 13.2: Docker Compose Stack </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#glosario-del-modulo class=md-nav__link> <span class=md-ellipsis> ğŸ”— Glosario del MÃ³dulo </span> </a> </li> <li class=md-nav__item> <a href=#la-trampa-errores-comunes-de-este-modulo class=md-nav__link> <span class=md-ellipsis> ğŸª¤ La Trampa â€” Errores Comunes de Este MÃ³dulo </span> </a> <nav class=md-nav aria-label="ğŸª¤ La Trampa â€” Errores Comunes de Este MÃ³dulo"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#trampa-1-dockerfile-que-solo-funciona-en-tu-maquina class=md-nav__link> <span class=md-ellipsis> Trampa 1: Dockerfile que solo funciona en tu mÃ¡quina </span> </a> </li> <li class=md-nav__item> <a href=#trampa-2-container-que-muere-sin-logs class=md-nav__link> <span class=md-ellipsis> Trampa 2: Container que muere sin logs </span> </a> </li> <li class=md-nav__item> <a href=#trampa-3-imagen-docker-gigante-2gb class=md-nav__link> <span class=md-ellipsis> Trampa 3: Imagen Docker gigante (2GB+) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#quiz-del-modulo-semanas-17-18 class=md-nav__link> <span class=md-ellipsis> ğŸ“ Quiz del MÃ³dulo â€” Semanas 17-18 </span> </a> <nav class=md-nav aria-label="ğŸ“ Quiz del MÃ³dulo â€” Semanas 17-18"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#quiz-semana-17-docker class=md-nav__link> <span class=md-ellipsis> Quiz Semana 17: Docker </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=13-docker-avanzado-para-ml>13. Docker Avanzado para ML<a class=headerlink href=#13-docker-avanzado-para-ml title="Permanent link">&para;</a></h1> <p><a id=00-prerrequisitos></a></p> <p>## 0.0 Prerrequisitos</p> <ul> <li>Tener Docker instalado y funcionando (<code>docker --version</code>).</li> <li>Poder construir y correr contenedores (<code>docker build</code>, <code>docker run</code>).</li> <li>Conocer la estructura <code>src/</code>, <code>app/</code> y <code>configs/</code> usada en los proyectos del portafolio.</li> </ul> <hr> <p><a id=01-protocolo-e-como-estudiar-este-modulo></a></p> <p>## 0.1 ğŸ§  Protocolo E: CÃ³mo estudiar este mÃ³dulo</p> <ul> <li><strong>Antes de empezar</strong>: abre <strong><a href=../study_tools/PROTOCOLO_E/ >Protocolo E</a></strong> y define el output mÃ­nimo (una imagen <code>slim</code> que levanta la API).</li> <li><strong>Durante el debugging</strong>: si te atoras &gt;15 min (permisos, build lento, rutas/artefactos), registra el caso en <strong><a href=../study_tools/DIARIO_ERRORES/ >Diario de Errores</a></strong>.</li> <li><strong>Al cierre de semana</strong>: usa <strong><a href=../study_tools/CIERRE_SEMANAL/ >Cierre Semanal</a></strong> para auditar si tu Dockerfile es reproducible y seguro.</li> </ul> <hr> <p><a id=02-entregables-verificables-minimo-viable></a></p> <p>## 0.2 âœ… Entregables verificables (mÃ­nimo viable)</p> <ul> <li>[ ] Un Dockerfile optimizado (base <code>slim</code>, orden de layers, <code>.dockerignore</code>).</li> <li>[ ] Multi-stage build (builder + runtime) o justificaciÃ³n si no aplica.</li> <li>[ ] Contenedor corriendo como non-root.</li> <li>[ ] Imagen con tamaÃ±o razonable (objetivo: &lt; 500MB).</li> <li>[ ] <code>docker run</code> levanta el servicio y responde en <code>/health</code>.</li> </ul> <hr> <p><a id=03-puente-teoria-codigo-portafolio></a></p> <p>## 0.3 ğŸ§© Puente teorÃ­a â†” cÃ³digo (Portafolio)</p> <ul> <li><strong>Concepto</strong>: imÃ¡genes pequeÃ±as + reproducibles + seguras (no-root) + healthchecks</li> <li><strong>Archivo</strong>: <code>Dockerfile</code>, <code>.dockerignore</code>, <code>docker-compose*.yml</code></li> <li><strong>Prueba</strong>: <code>docker build -t &lt;img&gt; .</code> y <code>docker run -p 8000:8000 &lt;img&gt;</code></li> </ul> <p>## ğŸ¯ Objetivo del MÃ³dulo</p> <p>Construir imÃ¡genes Docker optimizadas, seguras y pequeÃ±as como las del portafolio.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>â•‘                                                                              â•‘
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>â•‘  NIVEL 1: Funcional       NIVEL 2: Optimizado      NIVEL 3: Production       â•‘
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â•‘
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>â•‘  FROM python:3.11         Multi-stage build        Distroless/Alpine         â•‘
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>â•‘  COPY . .                 Slim base                Non-root user             â•‘
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>â•‘  pip install              Layer caching            CVE scanning              â•‘
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>â•‘                                                                              â•‘
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>â•‘  ~1.2GB                   ~400MB                   ~150MB                    â•‘
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>â•‘  âš ï¸ BÃ¡sica                 âœ… Mejor                  ğŸ›¡ï¸ Hardened            â•‘
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>â•‘                                                                              â•‘
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
</code></pre></div> <hr> <h2 id=contenido>ğŸ“‹ Contenido<a class=headerlink href=#contenido title="Permanent link">&para;</a></h2> <ul> <li><strong>0.0</strong> <a href=#00-prerrequisitos>Prerrequisitos</a></li> <li><strong>0.1</strong> <a href=#01-protocolo-e-como-estudiar-este-modulo>Protocolo E: CÃ³mo estudiar este mÃ³dulo</a></li> <li><strong>0.2</strong> <a href=#02-entregables-verificables-minimo-viable>Entregables verificables (mÃ­nimo viable)</a></li> <li><strong>0.3</strong> <a href=#03-puente-teoria-codigo-portafolio>Puente teorÃ­a â†” cÃ³digo (Portafolio)</a></li> <li><strong>13.1</strong> <a href=#131-dockerfile-basico-vs-optimizado>Dockerfile BÃ¡sico vs Optimizado</a></li> <li><strong>13.2</strong> <a href=#132-multi-stage-builds>Multi-Stage Builds</a></li> <li><strong>13.3</strong> <a href=#133-mejores-practicas>Mejores PrÃ¡cticas</a></li> <li><strong>13.4</strong> <a href=#134-dockerfile-real-del-portafolio>Dockerfile Real del Portafolio</a></li> <li><strong>13.5</strong> <a href=#135-docker-compose-para-ml>Docker Compose para ML</a></li> <li><strong>13.6</strong> <a href=#136-docker-compose-avanzado>Docker Compose Avanzado para MLOps</a></li> <li><strong>13.7</strong> <a href=#137-ingenieria-inversa-pedagogica>ğŸ”¬ IngenierÃ­a Inversa PedagÃ³gica: Dockerfile del Portafolio</a> â­ NUEVO</li> <li><strong>13.7.1</strong> <a href=#1371-el-por-que-arquitectonico>El "Por QuÃ©" ArquitectÃ³nico</a></li> <li><strong>13.7.2</strong> <a href=#1372-anatomia-linea-por-linea>AnatomÃ­a LÃ­nea por LÃ­nea</a></li> <li><strong>13.7.3</strong> <a href=#1373-laboratorio-de-replicacion>Laboratorio de ReplicaciÃ³n</a></li> <li><strong>13.7.4</strong> <a href=#1374-troubleshooting-preventivo>Troubleshooting Preventivo</a></li> <li><strong>13.7.5</strong> <a href=#1375-checklist-de-replicacion>Checklist de ReplicaciÃ³n</a></li> <li><strong>13.7.6</strong> <a href=#1376-anatomia-del-dockerignore>AnatomÃ­a del .dockerignore</a></li> <li><strong>13.7.7</strong> <a href=#1377-conexion-docker-kubernetes>ConexiÃ³n Docker â†’ Kubernetes</a></li> <li><strong>13.7.8</strong> <a href=#1378-metricas-de-exito>MÃ©tricas de Ã‰xito</a></li> <li><a href=#errores-habituales>Errores habituales</a></li> <li><a href=#checkpoint>âœ… Checkpoint</a></li> <li><a href=#ejercicio>âœ… Ejercicio</a></li> </ul> <hr> <p><a id=131-dockerfile-basico-vs-optimizado></a></p> <h3 id=mapa-mental-de-conceptos-docker-para-ml>ğŸ§  Mapa Mental de Conceptos: Docker para ML<a class=headerlink href=#mapa-mental-de-conceptos-docker-para-ml title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>                          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>                          â•‘      DOCKER PROFESIONAL PARA ML      â•‘
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>                          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>                                            â”‚
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>         â–¼                                  â–¼                                  â–¼
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>â”‚   DOCKERFILE     â”‚              â”‚  OPTIMIZACIÃ“N    â”‚              â”‚   SEGURIDAD      â”‚
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>       â”‚                                 â”‚                                 â”‚
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>â”œâ”€ FROM (base image)              â”œâ”€ Multi-stage build            â”œâ”€ Non-root user
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>â”œâ”€ COPY (archivos)                â”œâ”€ Layer caching                â”œâ”€ .dockerignore
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>â”œâ”€ RUN (comandos)                 â”œâ”€ Slim/Alpine base             â”œâ”€ CVE scanning
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>â”œâ”€ CMD (entrypoint)               â”œâ”€ .dockerignore                â””â”€ Secrets mgmt
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>â””â”€ EXPOSE (puertos)               â””â”€ Reduce tamaÃ±o
</code></pre></div> <p><strong>TÃ©rminos clave:</strong></p> <table> <thead> <tr> <th>TÃ©rmino</th> <th>Significado</th> <th>Ejemplo</th> </tr> </thead> <tbody> <tr> <td><strong>Multi-stage</strong></td> <td>Compilar en una imagen, correr en otra</td> <td>Builder + Runtime</td> </tr> <tr> <td><strong>Layer</strong></td> <td>Cada instrucciÃ³n crea una capa</td> <td>Cacheable</td> </tr> <tr> <td><strong>Slim</strong></td> <td>Imagen base reducida</td> <td><code>python:3.11-slim</code></td> </tr> <tr> <td><strong>.dockerignore</strong></td> <td>Archivos a no copiar</td> <td><code>.git</code>, <code>data/</code>, <code>__pycache__</code></td> </tr> </tbody> </table> <hr> <h3 id=ejercicio-puente-dockerfile-minimo>ğŸ’» Ejercicio Puente: Dockerfile MÃ­nimo<a class=headerlink href=#ejercicio-puente-dockerfile-minimo title="Permanent link">&para;</a></h3> <p><strong>TU TAREA:</strong> Crea un Dockerfile bÃ¡sico para una API FastAPI <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--no-cache-dir<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=k>COPY</span><span class=w> </span>src/<span class=w> </span>./src/
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=k>COPY</span><span class=w> </span>app/<span class=w> </span>./app/
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;uvicorn&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.main:app&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--host&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.0.0.0&quot;</span><span class=p>]</span>
</code></pre></div></p> <hr> <h3 id=ejercicio-puente-containerizacion>ğŸ’» Ejercicio Puente: ContainerizaciÃ³n<a class=headerlink href=#ejercicio-puente-containerizacion title="Permanent link">&para;</a></h3> <blockquote> <p><strong>Meta</strong>: Practica el concepto antes de aplicarlo al portafolio.</p> </blockquote> <p><strong>Ejercicio bÃ¡sico:</strong> 1. Lee la secciÃ³n teÃ³rica siguiente 2. Identifica los patrones clave del cÃ³digo de ejemplo 3. Replica el patrÃ³n en un proyecto de prueba</p> <hr> <h3 id=practica-del-portafolio-docker-en-bankchurn>ğŸ› ï¸ PrÃ¡ctica del Portafolio: Docker en BankChurn<a class=headerlink href=#practica-del-portafolio-docker-en-bankchurn title="Permanent link">&para;</a></h3> <blockquote> <p><strong>Tarea</strong>: Aplicar este mÃ³dulo en BankChurn-Predictor.</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nb>cd</span><span class=w> </span>BankChurn-Predictor
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=c1># Explora el cÃ³digo relacionado con ContainerizaciÃ³n</span>
</code></pre></div> <p><strong>Checklist:</strong> - [ ] LocalicÃ© el cÃ³digo relevante - [ ] EntendÃ­ la implementaciÃ³n actual - [ ] IdentifiquÃ© posibles mejoras</p> <hr> <h3 id=checkpoint-de-conocimiento>âœ… Checkpoint de Conocimiento<a class=headerlink href=#checkpoint-de-conocimiento title="Permanent link">&para;</a></h3> <p><strong>Pregunta 1</strong>: Â¿CuÃ¡l es el objetivo principal de Docker?</p> <p><strong>Pregunta 2</strong>: Â¿CÃ³mo se implementa en el portafolio?</p> <p><strong>ğŸ”§ Escenario Debugging</strong>: Si algo falla en ContainerizaciÃ³n, Â¿cuÃ¡l serÃ­a tu primer paso de diagnÃ³stico?</p> <h2 id=131-dockerfile-basico-vs-optimizado>13.1 Dockerfile BÃ¡sico vs Optimizado<a class=headerlink href=#131-dockerfile-basico-vs-optimizado title="Permanent link">&para;</a></h2> <h3 id=nivel-1-basico-no-usar-en-produccion>âŒ Nivel 1: BÃ¡sico (No usar en producciÃ³n)<a class=headerlink href=#nivel-1-basico-no-usar-en-produccion title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c># Dockerfile MALO - Solo para demos rÃ¡pidas</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;python&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;main.py&quot;</span><span class=p>]</span>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=c># Problemas:</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=c># - Imagen de ~1.2GB</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=c># - Incluye herramientas de desarrollo innecesarias</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=c># - Cache de pip no aprovechado</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=c># - Corre como root (inseguro)</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=c># - Copia archivos innecesarios (.git, tests, etc.)</span>
</code></pre></div> <h3 id=nivel-2-optimizado>âœ… Nivel 2: Optimizado<a class=headerlink href=#nivel-2-optimizado title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c># Dockerfile MEJOR - Para staging/desarrollo</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=c># 1. Usar slim para reducir tamaÃ±o</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=c># 2. Establecer directorio de trabajo</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=c># 3. Copiar SOLO requirements primero (aprovecha cache)</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=c># 4. Instalar dependencias (capa cacheada si requirements no cambia)</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--no-cache-dir<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=c># 5. Copiar cÃ³digo fuente</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=k>COPY</span><span class=w> </span>src/<span class=w> </span>./src/
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=k>COPY</span><span class=w> </span>app/<span class=w> </span>./app/
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=k>COPY</span><span class=w> </span>configs/<span class=w> </span>./configs/
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=c># 6. Usuario no-root</span>
<a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=k>RUN</span><span class=w> </span>useradd<span class=w> </span>-m<span class=w> </span>appuser<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chown<span class=w> </span>-R<span class=w> </span>appuser:appuser<span class=w> </span>/app
<a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=k>USER</span><span class=w> </span><span class=s>appuser</span>
<a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>
<a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=c># 7. Puerto y comando</span>
<a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>8000</span>
<a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;uvicorn&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.fastapi_app:app&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--host&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.0.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--port&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;8000&quot;</span><span class=p>]</span>
<a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>
<a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=c># Mejoras:</span>
<a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=c># - ~400MB (slim base)</span>
<a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=c># - Cache de layers optimizado</span>
<a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=c># - No corre como root</span>
<a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=c># - Solo archivos necesarios</span>
</code></pre></div> <hr> <h2 id=132-multi-stage-builds>13.2 Multi-Stage Builds<a class=headerlink href=#132-multi-stage-builds title="Permanent link">&para;</a></h2> <p><a id=132-multi-stage-builds></a></p> <h3 id=el-concepto>El Concepto<a class=headerlink href=#el-concepto title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>â”‚                         MULTI-STAGE BUILD                                   â”‚
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>â”‚                                                                             â”‚
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>â”‚  STAGE 1: Builder                    STAGE 2: Runtime                       â”‚
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>â”‚  â€¢ Imagen completa                   â€¢ Imagen mÃ­nima                        â”‚
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>â”‚  â€¢ Compila cÃ³digo                    â€¢ Solo runtime                         â”‚
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>â”‚  â€¢ Instala dependencias              â€¢ Copia solo binarios                  â”‚
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>â”‚  â€¢ Genera wheels                     â€¢ Sin compiladores                     â”‚
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>â”‚                                                                             â”‚
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>â”‚  â”‚ python:3.11     â”‚                 â”‚ python:3.11-slim â”‚                   â”‚
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>â”‚  â”‚ + gcc, make     â”‚                 â”‚                  â”‚                   â”‚
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>â”‚  â”‚ + pip wheel     â”‚   â”€â”€COPYâ”€â”€â–º     â”‚ + wheels only    â”‚                   â”‚
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>â”‚  â”‚ = 1.2GB         â”‚                 â”‚ = 150-400MB      â”‚                   â”‚
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>â”‚                                                                             â”‚
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>â”‚  Se DESCARTA                         Se USA en producciÃ³n                   â”‚
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>â”‚                                                                             â”‚
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div> <h3 id=implementacion>ImplementaciÃ³n<a class=headerlink href=#implementacion title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c># Dockerfile Multi-Stage - Nivel 3 (ProducciÃ³n)</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=c># STAGE 1: Builder - Compila dependencias</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>builder</span><span class=w>          </span>#<span class=w> </span>AS<span class=w> </span>builder:<span class=w> </span>nombra<span class=w> </span>este<span class=w> </span>stage<span class=w> </span>para<span class=w> </span>referenciarlo<span class=w> </span>despuÃ©s.
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/build                            # Directorio de trabajo para compilaciÃ³n.</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=c># Instalar herramientas de compilaciÃ³n (temporales)</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\ </span><span class=w> </span>#<span class=w> </span>--no-install-recommends:<span class=w> </span>solo<span class=w> </span>deps<span class=w> </span>esenciales.
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>    </span>gcc<span class=w> </span><span class=se>\ </span><span class=w>                                </span>#<span class=w> </span>Compilador<span class=w> </span>C<span class=w> </span><span class=o>(</span>para<span class=w> </span>paquetes<span class=w> </span>con<span class=w> </span>cÃ³digo<span class=w> </span>nativo<span class=o>)</span>.
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>    </span>python3-dev<span class=w> </span><span class=se>\ </span><span class=w>                        </span>#<span class=w> </span>Headers<span class=w> </span>de<span class=w> </span>Python<span class=w> </span><span class=o>(</span>para<span class=w> </span>compilar<span class=w> </span>extensiones<span class=o>)</span>.
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*<span class=w>        </span>#<span class=w> </span>Limpia<span class=w> </span>cache<span class=w> </span>apt<span class=w> </span>â†’<span class=w> </span>reduce<span class=w> </span>tamaÃ±o.
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=c># Copiar requirements</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.<span class=w>                   </span>#<span class=w> </span>Solo<span class=w> </span>requirements<span class=w> </span>para<span class=w> </span>aprovechar<span class=w> </span>cache.
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=c># Crear wheels (binarios precompilados)</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>wheel<span class=w> </span>--no-cache-dir<span class=w> </span>--wheel-dir<span class=w> </span>/wheels<span class=w> </span>-r<span class=w> </span>requirements.txt<span class=w>  </span>#<span class=w> </span>Genera<span class=w> </span>.whl<span class=w> </span>en<span class=w> </span>/wheels.
<a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a>
<a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a><span class=c># STAGE 2: Runtime - Imagen final mÃ­nima</span>
<a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>runtime</span><span class=w>          </span>#<span class=w> </span>Nueva<span class=w> </span>imagen<span class=w> </span>limpia,<span class=w> </span>sin<span class=w> </span>gcc<span class=w> </span>ni<span class=w> </span>herramientas<span class=w> </span>de<span class=w> </span>build.
<a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>
<a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app                              # Directorio de la aplicaciÃ³n.</span>
<a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>
<a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a><span class=c># Copiar SOLO los wheels del builder</span>
<a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>/wheels<span class=w> </span>/wheels<span class=w>       </span>#<span class=w> </span>--from<span class=o>=</span>builder:<span class=w> </span>copia<span class=w> </span>desde<span class=w> </span>el<span class=w> </span>stage<span class=w> </span>anterior.
<a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>
<a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a><span class=c># Instalar desde wheels (sin compilaciÃ³n)</span>
<a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--no-cache-dir<span class=w> </span>/wheels/*<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/wheels<span class=w>  </span>#<span class=w> </span>Instala<span class=w> </span>y<span class=w> </span>limpia<span class=w> </span>wheels.
<a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>
<a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a><span class=c># Copiar cÃ³digo</span>
<a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a><span class=k>COPY</span><span class=w> </span>src/<span class=w> </span>./src/<span class=w>                          </span>#<span class=w> </span>CÃ³digo<span class=w> </span>fuente.
<a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a><span class=k>COPY</span><span class=w> </span>app/<span class=w> </span>./app/<span class=w>                          </span>#<span class=w> </span>AplicaciÃ³n<span class=w> </span>FastAPI/Streamlit.
<a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a><span class=k>COPY</span><span class=w> </span>configs/<span class=w> </span>./configs/<span class=w>                  </span>#<span class=w> </span>Archivos<span class=w> </span>de<span class=w> </span>configuraciÃ³n.
<a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>
<a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a><span class=c># Copiar modelo pre-entrenado si existe</span>
<a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a><span class=k>COPY</span><span class=w> </span>artifacts/model.joblib<span class=w> </span>./artifacts/model.joblib<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>true</span><span class=w>  </span>#<span class=w> </span><span class=o>||</span><span class=w> </span>true:<span class=w> </span>no<span class=w> </span>falla<span class=w> </span>si<span class=w> </span>no<span class=w> </span>existe.
<a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a>
<a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a><span class=c># Crear usuario no-root</span>
<a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a><span class=k>RUN</span><span class=w> </span>useradd<span class=w> </span>-m<span class=w> </span>-u<span class=w> </span><span class=m>1000</span><span class=w> </span>appuser<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chown<span class=w> </span>-R<span class=w> </span>appuser:appuser<span class=w> </span>/app<span class=w>  </span>#<span class=w> </span>Seguridad:<span class=w> </span>nunca<span class=w> </span>correr<span class=w> </span>como<span class=w> </span>root.
<a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a><span class=k>USER</span><span class=w> </span><span class=s>appuser                              # Cambia a usuario sin privilegios.</span>
<a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a>
<a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a><span class=c># Healthcheck</span>
<a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a><span class=k>HEALTHCHECK</span><span class=w> </span>--interval<span class=o>=</span>30s<span class=w> </span>--timeout<span class=o>=</span>10s<span class=w> </span>--start-period<span class=o>=</span>5s<span class=w> </span>--retries<span class=o>=</span><span class=m>3</span><span class=w> </span><span class=se>\ </span><span class=w> </span>#<span class=w> </span>Docker<span class=w> </span>verifica<span class=w> </span>salud<span class=w> </span>automÃ¡ticamente.
<a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a><span class=w>    </span>CMD<span class=w> </span>curl<span class=w> </span>-f<span class=w> </span>http://localhost:8000/health<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span><span class=w>  </span>#<span class=w> </span>Falla<span class=w> </span>si<span class=w> </span>/health<span class=w> </span>no<span class=w> </span>responde<span class=w> </span><span class=m>200</span>.
<a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a>
<a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a><span class=c># Exponer puerto</span>
<a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>8000                               # Documenta el puerto (no lo publica).</span>
<a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a>
<a id=__codelineno-7-54 name=__codelineno-7-54 href=#__codelineno-7-54></a><span class=c># Comando de inicio</span>
<a id=__codelineno-7-55 name=__codelineno-7-55 href=#__codelineno-7-55></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;uvicorn&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.fastapi_app:app&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--host&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.0.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--port&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;8000&quot;</span><span class=p>]</span><span class=w>  </span>#<span class=w> </span>Ejecuta<span class=w> </span>la<span class=w> </span>API.
</code></pre></div> <hr> <h2 id=133-mejores-practicas>13.3 Mejores PrÃ¡cticas<a class=headerlink href=#133-mejores-practicas title="Permanent link">&para;</a></h2> <p><a id=133-mejores-practicas></a></p> <h3 id=dockerignore>.dockerignore<a class=headerlink href=#dockerignore title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a># .dockerignore - Excluir archivos innecesarios
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a># Git
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>.git
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>.gitignore
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a># Python
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>__pycache__
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>*.py[cod]
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>*.pyo
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>.pytest_cache
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>.mypy_cache
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>.coverage
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>htmlcov/
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>.venv/
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>venv/
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>*.egg-info/
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a># IDE
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>.vscode/
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>.idea/
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a>*.swp
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a># Tests (no necesarios en producciÃ³n)
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a>tests/
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>*_test.py
<a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a>test_*.py
<a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a>conftest.py
<a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a>
<a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a># DocumentaciÃ³n
<a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a>docs/
<a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a>*.md
<a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a>!README.md
<a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a>
<a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a># Datos (montar como volumen, no copiar)
<a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a>data/
<a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a>*.csv
<a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a>*.parquet
<a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a>
<a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a># Notebooks
<a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a>*.ipynb
<a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a>notebooks/
<a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a>
<a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a># Logs y temporales
<a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a>*.log
<a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a>logs/
<a id=__codelineno-8-47 name=__codelineno-8-47 href=#__codelineno-8-47></a>tmp/
</code></pre></div> <h3 id=layer-caching>Layer Caching<a class=headerlink href=#layer-caching title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c># âŒ MALO: Cualquier cambio en cÃ³digo invalida cache de pip</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=c># âœ… BUENO: requirements separado para aprovechar cache</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=k>COPY</span><span class=w> </span>src/<span class=w> </span>./src/<span class=w>  </span>#<span class=w> </span>Cambios<span class=w> </span>aquÃ­<span class=w> </span>NO<span class=w> </span>invalidan<span class=w> </span>pip<span class=w> </span>install
</code></pre></div> <h3 id=security-non-root-user>Security: Non-Root User<a class=headerlink href=#security-non-root-user title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c># Crear usuario con UID especÃ­fico (evita conflictos de permisos)</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>RUN</span><span class=w> </span>useradd<span class=w> </span>-m<span class=w> </span>-u<span class=w> </span><span class=m>1000</span><span class=w> </span>appuser
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=c># Dar permisos al directorio de trabajo</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=k>RUN</span><span class=w> </span>chown<span class=w> </span>-R<span class=w> </span>appuser:appuser<span class=w> </span>/app
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=c># Cambiar a usuario no-root ANTES de CMD</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=k>USER</span><span class=w> </span><span class=s>appuser</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=c># Ahora el proceso corre como appuser, no como root</span>
</code></pre></div> <hr> <p><a id=134-dockerfile-real-del-portafolio></a></p> <h2 id=134-dockerfile-real-del-portafolio>13.4 Dockerfile Real del Portafolio<a class=headerlink href=#134-dockerfile-real-del-portafolio title="Permanent link">&para;</a></h2> <h3 id=bankchurn-predictordockerfile>BankChurn-Predictor/Dockerfile<a class=headerlink href=#bankchurn-predictordockerfile title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c># BankChurn-Predictor Production Dockerfile</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=c># Multi-stage build optimizado para ML</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=c># Stage 1: Builder</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>builder</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/build</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=c># Dependencias de sistema para compilaciÃ³n</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>    </span>gcc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>    </span>python3-dev<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=c># Copiar requirements</span>
<a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>
<a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=c># Crear wheels</span>
<a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>wheel<span class=w> </span>--no-cache-dir<span class=w> </span>--wheel-dir<span class=w> </span>/wheels<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>
<a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=c># Stage 2: Runtime</span>
<a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span>
<a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a>
<a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a><span class=c># Labels para metadata</span>
<a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=k>LABEL</span><span class=w> </span><span class=nv>maintainer</span><span class=o>=</span><span class=s2>&quot;duqueom@example.com&quot;</span>
<a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a><span class=k>LABEL</span><span class=w> </span><span class=nv>version</span><span class=o>=</span><span class=s2>&quot;1.0.0&quot;</span>
<a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a><span class=k>LABEL</span><span class=w> </span><span class=nv>description</span><span class=o>=</span><span class=s2>&quot;BankChurn Predictor API&quot;</span>
<a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a>
<a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a>
<a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a><span class=c># Instalar curl para healthcheck</span>
<a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span>curl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a>
<a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a><span class=c># Instalar dependencias desde wheels</span>
<a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>/wheels<span class=w> </span>/wheels
<a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--no-cache-dir<span class=w> </span>/wheels/*<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/wheels
<a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a>
<a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a><span class=c># Copiar cÃ³digo fuente</span>
<a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a><span class=k>COPY</span><span class=w> </span>src/<span class=w> </span>./src/
<a id=__codelineno-11-45 name=__codelineno-11-45 href=#__codelineno-11-45></a><span class=k>COPY</span><span class=w> </span>app/<span class=w> </span>./app/
<a id=__codelineno-11-46 name=__codelineno-11-46 href=#__codelineno-11-46></a><span class=k>COPY</span><span class=w> </span>configs/<span class=w> </span>./configs/
<a id=__codelineno-11-47 name=__codelineno-11-47 href=#__codelineno-11-47></a>
<a id=__codelineno-11-48 name=__codelineno-11-48 href=#__codelineno-11-48></a><span class=c># Copiar modelo (si existe)</span>
<a id=__codelineno-11-49 name=__codelineno-11-49 href=#__codelineno-11-49></a><span class=k>COPY</span><span class=w> </span>models/<span class=w> </span>./models/<span class=w> </span><span class=m>2</span>&gt;/dev/null<span class=w> </span><span class=o>||</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>./models
<a id=__codelineno-11-50 name=__codelineno-11-50 href=#__codelineno-11-50></a>
<a id=__codelineno-11-51 name=__codelineno-11-51 href=#__codelineno-11-51></a><span class=c># Crear usuario no-root</span>
<a id=__codelineno-11-52 name=__codelineno-11-52 href=#__codelineno-11-52></a><span class=k>RUN</span><span class=w> </span>useradd<span class=w> </span>-m<span class=w> </span>-u<span class=w> </span><span class=m>1000</span><span class=w> </span>appuser<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chown<span class=w> </span>-R<span class=w> </span>appuser:appuser<span class=w> </span>/app
<a id=__codelineno-11-53 name=__codelineno-11-53 href=#__codelineno-11-53></a><span class=k>USER</span><span class=w> </span><span class=s>appuser</span>
<a id=__codelineno-11-54 name=__codelineno-11-54 href=#__codelineno-11-54></a>
<a id=__codelineno-11-55 name=__codelineno-11-55 href=#__codelineno-11-55></a><span class=c># Variables de entorno</span>
<a id=__codelineno-11-56 name=__codelineno-11-56 href=#__codelineno-11-56></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONUNBUFFERED</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-11-57 name=__codelineno-11-57 href=#__codelineno-11-57></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONDONTWRITEBYTECODE</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-11-58 name=__codelineno-11-58 href=#__codelineno-11-58></a><span class=k>ENV</span><span class=w> </span><span class=nv>PORT</span><span class=o>=</span><span class=m>8000</span>
<a id=__codelineno-11-59 name=__codelineno-11-59 href=#__codelineno-11-59></a>
<a id=__codelineno-11-60 name=__codelineno-11-60 href=#__codelineno-11-60></a><span class=c># Healthcheck</span>
<a id=__codelineno-11-61 name=__codelineno-11-61 href=#__codelineno-11-61></a><span class=k>HEALTHCHECK</span><span class=w> </span>--interval<span class=o>=</span>30s<span class=w> </span>--timeout<span class=o>=</span>10s<span class=w> </span>--start-period<span class=o>=</span>45s<span class=w> </span>--retries<span class=o>=</span><span class=m>3</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-11-62 name=__codelineno-11-62 href=#__codelineno-11-62></a><span class=w>    </span>CMD<span class=w> </span>curl<span class=w> </span>-f<span class=w> </span>http://localhost:<span class=si>${</span><span class=nv>PORT</span><span class=si>}</span>/health<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-11-63 name=__codelineno-11-63 href=#__codelineno-11-63></a>
<a id=__codelineno-11-64 name=__codelineno-11-64 href=#__codelineno-11-64></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>${PORT}</span>
<a id=__codelineno-11-65 name=__codelineno-11-65 href=#__codelineno-11-65></a>
<a id=__codelineno-11-66 name=__codelineno-11-66 href=#__codelineno-11-66></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;uvicorn&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.fastapi_app:app&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--host&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.0.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--port&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;8000&quot;</span><span class=p>]</span>
</code></pre></div> <hr> <p><a id=135-docker-compose-para-ml></a></p> <h2 id=135-docker-compose-para-ml>13.5 Docker Compose para ML<a class=headerlink href=#135-docker-compose-para-ml title="Permanent link">&para;</a></h2> <h3 id=docker-composedemoyml-portafolio>docker-compose.demo.yml (Portafolio)<a class=headerlink href=#docker-composedemoyml-portafolio title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Docker Compose para demo completa del portafolio</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3.8&quot;</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=nt>services</span><span class=p>:</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>  </span><span class=c1># MLflow Server (central)</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>  </span><span class=nt>mlflow</span><span class=p>:</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/mlflow/mlflow:v2.9.2</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mlflow-server</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;5000:5000&quot;</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mlflow-data:/mlflow</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=w>      </span><span class=no>mlflow server</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=w>      </span><span class=no>--backend-store-uri sqlite:///mlflow/mlflow.db</span>
<a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=w>      </span><span class=no>--default-artifact-root /mlflow/artifacts</span>
<a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=w>      </span><span class=no>--host 0.0.0.0</span>
<a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
<a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost:5000/health&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
<a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-network</span>
<a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a>
<a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=w>  </span><span class=c1># BankChurn API</span>
<a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a><span class=w>  </span><span class=nt>bankchurn</span><span class=p>:</span>
<a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span>
<a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor</span>
<a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
<a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bankchurn-api</span>
<a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8001:8000&quot;</span>
<a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor/models:/app/models:ro</span>
<a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MLFLOW_TRACKING_URI=http://mlflow:5000</span>
<a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
<a id=__codelineno-12-39 name=__codelineno-12-39 href=#__codelineno-12-39></a><span class=w>      </span><span class=nt>mlflow</span><span class=p>:</span>
<a id=__codelineno-12-40 name=__codelineno-12-40 href=#__codelineno-12-40></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<a id=__codelineno-12-41 name=__codelineno-12-41 href=#__codelineno-12-41></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
<a id=__codelineno-12-42 name=__codelineno-12-42 href=#__codelineno-12-42></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-network</span>
<a id=__codelineno-12-43 name=__codelineno-12-43 href=#__codelineno-12-43></a>
<a id=__codelineno-12-44 name=__codelineno-12-44 href=#__codelineno-12-44></a><span class=w>  </span><span class=c1># CarVision API</span>
<a id=__codelineno-12-45 name=__codelineno-12-45 href=#__codelineno-12-45></a><span class=w>  </span><span class=nt>carvision</span><span class=p>:</span>
<a id=__codelineno-12-46 name=__codelineno-12-46 href=#__codelineno-12-46></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span>
<a id=__codelineno-12-47 name=__codelineno-12-47 href=#__codelineno-12-47></a><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./CarVision-Market-Intelligence</span>
<a id=__codelineno-12-48 name=__codelineno-12-48 href=#__codelineno-12-48></a><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
<a id=__codelineno-12-49 name=__codelineno-12-49 href=#__codelineno-12-49></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">carvision-api</span>
<a id=__codelineno-12-50 name=__codelineno-12-50 href=#__codelineno-12-50></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-12-51 name=__codelineno-12-51 href=#__codelineno-12-51></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8002:8000&quot;</span>
<a id=__codelineno-12-52 name=__codelineno-12-52 href=#__codelineno-12-52></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-12-53 name=__codelineno-12-53 href=#__codelineno-12-53></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./CarVision-Market-Intelligence/artifacts:/app/artifacts:ro</span>
<a id=__codelineno-12-54 name=__codelineno-12-54 href=#__codelineno-12-54></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<a id=__codelineno-12-55 name=__codelineno-12-55 href=#__codelineno-12-55></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MLFLOW_TRACKING_URI=http://mlflow:5000</span>
<a id=__codelineno-12-56 name=__codelineno-12-56 href=#__codelineno-12-56></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
<a id=__codelineno-12-57 name=__codelineno-12-57 href=#__codelineno-12-57></a><span class=w>      </span><span class=nt>mlflow</span><span class=p>:</span>
<a id=__codelineno-12-58 name=__codelineno-12-58 href=#__codelineno-12-58></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<a id=__codelineno-12-59 name=__codelineno-12-59 href=#__codelineno-12-59></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
<a id=__codelineno-12-60 name=__codelineno-12-60 href=#__codelineno-12-60></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-network</span>
<a id=__codelineno-12-61 name=__codelineno-12-61 href=#__codelineno-12-61></a>
<a id=__codelineno-12-62 name=__codelineno-12-62 href=#__codelineno-12-62></a><span class=w>  </span><span class=c1># TelecomAI API</span>
<a id=__codelineno-12-63 name=__codelineno-12-63 href=#__codelineno-12-63></a><span class=w>  </span><span class=nt>telecom</span><span class=p>:</span>
<a id=__codelineno-12-64 name=__codelineno-12-64 href=#__codelineno-12-64></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span>
<a id=__codelineno-12-65 name=__codelineno-12-65 href=#__codelineno-12-65></a><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./TelecomAI-Customer-Intelligence</span>
<a id=__codelineno-12-66 name=__codelineno-12-66 href=#__codelineno-12-66></a><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
<a id=__codelineno-12-67 name=__codelineno-12-67 href=#__codelineno-12-67></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">telecom-api</span>
<a id=__codelineno-12-68 name=__codelineno-12-68 href=#__codelineno-12-68></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-12-69 name=__codelineno-12-69 href=#__codelineno-12-69></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8003:8000&quot;</span>
<a id=__codelineno-12-70 name=__codelineno-12-70 href=#__codelineno-12-70></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<a id=__codelineno-12-71 name=__codelineno-12-71 href=#__codelineno-12-71></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MLFLOW_TRACKING_URI=http://mlflow:5000</span>
<a id=__codelineno-12-72 name=__codelineno-12-72 href=#__codelineno-12-72></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
<a id=__codelineno-12-73 name=__codelineno-12-73 href=#__codelineno-12-73></a><span class=w>      </span><span class=nt>mlflow</span><span class=p>:</span>
<a id=__codelineno-12-74 name=__codelineno-12-74 href=#__codelineno-12-74></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
<a id=__codelineno-12-75 name=__codelineno-12-75 href=#__codelineno-12-75></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
<a id=__codelineno-12-76 name=__codelineno-12-76 href=#__codelineno-12-76></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-network</span>
<a id=__codelineno-12-77 name=__codelineno-12-77 href=#__codelineno-12-77></a>
<a id=__codelineno-12-78 name=__codelineno-12-78 href=#__codelineno-12-78></a><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-12-79 name=__codelineno-12-79 href=#__codelineno-12-79></a><span class=w>  </span><span class=nt>mlflow-data</span><span class=p>:</span>
<a id=__codelineno-12-80 name=__codelineno-12-80 href=#__codelineno-12-80></a>
<a id=__codelineno-12-81 name=__codelineno-12-81 href=#__codelineno-12-81></a><span class=nt>networks</span><span class=p>:</span>
<a id=__codelineno-12-82 name=__codelineno-12-82 href=#__codelineno-12-82></a><span class=w>  </span><span class=nt>ml-network</span><span class=p>:</span>
<a id=__codelineno-12-83 name=__codelineno-12-83 href=#__codelineno-12-83></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</code></pre></div> <h3 id=comandos-utiles>Comandos Ãštiles<a class=headerlink href=#comandos-utiles title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1># Construir todas las imÃ¡genes</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>docker<span class=w> </span>compose<span class=w> </span>-f<span class=w> </span>docker-compose.demo.yml<span class=w> </span>build
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=c1># Iniciar todos los servicios</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>docker<span class=w> </span>compose<span class=w> </span>-f<span class=w> </span>docker-compose.demo.yml<span class=w> </span>up<span class=w> </span>-d
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=c1># Ver logs</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>docker<span class=w> </span>compose<span class=w> </span>-f<span class=w> </span>docker-compose.demo.yml<span class=w> </span>logs<span class=w> </span>-f<span class=w> </span>bankchurn
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=c1># Parar todo</span>
<a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>docker<span class=w> </span>compose<span class=w> </span>-f<span class=w> </span>docker-compose.demo.yml<span class=w> </span>down
<a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a>
<a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=c1># Limpiar volÃºmenes tambiÃ©n</span>
<a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>docker<span class=w> </span>compose<span class=w> </span>-f<span class=w> </span>docker-compose.demo.yml<span class=w> </span>down<span class=w> </span>-v
</code></pre></div> <hr> <p><a id=136-docker-compose-avanzado></a></p> <h2 id=136-docker-compose-avanzado-para-mlops-nuevo>13.6 Docker Compose Avanzado para MLOps â­ NUEVO<a class=headerlink href=#136-docker-compose-avanzado-para-mlops-nuevo title="Permanent link">&para;</a></h2> <p>El portafolio usa patrones avanzados de Docker Compose que debes conocer para orquestar stacks ML complejos.</p> <h3 id=1361-profiles-servicios-opcionales>13.6.1 Profiles: Servicios Opcionales<a class=headerlink href=#1361-profiles-servicios-opcionales title="Permanent link">&para;</a></h3> <p>Los <strong>profiles</strong> permiten tener servicios que solo se inician cuando los necesitas (ej: monitoreo):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># docker-compose.demo.yml del portafolio (extracto)</span>
<a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=nt>services</span><span class=p>:</span>
<a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=w>  </span><span class=c1># Servicios principales (sin profile = siempre se inician)</span>
<a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=w>  </span><span class=nt>mlflow</span><span class=p>:</span>
<a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/mlflow/mlflow:v2.9.2</span>
<a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;5000:5000&quot;</span>
<a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>    </span><span class=c1># ...</span>
<a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>
<a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>  </span><span class=nt>bankchurn</span><span class=p>:</span>
<a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor</span>
<a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8001:8000&quot;</span>
<a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=w>    </span><span class=c1># ...</span>
<a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>
<a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=w>  </span><span class=c1># Servicios de monitoreo (profile = monitoring)</span>
<a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span>
<a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:v2.48.0</span>
<a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
<a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;9090:9090&quot;</span>
<a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./infra/prometheus-config.yaml:/etc/prometheus/prometheus.yml:ro</span>
<a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prometheus-data:/prometheus</span>
<a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span>
<a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span>
<a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--storage.tsdb.path=/prometheus&#39;</span>
<a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
<a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-network</span>
<a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
<a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span><span class=w>  </span><span class=c1># â† Solo se inicia con --profile monitoring</span>
<a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a>
<a id=__codelineno-14-33 name=__codelineno-14-33 href=#__codelineno-14-33></a><span class=w>  </span><span class=nt>grafana</span><span class=p>:</span>
<a id=__codelineno-14-34 name=__codelineno-14-34 href=#__codelineno-14-34></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana:10.2.2</span>
<a id=__codelineno-14-35 name=__codelineno-14-35 href=#__codelineno-14-35></a><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
<a id=__codelineno-14-36 name=__codelineno-14-36 href=#__codelineno-14-36></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-14-37 name=__codelineno-14-37 href=#__codelineno-14-37></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
<a id=__codelineno-14-38 name=__codelineno-14-38 href=#__codelineno-14-38></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<a id=__codelineno-14-39 name=__codelineno-14-39 href=#__codelineno-14-39></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GF_SECURITY_ADMIN_USER=admin</span>
<a id=__codelineno-14-40 name=__codelineno-14-40 href=#__codelineno-14-40></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">GF_SECURITY_ADMIN_PASSWORD=admin</span>
<a id=__codelineno-14-41 name=__codelineno-14-41 href=#__codelineno-14-41></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
<a id=__codelineno-14-42 name=__codelineno-14-42 href=#__codelineno-14-42></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span><span class=w>  </span><span class=c1># â† Solo se inicia con --profile monitoring</span>
</code></pre></div> <p><strong>Uso de profiles:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1># Solo servicios principales (sin monitoreo)</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>docker<span class=w> </span>compose<span class=w> </span>-f<span class=w> </span>docker-compose.demo.yml<span class=w> </span>up<span class=w> </span>-d
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=c1># Con monitoreo (Prometheus + Grafana)</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>docker<span class=w> </span>compose<span class=w> </span>-f<span class=w> </span>docker-compose.demo.yml<span class=w> </span>--profile<span class=w> </span>monitoring<span class=w> </span>up<span class=w> </span>-d
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=c1># Ver quÃ© estÃ¡ corriendo</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>docker<span class=w> </span>compose<span class=w> </span>-f<span class=w> </span>docker-compose.demo.yml<span class=w> </span>ps
</code></pre></div> <h3 id=1362-healthchecks-avanzados-y-dependencies>13.6.2 Healthchecks Avanzados y Dependencies<a class=headerlink href=#1362-healthchecks-avanzados-y-dependencies title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=nt>services</span><span class=p>:</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=w>  </span><span class=nt>mlflow</span><span class=p>:</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/mlflow/mlflow:v2.9.2</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;python&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;import</span><span class=nv> </span><span class=s>urllib.request;</span><span class=nv> </span><span class=s>urllib.request.urlopen(&#39;http://localhost:5000/health&#39;)&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=w>      </span><span class=nt>start_period</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span><span class=w>  </span><span class=c1># â† Da tiempo para que el servicio arranque</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=w>  </span><span class=nt>bankchurn</span><span class=p>:</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=w>      </span><span class=nt>mlflow</span><span class=p>:</span>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span><span class=w>  </span><span class=c1># â† Espera a que MLflow estÃ© healthy</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost:8000/health&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=w>      </span><span class=nt>start_period</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">45s</span><span class=w>  </span><span class=c1># â† El modelo tarda en cargar</span>
<a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a>
<a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a><span class=w>  </span><span class=nt>carvision-dashboard</span><span class=p>:</span>
<a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-portfolio-carvision:latest</span>
<a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;streamlit&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;run&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;app/streamlit_app.py&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--server.port&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;8501&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-16-26 name=__codelineno-16-26 href=#__codelineno-16-26></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
<a id=__codelineno-16-27 name=__codelineno-16-27 href=#__codelineno-16-27></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">carvision</span><span class=w>  </span><span class=c1># â† Espera a que la API estÃ© disponible (no healthy)</span>
<a id=__codelineno-16-28 name=__codelineno-16-28 href=#__codelineno-16-28></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
<a id=__codelineno-16-29 name=__codelineno-16-29 href=#__codelineno-16-29></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost:8501/_stcore/health&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-16-30 name=__codelineno-16-30 href=#__codelineno-16-30></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-16-31 name=__codelineno-16-31 href=#__codelineno-16-31></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<a id=__codelineno-16-32 name=__codelineno-16-32 href=#__codelineno-16-32></a><span class=w>      </span><span class=nt>start_period</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">60s</span><span class=w>  </span><span class=c1># â† Streamlit tarda mÃ¡s</span>
</code></pre></div> <h3 id=1363-networking-para-microservicios-ml>13.6.3 Networking para Microservicios ML<a class=headerlink href=#1363-networking-para-microservicios-ml title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nt>services</span><span class=p>:</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=w>  </span><span class=c1># Servicios internos se comunican por nombre</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=w>  </span><span class=nt>bankchurn</span><span class=p>:</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-network</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MLFLOW_TRACKING_URI=http://mlflow:5000</span><span class=w>  </span><span class=c1># â† Usa nombre del servicio</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>  </span><span class=nt>carvision</span><span class=p>:</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-network</span>
<a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MLFLOW_TRACKING_URI=http://mlflow:5000</span>
<a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a>
<a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=nt>networks</span><span class=p>:</span>
<a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=w>  </span><span class=nt>ml-network</span><span class=p>:</span>
<a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
<a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-mlops-network</span><span class=w>  </span><span class=c1># â† Nombre explÃ­cito para debugging</span>
</code></pre></div> <p><strong>Debugging de networking:</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Ver la red y sus contenedores</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>docker<span class=w> </span>network<span class=w> </span>inspect<span class=w> </span>ml-mlops-network
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=c1># Probar conectividad desde un contenedor</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>bankchurn-api<span class=w> </span>curl<span class=w> </span>http://mlflow:5000/health
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=c1># Ver logs de un servicio especÃ­fico</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>docker<span class=w> </span>compose<span class=w> </span>logs<span class=w> </span>-f<span class=w> </span>bankchurn
</code></pre></div> <h3 id=1364-volumes-para-persistencia-y-desarrollo>13.6.4 Volumes para Persistencia y Desarrollo<a class=headerlink href=#1364-volumes-para-persistencia-y-desarrollo title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nt>services</span><span class=p>:</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=w>  </span><span class=nt>mlflow</span><span class=p>:</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>      </span><span class=c1># Named volume para persistencia (sobrevive a `down`)</span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mlflow-artifacts:/mlflow</span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>      </span><span class=c1># Bind mount para acceder a runs locales</span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./mlruns:/mlruns</span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>  </span><span class=nt>bankchurn</span><span class=p>:</span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>      </span><span class=c1># Read-only para datos (evita modificaciones accidentales)</span>
<a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor/data:/app/data:ro</span>
<a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>      </span><span class=c1># Read-only para modelos</span>
<a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor/models:/app/models:ro</span>
<a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a>
<a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=w>  </span><span class=c1># Para DESARROLLO: hot-reload del cÃ³digo</span>
<a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=w>  </span><span class=nt>bankchurn-dev</span><span class=p>:</span>
<a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor</span>
<a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=w>      </span><span class=c1># Monta cÃ³digo fuente para hot-reload</span>
<a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor/src:/app/src</span>
<a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor/app:/app/app</span>
<a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;uvicorn&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;app.fastapi_app:app&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--reload&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--host&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;0.0.0.0&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
<a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">dev</span>
<a id=__codelineno-19-26 name=__codelineno-19-26 href=#__codelineno-19-26></a>
<a id=__codelineno-19-27 name=__codelineno-19-27 href=#__codelineno-19-27></a><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-19-28 name=__codelineno-19-28 href=#__codelineno-19-28></a><span class=w>  </span><span class=nt>mlflow-artifacts</span><span class=p>:</span>
<a id=__codelineno-19-29 name=__codelineno-19-29 href=#__codelineno-19-29></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<a id=__codelineno-19-30 name=__codelineno-19-30 href=#__codelineno-19-30></a><span class=w>  </span><span class=nt>prometheus-data</span><span class=p>:</span>
<a id=__codelineno-19-31 name=__codelineno-19-31 href=#__codelineno-19-31></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<a id=__codelineno-19-32 name=__codelineno-19-32 href=#__codelineno-19-32></a><span class=w>  </span><span class=nt>grafana-data</span><span class=p>:</span>
<a id=__codelineno-19-33 name=__codelineno-19-33 href=#__codelineno-19-33></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</code></pre></div> <h3 id=1365-variables-de-entorno-y-secrets>13.6.5 Variables de Entorno y Secrets<a class=headerlink href=#1365-variables-de-entorno-y-secrets title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=nt>services</span><span class=p>:</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=w>  </span><span class=nt>bankchurn</span><span class=p>:</span>
<a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>      </span><span class=c1># Variables inline</span>
<a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PYTHONUNBUFFERED=1</span>
<a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">LOG_LEVEL=INFO</span>
<a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>      </span><span class=c1># Variables desde archivo .env</span>
<a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MLFLOW_TRACKING_URI=${MLFLOW_TRACKING_URI:-http://mlflow:5000}</span>
<a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>    </span><span class=nt>env_file</span><span class=p>:</span>
<a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.env</span><span class=w>  </span><span class=c1># â† Carga todas las variables de .env</span>
<a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a>
<a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=c1># .env (NO commitear a Git)</span>
<a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=c1># MLFLOW_TRACKING_URI=http://mlflow:5000</span>
<a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=c1># DB_PASSWORD=supersecret</span>
</code></pre></div> <h3 id=1366-el-stack-completo-del-portafolio>13.6.6 El Stack Completo del Portafolio<a class=headerlink href=#1366-el-stack-completo-del-portafolio title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>â”‚                    STACK DOCKER COMPOSE DEL PORTAFOLIO                          â”‚
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>â”‚                                                                                 â”‚
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>â”‚  SERVICIOS PRINCIPALES (siempre activos):                                       â”‚
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>â”‚                                                                                 â”‚
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
<a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>â”‚  â”‚ MLflow       â”‚     â”‚ BankChurn    â”‚     â”‚ CarVision    â”‚                     â”‚
<a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>â”‚  â”‚ :5000        â”‚â—„â”€â”€â”€â”€â”‚ API :8001    â”‚     â”‚ API :8002    â”‚                     â”‚
<a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>â”‚  â”‚              â”‚     â”‚              â”‚     â”‚              â”‚                     â”‚
<a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>â”‚  â”‚ Tracking +   â”‚     â”‚ /predict     â”‚     â”‚ /predict     â”‚                     â”‚
<a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>â”‚  â”‚ Artifacts    â”‚â—„â”€â”€â”€â”€â”¤ /health      â”‚     â”‚ /health      â”‚                     â”‚
<a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
<a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>â”‚         â–²                                         â”‚                             â”‚
<a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>â”‚         â”‚                                         â–¼                             â”‚
<a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>â”‚         â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
<a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>â”‚         â”‚             â”‚ TelecomAI    â”‚     â”‚ CarVision    â”‚                     â”‚
<a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ API :8003    â”‚     â”‚ Dashboard    â”‚                     â”‚
<a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>â”‚                       â”‚              â”‚     â”‚ :8501        â”‚                     â”‚
<a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a>â”‚                       â”‚ /predict     â”‚     â”‚              â”‚                     â”‚
<a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a>â”‚                       â”‚ /health      â”‚     â”‚ Streamlit    â”‚                     â”‚
<a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
<a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a>â”‚                                                                                 â”‚
<a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a>â”‚  SERVICIOS DE MONITOREO (--profile monitoring):                                 â”‚
<a id=__codelineno-21-26 name=__codelineno-21-26 href=#__codelineno-21-26></a>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
<a id=__codelineno-21-27 name=__codelineno-21-27 href=#__codelineno-21-27></a>â”‚                                                                                 â”‚
<a id=__codelineno-21-28 name=__codelineno-21-28 href=#__codelineno-21-28></a>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
<a id=__codelineno-21-29 name=__codelineno-21-29 href=#__codelineno-21-29></a>â”‚  â”‚ Prometheus   â”‚â”€â”€â”€â”€â–ºâ”‚ Grafana      â”‚                                          â”‚
<a id=__codelineno-21-30 name=__codelineno-21-30 href=#__codelineno-21-30></a>â”‚  â”‚ :9090        â”‚     â”‚ :3000        â”‚                                          â”‚
<a id=__codelineno-21-31 name=__codelineno-21-31 href=#__codelineno-21-31></a>â”‚  â”‚              â”‚     â”‚              â”‚                                          â”‚
<a id=__codelineno-21-32 name=__codelineno-21-32 href=#__codelineno-21-32></a>â”‚  â”‚ Scrape       â”‚     â”‚ Dashboards   â”‚                                          â”‚
<a id=__codelineno-21-33 name=__codelineno-21-33 href=#__codelineno-21-33></a>â”‚  â”‚ /metrics     â”‚     â”‚ + Alertas    â”‚                                          â”‚
<a id=__codelineno-21-34 name=__codelineno-21-34 href=#__codelineno-21-34></a>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
<a id=__codelineno-21-35 name=__codelineno-21-35 href=#__codelineno-21-35></a>â”‚                                                                                 â”‚
<a id=__codelineno-21-36 name=__codelineno-21-36 href=#__codelineno-21-36></a>â”‚  RED: ml-mlops-network (bridge)                                                 â”‚
<a id=__codelineno-21-37 name=__codelineno-21-37 href=#__codelineno-21-37></a>â”‚  VOLUMES: mlflow-artifacts, prometheus-data, grafana-data                       â”‚
<a id=__codelineno-21-38 name=__codelineno-21-38 href=#__codelineno-21-38></a>â”‚                                                                                 â”‚
<a id=__codelineno-21-39 name=__codelineno-21-39 href=#__codelineno-21-39></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div> <h3 id=ejercicio-crear-tu-stack-docker-compose>ğŸ”§ Ejercicio: Crear Tu Stack Docker Compose<a class=headerlink href=#ejercicio-crear-tu-stack-docker-compose title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># 1. Crear estructura bÃ¡sica</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>mkdir<span class=w> </span>-p<span class=w> </span>my-ml-stack/<span class=o>{</span>api,data,models<span class=o>}</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=c1># 2. Crear docker-compose.yml</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>cat<span class=w> </span>&gt;<span class=w> </span>my-ml-stack/docker-compose.yml<span class=w> </span><span class=s>&lt;&lt; &#39;EOF&#39;</span>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=s>services:</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=s>  api:</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=s>    build: ./api</span>
<a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=s>    ports:</span>
<a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=s>      - &quot;8000:8000&quot;</span>
<a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=s>    volumes:</span>
<a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=s>      - ./models:/app/models:ro</span>
<a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=s>    healthcheck:</span>
<a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=s>      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:8000/health&quot;]</span>
<a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=s>      interval: 30s</span>
<a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=s>      timeout: 10s</span>
<a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=s>      start_period: 30s</span>
<a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=s>    environment:</span>
<a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a><span class=s>      - MODEL_PATH=/app/models/model.joblib</span>
<a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a>
<a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=s>  mlflow:</span>
<a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a><span class=s>    image: ghcr.io/mlflow/mlflow:v2.9.2</span>
<a id=__codelineno-22-23 name=__codelineno-22-23 href=#__codelineno-22-23></a><span class=s>    ports:</span>
<a id=__codelineno-22-24 name=__codelineno-22-24 href=#__codelineno-22-24></a><span class=s>      - &quot;5000:5000&quot;</span>
<a id=__codelineno-22-25 name=__codelineno-22-25 href=#__codelineno-22-25></a><span class=s>    volumes:</span>
<a id=__codelineno-22-26 name=__codelineno-22-26 href=#__codelineno-22-26></a><span class=s>      - mlflow-data:/mlflow</span>
<a id=__codelineno-22-27 name=__codelineno-22-27 href=#__codelineno-22-27></a><span class=s>    command: mlflow server --host 0.0.0.0 --port 5000</span>
<a id=__codelineno-22-28 name=__codelineno-22-28 href=#__codelineno-22-28></a>
<a id=__codelineno-22-29 name=__codelineno-22-29 href=#__codelineno-22-29></a><span class=s>volumes:</span>
<a id=__codelineno-22-30 name=__codelineno-22-30 href=#__codelineno-22-30></a><span class=s>  mlflow-data:</span>
<a id=__codelineno-22-31 name=__codelineno-22-31 href=#__codelineno-22-31></a><span class=s>EOF</span>
<a id=__codelineno-22-32 name=__codelineno-22-32 href=#__codelineno-22-32></a>
<a id=__codelineno-22-33 name=__codelineno-22-33 href=#__codelineno-22-33></a><span class=c1># 3. Probar el stack</span>
<a id=__codelineno-22-34 name=__codelineno-22-34 href=#__codelineno-22-34></a>docker<span class=w> </span>compose<span class=w> </span>up<span class=w> </span>-d
<a id=__codelineno-22-35 name=__codelineno-22-35 href=#__codelineno-22-35></a>docker<span class=w> </span>compose<span class=w> </span>ps
<a id=__codelineno-22-36 name=__codelineno-22-36 href=#__codelineno-22-36></a>docker<span class=w> </span>compose<span class=w> </span>logs<span class=w> </span>-f<span class=w> </span>api
</code></pre></div> <hr> <p><a id=137-ingenieria-inversa-pedagogica></a></p> <h2 id=137-ingenieria-inversa-pedagogica-dockerfile-del-portafolio>13.7 ğŸ”¬ IngenierÃ­a Inversa PedagÃ³gica: Dockerfile del Portafolio<a class=headerlink href=#137-ingenieria-inversa-pedagogica-dockerfile-del-portafolio title="Permanent link">&para;</a></h2> <blockquote> <p><strong>Objetivo</strong>: Entender EXACTAMENTE por quÃ© cada lÃ­nea existe en el Dockerfile real de <code>BankChurn-Predictor/Dockerfile</code> del portafolio.</p> </blockquote> <p>Esta secciÃ³n aplica el mÃ©todo de "Shadow Coder Senior": no solo vemos la herramienta, sino las <strong>decisiones arquitectÃ³nicas</strong> tomadas en producciÃ³n.</p> <hr> <h3 id=1371-el-por-que-arquitectonico>13.7.1 ğŸ¯ El "Por QuÃ©" ArquitectÃ³nico<a class=headerlink href=#1371-el-por-que-arquitectonico title="Permanent link">&para;</a></h3> <p>Antes de escribir una sola lÃ­nea de Docker, pregÃºntate: <strong>Â¿quÃ© problema estoy resolviendo?</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>â”‚                    DECISIONES ARQUITECTÃ“NICAS DEL PORTAFOLIO                    â”‚
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>â”‚                                                                                 â”‚
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>â”‚  PROBLEMA 1: ImÃ¡genes de 1.5GB que tardan 10min en desplegar                    â”‚
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>â”‚  DECISIÃ“N: Multi-stage build con python:3.11-slim                               â”‚
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>â”‚  RESULTADO: Imagen final de ~350MB (77% mÃ¡s pequeÃ±a)                            â”‚
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>â”‚  REFERENCIA: BankChurn-Predictor/Dockerfile lÃ­neas 1-40                         â”‚
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a>â”‚                                                                                 â”‚
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>â”‚  PROBLEMA 2: Contenedores comprometidos = acceso root al host                   â”‚
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a>â”‚  DECISIÃ“N: Usuario non-root con UID 1000 (appuser)                              â”‚
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>â”‚  RESULTADO: Atacante limitado a permisos de usuario sin privilegios             â”‚
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a>â”‚  REFERENCIA: BankChurn-Predictor/Dockerfile lÃ­neas 55-74                        â”‚
<a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a>â”‚                                                                                 â”‚
<a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a>â”‚  PROBLEMA 3: Orquestadores no saben si la API estÃ¡ lista                        â”‚
<a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
<a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a>â”‚  DECISIÃ“N: HEALTHCHECK que valida /health cada 30s                              â”‚
<a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a>â”‚  RESULTADO: K8s/Docker Compose esperan a que el modelo cargue                   â”‚
<a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>â”‚  REFERENCIA: BankChurn-Predictor/Dockerfile lÃ­neas 79-81                        â”‚
<a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a>â”‚                                                                                 â”‚
<a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a>â”‚  PROBLEMA 4: Cache de Docker invalidado en cada cambio de cÃ³digo                â”‚
<a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
<a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a>â”‚  DECISIÃ“N: COPY requirements.txt ANTES de COPY cÃ³digo fuente                    â”‚
<a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a>â”‚  RESULTADO: pip install cacheado si solo cambias cÃ³digo                         â”‚
<a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a>â”‚  REFERENCIA: BankChurn-Predictor/Dockerfile lÃ­neas 25-37                        â”‚
<a id=__codelineno-23-28 name=__codelineno-23-28 href=#__codelineno-23-28></a>â”‚                                                                                 â”‚
<a id=__codelineno-23-29 name=__codelineno-23-29 href=#__codelineno-23-29></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div> <p><strong>ğŸ¤” Pregunta para reflexionar</strong>: Â¿Por quÃ© NO usamos <code>python:3.11-alpine</code> en el portafolio?</p> <details> <summary>ğŸ’¡ Ver respuesta</summary> Alpine usa `musl` en lugar de `glibc`. Muchas librerÃ­as de ML (NumPy, pandas, scikit-learn) tienen binarios precompilados para `glibc` pero NO para `musl`. Esto significa: - CompilaciÃ³n desde source â†’ builds de 20+ minutos - Posibles errores de compatibilidad con extensiones C - `slim` es solo ~50MB mÃ¡s grande pero 100% compatible **DecisiÃ³n del portafolio**: Preferimos `slim` por compatibilidad garantizada. </details> <hr> <h3 id=1372-anatomia-linea-por-linea-bankchurn-predictordockerfile>13.7.2 ğŸ” AnatomÃ­a LÃ­nea por LÃ­nea: <code>BankChurn-Predictor/Dockerfile</code><a class=headerlink href=#1372-anatomia-linea-por-linea-bankchurn-predictordockerfile title="Permanent link">&para;</a></h3> <p>A continuaciÃ³n, el Dockerfile REAL del portafolio con explicaciÃ³n de CADA lÃ­nea crÃ­tica y quÃ© pasa si la omites.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=c># STAGE 1: BUILDER - Compila dependencias en entorno temporal</span>
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=c># LÃ­nea 1-3: Imagen base para compilaciÃ³n</span>
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=c># FROM python:3.11-slim AS builder</span>
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=c>#   â”œâ”€ python:3.11-slim  â†’ Imagen Debian mÃ­nima (~150MB vs ~1GB de python:3.11)</span>
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=c>#   â”œâ”€ AS builder        â†’ Nombra este stage para referenciarlo despuÃ©s</span>
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin AS? â†’ No podrÃ­as hacer COPY --from=builder mÃ¡s adelante</span>
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>builder</span>
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=c># LÃ­neas 5-8: Metadatos de la imagen (LABEL)</span>
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=c># LABEL maintainer=&quot;...&quot;</span>
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=c>#   â”œâ”€ Documenta quiÃ©n mantiene la imagen</span>
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=c>#   â”œâ”€ Visible con: docker inspect &lt;imagen&gt;</span>
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Funciona, pero pierdes trazabilidad en producciÃ³n</span>
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a><span class=k>LABEL</span><span class=w> </span><span class=nv>maintainer</span><span class=o>=</span><span class=s2>&quot;Daniel Duque &lt;daniel.duque@example.com&gt;&quot;</span>
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a><span class=k>LABEL</span><span class=w> </span><span class=nv>version</span><span class=o>=</span><span class=s2>&quot;1.0.0&quot;</span>
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a><span class=k>LABEL</span><span class=w> </span><span class=nv>description</span><span class=o>=</span><span class=s2>&quot;BankChurn Predictor - Sistema de predicciÃ³n de abandono bancario&quot;</span>
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a><span class=c># LÃ­neas 10-14: Variables de entorno de build</span>
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a><span class=c># ENV PYTHONUNBUFFERED=1</span>
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a><span class=c>#   â”œâ”€ PYTHONUNBUFFERED=1  â†’ Logs se muestran inmediatamente (sin buffering)</span>
<a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a><span class=c>#   â”œâ”€ PYTHONDONTWRITEBYTECODE=1 â†’ No genera __pycache__/*.pyc (imagen mÃ¡s limpia)</span>
<a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a><span class=c>#   â”œâ”€ PIP_NO_CACHE_DIR=1  â†’ pip no guarda cache (reduce tamaÃ±o de imagen)</span>
<a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a><span class=c>#   â””â”€ PIP_DISABLE_PIP_VERSION_CHECK=1 â†’ No verifica actualizaciones (build mÃ¡s rÃ¡pido)</span>
<a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONUNBUFFERED</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONDONTWRITEBYTECODE</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a><span class=k>ENV</span><span class=w> </span><span class=nv>PIP_NO_CACHE_DIR</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-24-33 name=__codelineno-24-33 href=#__codelineno-24-33></a><span class=k>ENV</span><span class=w> </span><span class=nv>PIP_DISABLE_PIP_VERSION_CHECK</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-24-34 name=__codelineno-24-34 href=#__codelineno-24-34></a>
<a id=__codelineno-24-35 name=__codelineno-24-35 href=#__codelineno-24-35></a><span class=c># LÃ­nea 16: Directorio de trabajo para compilaciÃ³n</span>
<a id=__codelineno-24-36 name=__codelineno-24-36 href=#__codelineno-24-36></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-37 name=__codelineno-24-37 href=#__codelineno-24-37></a><span class=c># WORKDIR /build</span>
<a id=__codelineno-24-38 name=__codelineno-24-38 href=#__codelineno-24-38></a><span class=c>#   â”œâ”€ Crea /build si no existe y lo establece como CWD</span>
<a id=__codelineno-24-39 name=__codelineno-24-39 href=#__codelineno-24-39></a><span class=c>#   â”œâ”€ Separado de /app para claridad (build vs runtime)</span>
<a id=__codelineno-24-40 name=__codelineno-24-40 href=#__codelineno-24-40></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Archivos van a / (raÃ­z), muy desordenado</span>
<a id=__codelineno-24-41 name=__codelineno-24-41 href=#__codelineno-24-41></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/build</span>
<a id=__codelineno-24-42 name=__codelineno-24-42 href=#__codelineno-24-42></a>
<a id=__codelineno-24-43 name=__codelineno-24-43 href=#__codelineno-24-43></a><span class=c># LÃ­neas 18-23: Instalar dependencias de compilaciÃ³n (TEMPORALES)</span>
<a id=__codelineno-24-44 name=__codelineno-24-44 href=#__codelineno-24-44></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-45 name=__codelineno-24-45 href=#__codelineno-24-45></a><span class=c># RUN apt-get update &amp;&amp; apt-get install -y ...</span>
<a id=__codelineno-24-46 name=__codelineno-24-46 href=#__codelineno-24-46></a><span class=c>#   â”œâ”€ gcc, g++, build-essential â†’ Compiladores para paquetes con cÃ³digo C/C++</span>
<a id=__codelineno-24-47 name=__codelineno-24-47 href=#__codelineno-24-47></a><span class=c>#   â”œâ”€ --no-install-recommends   â†’ Solo deps esenciales (reduce 200MB+)</span>
<a id=__codelineno-24-48 name=__codelineno-24-48 href=#__codelineno-24-48></a><span class=c>#   â”œâ”€ rm -rf /var/lib/apt/lists/* â†’ Elimina cache de apt (reduce ~30MB)</span>
<a id=__codelineno-24-49 name=__codelineno-24-49 href=#__codelineno-24-49></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin gcc? â†’ Paquetes como numpy, pandas fallan al instalar</span>
<a id=__codelineno-24-50 name=__codelineno-24-50 href=#__codelineno-24-50></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-51 name=__codelineno-24-51 href=#__codelineno-24-51></a><span class=w>    </span>gcc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-52 name=__codelineno-24-52 href=#__codelineno-24-52></a><span class=w>    </span>g++<span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-53 name=__codelineno-24-53 href=#__codelineno-24-53></a><span class=w>    </span>build-essential<span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-54 name=__codelineno-24-54 href=#__codelineno-24-54></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-24-55 name=__codelineno-24-55 href=#__codelineno-24-55></a>
<a id=__codelineno-24-56 name=__codelineno-24-56 href=#__codelineno-24-56></a><span class=c># LÃ­neas 25-26: Copiar requirements (ANTES del cÃ³digo)</span>
<a id=__codelineno-24-57 name=__codelineno-24-57 href=#__codelineno-24-57></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-58 name=__codelineno-24-58 href=#__codelineno-24-58></a><span class=c># COPY requirements.txt requirements.in* ./</span>
<a id=__codelineno-24-59 name=__codelineno-24-59 href=#__codelineno-24-59></a><span class=c>#   â”œâ”€ requirements.txt  â†’ Archivo principal de dependencias</span>
<a id=__codelineno-24-60 name=__codelineno-24-60 href=#__codelineno-24-60></a><span class=c>#   â”œâ”€ requirements.in*  â†’ Asterisco = copia si existe, no falla si no</span>
<a id=__codelineno-24-61 name=__codelineno-24-61 href=#__codelineno-24-61></a><span class=c>#   â”œâ”€ Orden crÃ­tico: requirements ANTES de cÃ³digo fuente</span>
<a id=__codelineno-24-62 name=__codelineno-24-62 href=#__codelineno-24-62></a><span class=c>#   â””â”€ Â¿Por quÃ©? â†’ Si solo cambias cÃ³digo, esta capa estÃ¡ cacheada â†’ build 10x mÃ¡s rÃ¡pido</span>
<a id=__codelineno-24-63 name=__codelineno-24-63 href=#__codelineno-24-63></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>requirements.in*<span class=w> </span>./
<a id=__codelineno-24-64 name=__codelineno-24-64 href=#__codelineno-24-64></a>
<a id=__codelineno-24-65 name=__codelineno-24-65 href=#__codelineno-24-65></a><span class=c># LÃ­neas 28-37: Crear virtualenv e instalar dependencias</span>
<a id=__codelineno-24-66 name=__codelineno-24-66 href=#__codelineno-24-66></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-67 name=__codelineno-24-67 href=#__codelineno-24-67></a><span class=c># RUN python -m venv /opt/venv &amp;&amp; ...</span>
<a id=__codelineno-24-68 name=__codelineno-24-68 href=#__codelineno-24-68></a><span class=c>#   â”œâ”€ /opt/venv â†’ Virtualenv aislado en ubicaciÃ³n estÃ¡ndar</span>
<a id=__codelineno-24-69 name=__codelineno-24-69 href=#__codelineno-24-69></a><span class=c>#   â”œâ”€ . /opt/venv/bin/activate â†’ Activa el venv para pip install</span>
<a id=__codelineno-24-70 name=__codelineno-24-70 href=#__codelineno-24-70></a><span class=c>#   â”œâ”€ sed ... requirements_clean.txt â†’ Limpia hashes y lÃ­neas vacÃ­as</span>
<a id=__codelineno-24-71 name=__codelineno-24-71 href=#__codelineno-24-71></a><span class=c>#   â”œâ”€ pip install --no-cache-dir â†’ Instala sin guardar cache</span>
<a id=__codelineno-24-72 name=__codelineno-24-72 href=#__codelineno-24-72></a><span class=c>#   â””â”€ Â¿Por quÃ© virtualenv? â†’ FÃ¡cil de copiar a runtime stage con COPY --from</span>
<a id=__codelineno-24-73 name=__codelineno-24-73 href=#__codelineno-24-73></a><span class=k>RUN</span><span class=w> </span>python<span class=w> </span>-m<span class=w> </span>venv<span class=w> </span>/opt/venv<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-74 name=__codelineno-24-74 href=#__codelineno-24-74></a><span class=w>    </span>.<span class=w> </span>/opt/venv/bin/activate<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-75 name=__codelineno-24-75 href=#__codelineno-24-75></a><span class=w>    </span>pip<span class=w> </span>install<span class=w> </span>--upgrade<span class=w> </span>pip<span class=w> </span>setuptools<span class=w> </span>wheel<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-76 name=__codelineno-24-76 href=#__codelineno-24-76></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>-f<span class=w> </span>requirements.in<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-77 name=__codelineno-24-77 href=#__codelineno-24-77></a><span class=w>        </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/--hash=/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s/ \\$//&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/^[[:space:]]*#/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/^[[:space:]]*$/d&#39;</span><span class=w> </span>requirements.in<span class=w> </span>&gt;<span class=w> </span>requirements_clean.txt<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-78 name=__codelineno-24-78 href=#__codelineno-24-78></a><span class=w>    </span><span class=k>else</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-79 name=__codelineno-24-79 href=#__codelineno-24-79></a><span class=w>        </span>sed<span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/--hash=/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;s/ \\$//&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/^[[:space:]]*#/d&#39;</span><span class=w> </span>-e<span class=w> </span><span class=s1>&#39;/^[[:space:]]*$/d&#39;</span><span class=w> </span>requirements.txt<span class=w> </span>&gt;<span class=w> </span>requirements_clean.txt<span class=p>;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-80 name=__codelineno-24-80 href=#__codelineno-24-80></a><span class=w>    </span><span class=k>fi</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-81 name=__codelineno-24-81 href=#__codelineno-24-81></a><span class=w>    </span>pip<span class=w> </span>install<span class=w> </span>--no-cache-dir<span class=w> </span>-r<span class=w> </span>requirements_clean.txt
<a id=__codelineno-24-82 name=__codelineno-24-82 href=#__codelineno-24-82></a>
<a id=__codelineno-24-83 name=__codelineno-24-83 href=#__codelineno-24-83></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-24-84 name=__codelineno-24-84 href=#__codelineno-24-84></a><span class=c># STAGE 2: RUNTIME - Imagen final ligera sin compiladores</span>
<a id=__codelineno-24-85 name=__codelineno-24-85 href=#__codelineno-24-85></a><span class=c># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-24-86 name=__codelineno-24-86 href=#__codelineno-24-86></a>
<a id=__codelineno-24-87 name=__codelineno-24-87 href=#__codelineno-24-87></a><span class=c># LÃ­nea 40: Nueva imagen limpia para runtime</span>
<a id=__codelineno-24-88 name=__codelineno-24-88 href=#__codelineno-24-88></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-89 name=__codelineno-24-89 href=#__codelineno-24-89></a><span class=c># FROM python:3.11-slim AS runtime</span>
<a id=__codelineno-24-90 name=__codelineno-24-90 href=#__codelineno-24-90></a><span class=c>#   â”œâ”€ Nueva imagen desde cero (SIN gcc, g++, build-essential)</span>
<a id=__codelineno-24-91 name=__codelineno-24-91 href=#__codelineno-24-91></a><span class=c>#   â”œâ”€ Solo contiene lo que explÃ­citamente copiamos</span>
<a id=__codelineno-24-92 name=__codelineno-24-92 href=#__codelineno-24-92></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin multi-stage? â†’ Imagen final de 1.2GB con compiladores innecesarios</span>
<a id=__codelineno-24-93 name=__codelineno-24-93 href=#__codelineno-24-93></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>runtime</span>
<a id=__codelineno-24-94 name=__codelineno-24-94 href=#__codelineno-24-94></a>
<a id=__codelineno-24-95 name=__codelineno-24-95 href=#__codelineno-24-95></a><span class=c># LÃ­neas 42-46: Variables de entorno de runtime</span>
<a id=__codelineno-24-96 name=__codelineno-24-96 href=#__codelineno-24-96></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-97 name=__codelineno-24-97 href=#__codelineno-24-97></a><span class=c># ENV PYTHONPATH=/app</span>
<a id=__codelineno-24-98 name=__codelineno-24-98 href=#__codelineno-24-98></a><span class=c>#   â”œâ”€ PYTHONPATH=/app â†’ Python puede importar desde /app (import src.bankchurn)</span>
<a id=__codelineno-24-99 name=__codelineno-24-99 href=#__codelineno-24-99></a><span class=c>#   â”œâ”€ PATH=&quot;/opt/venv/bin:$PATH&quot; â†’ Comandos del venv disponibles sin activar</span>
<a id=__codelineno-24-100 name=__codelineno-24-100 href=#__codelineno-24-100></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin PYTHONPATH? â†’ ImportError: No module named &#39;src&#39;</span>
<a id=__codelineno-24-101 name=__codelineno-24-101 href=#__codelineno-24-101></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONUNBUFFERED</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-24-102 name=__codelineno-24-102 href=#__codelineno-24-102></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONDONTWRITEBYTECODE</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-24-103 name=__codelineno-24-103 href=#__codelineno-24-103></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONPATH</span><span class=o>=</span>/app
<a id=__codelineno-24-104 name=__codelineno-24-104 href=#__codelineno-24-104></a><span class=k>ENV</span><span class=w> </span><span class=nv>PATH</span><span class=o>=</span><span class=s2>&quot;/opt/venv/bin:</span><span class=nv>$PATH</span><span class=s2>&quot;</span>
<a id=__codelineno-24-105 name=__codelineno-24-105 href=#__codelineno-24-105></a>
<a id=__codelineno-24-106 name=__codelineno-24-106 href=#__codelineno-24-106></a><span class=c># LÃ­neas 48-53: Dependencias mÃ­nimas de runtime</span>
<a id=__codelineno-24-107 name=__codelineno-24-107 href=#__codelineno-24-107></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-108 name=__codelineno-24-108 href=#__codelineno-24-108></a><span class=c># RUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends curl ...</span>
<a id=__codelineno-24-109 name=__codelineno-24-109 href=#__codelineno-24-109></a><span class=c>#   â”œâ”€ curl â†’ Necesario para HEALTHCHECK (CMD curl -f http://...)</span>
<a id=__codelineno-24-110 name=__codelineno-24-110 href=#__codelineno-24-110></a><span class=c>#   â”œâ”€ ca-certificates â†’ Para conexiones HTTPS (MLflow, APIs externas)</span>
<a id=__codelineno-24-111 name=__codelineno-24-111 href=#__codelineno-24-111></a><span class=c>#   â”œâ”€ apt-get clean â†’ Limpia cache adicional</span>
<a id=__codelineno-24-112 name=__codelineno-24-112 href=#__codelineno-24-112></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin curl? â†’ HEALTHCHECK falla â†’ contenedor marcado &quot;unhealthy&quot;</span>
<a id=__codelineno-24-113 name=__codelineno-24-113 href=#__codelineno-24-113></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-114 name=__codelineno-24-114 href=#__codelineno-24-114></a><span class=w>    </span>curl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-115 name=__codelineno-24-115 href=#__codelineno-24-115></a><span class=w>    </span>ca-certificates<span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-116 name=__codelineno-24-116 href=#__codelineno-24-116></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*<span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-117 name=__codelineno-24-117 href=#__codelineno-24-117></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>clean
<a id=__codelineno-24-118 name=__codelineno-24-118 href=#__codelineno-24-118></a>
<a id=__codelineno-24-119 name=__codelineno-24-119 href=#__codelineno-24-119></a><span class=c># LÃ­neas 55-57: SEGURIDAD - Crear usuario non-root</span>
<a id=__codelineno-24-120 name=__codelineno-24-120 href=#__codelineno-24-120></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-121 name=__codelineno-24-121 href=#__codelineno-24-121></a><span class=c># RUN groupadd -r appuser --gid=1000 &amp;&amp; useradd ...</span>
<a id=__codelineno-24-122 name=__codelineno-24-122 href=#__codelineno-24-122></a><span class=c>#   â”œâ”€ groupadd -r â†’ Crea grupo &quot;system&quot; (sin home dir por defecto)</span>
<a id=__codelineno-24-123 name=__codelineno-24-123 href=#__codelineno-24-123></a><span class=c>#   â”œâ”€ --gid=1000 â†’ GID especÃ­fico para consistencia con volÃºmenes del host</span>
<a id=__codelineno-24-124 name=__codelineno-24-124 href=#__codelineno-24-124></a><span class=c>#   â”œâ”€ useradd -r -g appuser â†’ Usuario del grupo appuser</span>
<a id=__codelineno-24-125 name=__codelineno-24-125 href=#__codelineno-24-125></a><span class=c>#   â”œâ”€ --uid=1000 â†’ UID especÃ­fico (match tÃ­pico con usuario host)</span>
<a id=__codelineno-24-126 name=__codelineno-24-126 href=#__codelineno-24-126></a><span class=c>#   â”œâ”€ --home-dir=/app â†’ Home directory del usuario</span>
<a id=__codelineno-24-127 name=__codelineno-24-127 href=#__codelineno-24-127></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Contenedor corre como root â†’ vulnerabilidad crÃ­tica</span>
<a id=__codelineno-24-128 name=__codelineno-24-128 href=#__codelineno-24-128></a><span class=k>RUN</span><span class=w> </span>groupadd<span class=w> </span>-r<span class=w> </span>appuser<span class=w> </span>--gid<span class=o>=</span><span class=m>1000</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-129 name=__codelineno-24-129 href=#__codelineno-24-129></a><span class=w>    </span>useradd<span class=w> </span>-r<span class=w> </span>-g<span class=w> </span>appuser<span class=w> </span>--uid<span class=o>=</span><span class=m>1000</span><span class=w> </span>--home-dir<span class=o>=</span>/app<span class=w> </span>appuser
<a id=__codelineno-24-130 name=__codelineno-24-130 href=#__codelineno-24-130></a>
<a id=__codelineno-24-131 name=__codelineno-24-131 href=#__codelineno-24-131></a><span class=c># LÃ­nea 59: Directorio de trabajo de la aplicaciÃ³n</span>
<a id=__codelineno-24-132 name=__codelineno-24-132 href=#__codelineno-24-132></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-133 name=__codelineno-24-133 href=#__codelineno-24-133></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-24-134 name=__codelineno-24-134 href=#__codelineno-24-134></a>
<a id=__codelineno-24-135 name=__codelineno-24-135 href=#__codelineno-24-135></a><span class=c># LÃ­nea 62: COPIAR virtualenv desde builder</span>
<a id=__codelineno-24-136 name=__codelineno-24-136 href=#__codelineno-24-136></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-137 name=__codelineno-24-137 href=#__codelineno-24-137></a><span class=c># COPY --from=builder --chown=appuser:appuser /opt/venv /opt/venv</span>
<a id=__codelineno-24-138 name=__codelineno-24-138 href=#__codelineno-24-138></a><span class=c>#   â”œâ”€ --from=builder â†’ Copia desde el stage anterior (no de contexto local)</span>
<a id=__codelineno-24-139 name=__codelineno-24-139 href=#__codelineno-24-139></a><span class=c>#   â”œâ”€ --chown=appuser:appuser â†’ Asigna propiedad al usuario non-root</span>
<a id=__codelineno-24-140 name=__codelineno-24-140 href=#__codelineno-24-140></a><span class=c>#   â”œâ”€ /opt/venv â†’ Todo el virtualenv con paquetes instalados</span>
<a id=__codelineno-24-141 name=__codelineno-24-141 href=#__codelineno-24-141></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin --chown? â†’ appuser no puede leer paquetes â†’ PermissionError</span>
<a id=__codelineno-24-142 name=__codelineno-24-142 href=#__codelineno-24-142></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>--chown<span class=o>=</span>appuser:appuser<span class=w> </span>/opt/venv<span class=w> </span>/opt/venv
<a id=__codelineno-24-143 name=__codelineno-24-143 href=#__codelineno-24-143></a>
<a id=__codelineno-24-144 name=__codelineno-24-144 href=#__codelineno-24-144></a><span class=c># LÃ­nea 64: Instalar uvicorn (servidor ASGI)</span>
<a id=__codelineno-24-145 name=__codelineno-24-145 href=#__codelineno-24-145></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-146 name=__codelineno-24-146 href=#__codelineno-24-146></a><span class=c># RUN . /opt/venv/bin/activate &amp;&amp; pip install &quot;uvicorn&gt;=0.18.0&quot;</span>
<a id=__codelineno-24-147 name=__codelineno-24-147 href=#__codelineno-24-147></a><span class=c>#   â”œâ”€ uvicorn â†’ Servidor ASGI de alta performance para FastAPI</span>
<a id=__codelineno-24-148 name=__codelineno-24-148 href=#__codelineno-24-148></a><span class=c>#   â”œâ”€ &gt;=0.18.0 â†’ VersiÃ³n mÃ­nima con features necesarios</span>
<a id=__codelineno-24-149 name=__codelineno-24-149 href=#__codelineno-24-149></a><span class=c>#   â””â”€ Â¿Por quÃ© aquÃ­ y no en requirements? â†’ Separar deps de app vs runtime</span>
<a id=__codelineno-24-150 name=__codelineno-24-150 href=#__codelineno-24-150></a><span class=k>RUN</span><span class=w> </span>.<span class=w> </span>/opt/venv/bin/activate<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--no-cache-dir<span class=w> </span><span class=s2>&quot;uvicorn&gt;=0.18.0&quot;</span>
<a id=__codelineno-24-151 name=__codelineno-24-151 href=#__codelineno-24-151></a>
<a id=__codelineno-24-152 name=__codelineno-24-152 href=#__codelineno-24-152></a><span class=c># LÃ­nea 67: Copiar cÃ³digo fuente completo</span>
<a id=__codelineno-24-153 name=__codelineno-24-153 href=#__codelineno-24-153></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-154 name=__codelineno-24-154 href=#__codelineno-24-154></a><span class=c># COPY --chown=appuser:appuser . .</span>
<a id=__codelineno-24-155 name=__codelineno-24-155 href=#__codelineno-24-155></a><span class=c>#   â”œâ”€ Copia TODO el contexto (respetando .dockerignore)</span>
<a id=__codelineno-24-156 name=__codelineno-24-156 href=#__codelineno-24-156></a><span class=c>#   â”œâ”€ --chown â†’ appuser es dueÃ±o de todos los archivos</span>
<a id=__codelineno-24-157 name=__codelineno-24-157 href=#__codelineno-24-157></a><span class=c>#   â”œâ”€ Esta lÃ­nea va AL FINAL â†’ cambios de cÃ³digo no invalidan cache de pip</span>
<a id=__codelineno-24-158 name=__codelineno-24-158 href=#__codelineno-24-158></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin .dockerignore? â†’ Copia .git, tests, data (imagen 2x mÃ¡s grande)</span>
<a id=__codelineno-24-159 name=__codelineno-24-159 href=#__codelineno-24-159></a><span class=k>COPY</span><span class=w> </span>--chown<span class=o>=</span>appuser:appuser<span class=w> </span>.<span class=w> </span>.
<a id=__codelineno-24-160 name=__codelineno-24-160 href=#__codelineno-24-160></a>
<a id=__codelineno-24-161 name=__codelineno-24-161 href=#__codelineno-24-161></a><span class=c># LÃ­neas 69-71: Crear directorios con permisos correctos</span>
<a id=__codelineno-24-162 name=__codelineno-24-162 href=#__codelineno-24-162></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-163 name=__codelineno-24-163 href=#__codelineno-24-163></a><span class=c># RUN mkdir -p logs data/raw data/processed models results ...</span>
<a id=__codelineno-24-164 name=__codelineno-24-164 href=#__codelineno-24-164></a><span class=c>#   â”œâ”€ mkdir -p â†’ Crea directorios y padres si no existen</span>
<a id=__codelineno-24-165 name=__codelineno-24-165 href=#__codelineno-24-165></a><span class=c>#   â”œâ”€ logs, data/*, models, results â†’ Directorios que la app espera</span>
<a id=__codelineno-24-166 name=__codelineno-24-166 href=#__codelineno-24-166></a><span class=c>#   â”œâ”€ chown -R â†’ Asegura que appuser pueda escribir en ellos</span>
<a id=__codelineno-24-167 name=__codelineno-24-167 href=#__codelineno-24-167></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ FileNotFoundError al escribir logs o guardar modelos</span>
<a id=__codelineno-24-168 name=__codelineno-24-168 href=#__codelineno-24-168></a><span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>logs<span class=w> </span>data/raw<span class=w> </span>data/processed<span class=w> </span>models<span class=w> </span>results<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-169 name=__codelineno-24-169 href=#__codelineno-24-169></a><span class=w>    </span>chown<span class=w> </span>-R<span class=w> </span>appuser:appuser<span class=w> </span>/app
<a id=__codelineno-24-170 name=__codelineno-24-170 href=#__codelineno-24-170></a>
<a id=__codelineno-24-171 name=__codelineno-24-171 href=#__codelineno-24-171></a><span class=c># LÃ­nea 74: CAMBIAR a usuario non-root (CRÃTICO)</span>
<a id=__codelineno-24-172 name=__codelineno-24-172 href=#__codelineno-24-172></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-173 name=__codelineno-24-173 href=#__codelineno-24-173></a><span class=c># USER appuser</span>
<a id=__codelineno-24-174 name=__codelineno-24-174 href=#__codelineno-24-174></a><span class=c>#   â”œâ”€ A partir de aquÃ­, TODO corre como appuser (no root)</span>
<a id=__codelineno-24-175 name=__codelineno-24-175 href=#__codelineno-24-175></a><span class=c>#   â”œâ”€ CMD, ENTRYPOINT, docker exec â†’ todos como appuser</span>
<a id=__codelineno-24-176 name=__codelineno-24-176 href=#__codelineno-24-176></a><span class=c>#   â”œâ”€ IMPORTANTE: Esta lÃ­nea DESPUÃ‰S de mkdir/chown</span>
<a id=__codelineno-24-177 name=__codelineno-24-177 href=#__codelineno-24-177></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Contenedor corre como root â†’ CIS Benchmark falla</span>
<a id=__codelineno-24-178 name=__codelineno-24-178 href=#__codelineno-24-178></a><span class=k>USER</span><span class=w> </span><span class=s>appuser</span>
<a id=__codelineno-24-179 name=__codelineno-24-179 href=#__codelineno-24-179></a>
<a id=__codelineno-24-180 name=__codelineno-24-180 href=#__codelineno-24-180></a><span class=c># LÃ­nea 77: Exponer puerto (documentaciÃ³n)</span>
<a id=__codelineno-24-181 name=__codelineno-24-181 href=#__codelineno-24-181></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-182 name=__codelineno-24-182 href=#__codelineno-24-182></a><span class=c># EXPOSE 8000</span>
<a id=__codelineno-24-183 name=__codelineno-24-183 href=#__codelineno-24-183></a><span class=c>#   â”œâ”€ Documenta que la app escucha en puerto 8000</span>
<a id=__codelineno-24-184 name=__codelineno-24-184 href=#__codelineno-24-184></a><span class=c>#   â”œâ”€ NO publica el puerto (eso es -p en docker run)</span>
<a id=__codelineno-24-185 name=__codelineno-24-185 href=#__codelineno-24-185></a><span class=c>#   â”œâ”€ Ãštil para: docker inspect, docker-compose, K8s</span>
<a id=__codelineno-24-186 name=__codelineno-24-186 href=#__codelineno-24-186></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Funciona, pero pierdes documentaciÃ³n</span>
<a id=__codelineno-24-187 name=__codelineno-24-187 href=#__codelineno-24-187></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>8000</span>
<a id=__codelineno-24-188 name=__codelineno-24-188 href=#__codelineno-24-188></a>
<a id=__codelineno-24-189 name=__codelineno-24-189 href=#__codelineno-24-189></a><span class=c># LÃ­neas 79-81: HEALTHCHECK para orquestadores</span>
<a id=__codelineno-24-190 name=__codelineno-24-190 href=#__codelineno-24-190></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-191 name=__codelineno-24-191 href=#__codelineno-24-191></a><span class=c># HEALTHCHECK --interval=30s --timeout=10s --start-period=15s --retries=3 ...</span>
<a id=__codelineno-24-192 name=__codelineno-24-192 href=#__codelineno-24-192></a><span class=c>#   â”œâ”€ --interval=30s â†’ Cada 30s ejecuta el check</span>
<a id=__codelineno-24-193 name=__codelineno-24-193 href=#__codelineno-24-193></a><span class=c>#   â”œâ”€ --timeout=10s â†’ Si no responde en 10s, falla</span>
<a id=__codelineno-24-194 name=__codelineno-24-194 href=#__codelineno-24-194></a><span class=c>#   â”œâ”€ --start-period=15s â†’ Espera 15s antes del primer check (carga de modelo)</span>
<a id=__codelineno-24-195 name=__codelineno-24-195 href=#__codelineno-24-195></a><span class=c>#   â”œâ”€ --retries=3 â†’ 3 fallos consecutivos â†’ &quot;unhealthy&quot;</span>
<a id=__codelineno-24-196 name=__codelineno-24-196 href=#__codelineno-24-196></a><span class=c>#   â”œâ”€ CMD curl -f http://localhost:8000/health â†’ Verifica endpoint /health</span>
<a id=__codelineno-24-197 name=__codelineno-24-197 href=#__codelineno-24-197></a><span class=c>#   â”œâ”€ -f â†’ curl falla con exit 22 si HTTP != 2xx/3xx</span>
<a id=__codelineno-24-198 name=__codelineno-24-198 href=#__codelineno-24-198></a><span class=c>#   â””â”€ Â¿QuÃ© pasa sin HEALTHCHECK? â†’ K8s/Compose no saben si la API estÃ¡ lista</span>
<a id=__codelineno-24-199 name=__codelineno-24-199 href=#__codelineno-24-199></a><span class=k>HEALTHCHECK</span><span class=w> </span>--interval<span class=o>=</span>30s<span class=w> </span>--timeout<span class=o>=</span>10s<span class=w> </span>--start-period<span class=o>=</span>15s<span class=w> </span>--retries<span class=o>=</span><span class=m>3</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-24-200 name=__codelineno-24-200 href=#__codelineno-24-200></a><span class=w>    </span>CMD<span class=w> </span>curl<span class=w> </span>-f<span class=w> </span>http://localhost:8000/health<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-24-201 name=__codelineno-24-201 href=#__codelineno-24-201></a>
<a id=__codelineno-24-202 name=__codelineno-24-202 href=#__codelineno-24-202></a><span class=c># LÃ­neas 83-84: Comando por defecto (API)</span>
<a id=__codelineno-24-203 name=__codelineno-24-203 href=#__codelineno-24-203></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-24-204 name=__codelineno-24-204 href=#__codelineno-24-204></a><span class=c># CMD [&quot;uvicorn&quot;, &quot;app.fastapi_app:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot;, &quot;--workers&quot;, &quot;1&quot;]</span>
<a id=__codelineno-24-205 name=__codelineno-24-205 href=#__codelineno-24-205></a><span class=c>#   â”œâ”€ uvicorn â†’ Servidor ASGI</span>
<a id=__codelineno-24-206 name=__codelineno-24-206 href=#__codelineno-24-206></a><span class=c>#   â”œâ”€ app.fastapi_app:app â†’ Ruta al objeto FastAPI (app/fastapi_app.py)</span>
<a id=__codelineno-24-207 name=__codelineno-24-207 href=#__codelineno-24-207></a><span class=c>#   â”œâ”€ --host 0.0.0.0 â†’ Escucha en todas las interfaces (necesario en contenedor)</span>
<a id=__codelineno-24-208 name=__codelineno-24-208 href=#__codelineno-24-208></a><span class=c>#   â”œâ”€ --port 8000 â†’ Puerto que matchea con EXPOSE</span>
<a id=__codelineno-24-209 name=__codelineno-24-209 href=#__codelineno-24-209></a><span class=c>#   â”œâ”€ --workers 1 â†’ Un solo worker (escalar con rÃ©plicas, no workers)</span>
<a id=__codelineno-24-210 name=__codelineno-24-210 href=#__codelineno-24-210></a><span class=c>#   â””â”€ Â¿QuÃ© pasa con --host 127.0.0.1? â†’ Solo accesible desde dentro del contenedor</span>
<a id=__codelineno-24-211 name=__codelineno-24-211 href=#__codelineno-24-211></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;uvicorn&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.fastapi_app:app&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--host&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.0.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--port&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;8000&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--workers&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;1&quot;</span><span class=p>]</span>
</code></pre></div> <hr> <h3 id=1373-laboratorio-de-replicacion-escribe-el-dockerfile-tu-mismo>13.7.3 ğŸ§ª Laboratorio de ReplicaciÃ³n: Escribe el Dockerfile TÃº Mismo<a class=headerlink href=#1373-laboratorio-de-replicacion-escribe-el-dockerfile-tu-mismo title="Permanent link">&para;</a></h3> <blockquote> <p><strong>Instrucciones</strong>: NO copies y pegues. Escribe cada secciÃ³n a mano para interiorizar los conceptos.</p> </blockquote> <h4 id=paso-1-estructura-base-del-builder-stage>Paso 1: Estructura Base del Builder Stage<a class=headerlink href=#paso-1-estructura-base-del-builder-stage title="Permanent link">&para;</a></h4> <p>Abre tu editor y crea un archivo <code>Dockerfile</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># Paso 1.1: Crear el archivo vacÃ­o</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>touch<span class=w> </span>BankChurn-Predictor/Dockerfile
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=c1># Paso 1.2: Abrirlo en tu editor preferido</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>code<span class=w> </span>BankChurn-Predictor/Dockerfile<span class=w>  </span><span class=c1># o vim, nano, etc.</span>
</code></pre></div> <p><strong>Escribe el Stage 1 (Builder)</strong>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c># Paso 1.3: Escribe el encabezado y la imagen base</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=c># Pregunta: Â¿Por quÃ© usamos python:3.11-slim y no python:3.11?</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=c># Respuesta: ______________________ (escrÃ­bela antes de continuar)</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>builder</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=c># â†‘ AS builder: nombra este stage para poder hacer COPY --from=builder despuÃ©s</span>
</code></pre></div> <h4 id=paso-2-variables-de-entorno-y-dependencias-de-build>Paso 2: Variables de Entorno y Dependencias de Build<a class=headerlink href=#paso-2-variables-de-entorno-y-dependencias-de-build title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c># Paso 2.1: AÃ±ade las variables de entorno</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=c># Pregunta: Â¿QuÃ© hace PYTHONUNBUFFERED=1?</span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=c># Respuesta: ______________________ (logs sin buffering = visibles inmediatamente)</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONUNBUFFERED</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONDONTWRITEBYTECODE</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=k>ENV</span><span class=w> </span><span class=nv>PIP_NO_CACHE_DIR</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=c># Paso 2.2: Establece el directorio de trabajo</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/build</span>
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=c># Paso 2.3: Instala compiladores (SOLO para build)</span>
<a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=c># Pregunta: Â¿Por quÃ© hacemos rm -rf /var/lib/apt/lists/*?</span>
<a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=c># Respuesta: ______________________ (elimina cache de apt = imagen mÃ¡s pequeÃ±a)</span>
<a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a>
<a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=w>    </span>gcc<span class=w> </span><span class=se>\</span>
<a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=w>    </span>build-essential<span class=w> </span><span class=se>\</span>
<a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
</code></pre></div> <h4 id=paso-3-copiar-e-instalar-dependencias>Paso 3: Copiar e Instalar Dependencias<a class=headerlink href=#paso-3-copiar-e-instalar-dependencias title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c># Paso 3.1: Copia SOLO requirements (aprovecha cache de Docker)</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=c># Pregunta: Â¿Por quÃ© copiamos requirements.txt ANTES del cÃ³digo fuente?</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=c># Respuesta: ______________________ (si solo cambias cÃ³digo, pip install estÃ¡ cacheado)</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=c># Paso 3.2: Crea virtualenv e instala dependencias</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=k>RUN</span><span class=w> </span>python<span class=w> </span>-m<span class=w> </span>venv<span class=w> </span>/opt/venv<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=w>    </span>.<span class=w> </span>/opt/venv/bin/activate<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=w>    </span>pip<span class=w> </span>install<span class=w> </span>--upgrade<span class=w> </span>pip<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=w>    </span>pip<span class=w> </span>install<span class=w> </span>--no-cache-dir<span class=w> </span>-r<span class=w> </span>requirements.txt
</code></pre></div> <h4 id=paso-4-stage-2-runtime>Paso 4: Stage 2 - Runtime<a class=headerlink href=#paso-4-stage-2-runtime title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c># Paso 4.1: Inicia una imagen NUEVA y limpia</span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=c># Nota: Esta imagen NO tiene gcc, build-essential, ni nada del stage anterior</span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>runtime</span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=c># Paso 4.2: Variables de entorno de runtime</span>
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONUNBUFFERED</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONPATH</span><span class=o>=</span>/app
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=k>ENV</span><span class=w> </span><span class=nv>PATH</span><span class=o>=</span><span class=s2>&quot;/opt/venv/bin:</span><span class=nv>$PATH</span><span class=s2>&quot;</span>
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=c># â†‘ PATH: permite usar python, pip, uvicorn del venv sin activarlo explÃ­citamente</span>
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a>
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=c># Paso 4.3: Dependencias mÃ­nimas de runtime</span>
<a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=w>    </span>curl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=c># â†‘ curl: necesario para HEALTHCHECK</span>
</code></pre></div> <h4 id=paso-5-seguridad-usuario-non-root>Paso 5: Seguridad - Usuario Non-Root<a class=headerlink href=#paso-5-seguridad-usuario-non-root title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c># Paso 5.1: Crear usuario y grupo sin privilegios</span>
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=c># Pregunta: Â¿Por quÃ© usamos UID 1000?</span>
<a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=c># Respuesta: ______________________ (match tÃ­pico con usuarios del host = menos problemas de permisos)</span>
<a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>
<a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=k>RUN</span><span class=w> </span>groupadd<span class=w> </span>-r<span class=w> </span>appuser<span class=w> </span>--gid<span class=o>=</span><span class=m>1000</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=w>    </span>useradd<span class=w> </span>-r<span class=w> </span>-g<span class=w> </span>appuser<span class=w> </span>--uid<span class=o>=</span><span class=m>1000</span><span class=w> </span>--home-dir<span class=o>=</span>/app<span class=w> </span>appuser
<a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a>
<a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a>
<a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=c># Paso 5.2: Copiar virtualenv DESDE el builder</span>
<a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=c># Nota: --chown asigna propiedad a appuser (sin esto, root es el dueÃ±o)</span>
<a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a>
<a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>--chown<span class=o>=</span>appuser:appuser<span class=w> </span>/opt/venv<span class=w> </span>/opt/venv
</code></pre></div> <h4 id=paso-6-codigo-fuente-y-directorios>Paso 6: CÃ³digo Fuente y Directorios<a class=headerlink href=#paso-6-codigo-fuente-y-directorios title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c># Paso 6.1: Copiar cÃ³digo fuente</span>
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=c># Nota: Esta lÃ­nea va AL FINAL para maximizar cache</span>
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a>
<a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=k>COPY</span><span class=w> </span>--chown<span class=o>=</span>appuser:appuser<span class=w> </span>.<span class=w> </span>.
<a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a>
<a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=c># Paso 6.2: Crear directorios que la aplicaciÃ³n necesita</span>
<a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>logs<span class=w> </span>models<span class=w> </span>data<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=w>    </span>chown<span class=w> </span>-R<span class=w> </span>appuser:appuser<span class=w> </span>/app
<a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a>
<a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=c># Paso 6.3: CAMBIAR a usuario non-root (CRÃTICO)</span>
<a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=c># Pregunta: Â¿Por quÃ© USER va DESPUÃ‰S de mkdir/chown?</span>
<a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a><span class=c># Respuesta: ______________________ (appuser no tiene permisos para crear dirs)</span>
<a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a>
<a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a><span class=k>USER</span><span class=w> </span><span class=s>appuser</span>
</code></pre></div> <h4 id=paso-7-healthcheck-y-comando>Paso 7: Healthcheck y Comando<a class=headerlink href=#paso-7-healthcheck-y-comando title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c># Paso 7.1: Documentar puerto</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>8000</span>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=c># Paso 7.2: Configurar healthcheck</span>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=c># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=c># Pregunta: Â¿QuÃ© hace --start-period?</span>
<a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=c># Respuesta: ______________________ (tiempo de gracia para que cargue el modelo)</span>
<a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a>
<a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=k>HEALTHCHECK</span><span class=w> </span>--interval<span class=o>=</span>30s<span class=w> </span>--timeout<span class=o>=</span>10s<span class=w> </span>--start-period<span class=o>=</span>15s<span class=w> </span>--retries<span class=o>=</span><span class=m>3</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=w>    </span>CMD<span class=w> </span>curl<span class=w> </span>-f<span class=w> </span>http://localhost:8000/health<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a>
<a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=c># Paso 7.3: Comando de inicio</span>
<a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;uvicorn&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.fastapi_app:app&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--host&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.0.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--port&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;8000&quot;</span><span class=p>]</span>
</code></pre></div> <h4 id=verificacion-del-laboratorio>VerificaciÃ³n del Laboratorio<a class=headerlink href=#verificacion-del-laboratorio title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1># Construir la imagen</span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>docker<span class=w> </span>build<span class=w> </span>-t<span class=w> </span>bankchurn:lab<span class=w> </span>.
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=c1># Verificar tamaÃ±o (objetivo: &lt; 500MB)</span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a>docker<span class=w> </span>images<span class=w> </span>bankchurn:lab
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=c1># Ejecutar y probar</span>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>-p<span class=w> </span><span class=m>8000</span>:8000<span class=w> </span>--name<span class=w> </span>bankchurn-test<span class=w> </span>bankchurn:lab
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a>
<a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=c1># Esperar 20 segundos y verificar health</span>
<a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a>sleep<span class=w> </span><span class=m>20</span>
<a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a>docker<span class=w> </span>inspect<span class=w> </span>--format<span class=o>=</span><span class=s1>&#39;{{.State.Health.Status}}&#39;</span><span class=w> </span>bankchurn-test
<a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=c1># Esperado: healthy</span>
<a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a>
<a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=c1># Verificar que corre como non-root</span>
<a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>bankchurn-test<span class=w> </span>whoami
<a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=c1># Esperado: appuser</span>
<a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a>
<a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=c1># Cleanup</span>
<a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a>docker<span class=w> </span>stop<span class=w> </span>bankchurn-test<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>docker<span class=w> </span>rm<span class=w> </span>bankchurn-test
</code></pre></div> <hr> <h3 id=1374-troubleshooting-preventivo-los-5-errores-mas-comunes>13.7.4 ğŸš¨ Troubleshooting Preventivo: Los 5 Errores MÃ¡s Comunes<a class=headerlink href=#1374-troubleshooting-preventivo-los-5-errores-mas-comunes title="Permanent link">&para;</a></h3> <p>Estos son los errores que encontrarÃ¡s al intentar replicar el Dockerfile del portafolio. <strong>LÃ©elos ANTES de empezar</strong> para ahorrar horas de debugging.</p> <h4 id=error-1-modulenotfounderror-no-module-named-src>Error 1: <code>ModuleNotFoundError: No module named 'src'</code><a class=headerlink href=#error-1-modulenotfounderror-no-module-named-src title="Permanent link">&para;</a></h4> <p><strong>CuÃ¡ndo ocurre</strong>: Al ejecutar <code>docker run</code> o <code>uvicorn</code>.</p> <p><strong>Causa raÃ­z</strong>: Falta <code>ENV PYTHONPATH=/app</code> o el cÃ³digo no estÃ¡ en <code>/app</code>.</p> <p><strong>DiagnÃ³stico</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1># Verificar estructura dentro del contenedor</span>
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>&lt;container&gt;<span class=w> </span>ls<span class=w> </span>-la<span class=w> </span>/app
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=c1># Â¿Existe /app/src/? Â¿/app/app/?</span>
<a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a>
<a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=c1># Verificar PYTHONPATH</span>
<a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>&lt;container&gt;<span class=w> </span>printenv<span class=w> </span>PYTHONPATH
<a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=c1># Esperado: /app</span>
</code></pre></div></p> <p><strong>SoluciÃ³n</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c># AÃ±adir en el runtime stage</span>
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONPATH</span><span class=o>=</span>/app
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=c># O cambiar el CMD para especificar la ruta</span>
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;python&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;-m&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;uvicorn&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.fastapi_app:app&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--host&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.0.0.0&quot;</span><span class=p>]</span>
</code></pre></div></p> <hr> <h4 id=error-2-permissionerror-errno-13-permission-denied-applogsapplog>Error 2: <code>PermissionError: [Errno 13] Permission denied: '/app/logs/app.log'</code><a class=headerlink href=#error-2-permissionerror-errno-13-permission-denied-applogsapplog title="Permanent link">&para;</a></h4> <p><strong>CuÃ¡ndo ocurre</strong>: La API intenta escribir logs pero falla.</p> <p><strong>Causa raÃ­z</strong>: El directorio <code>/app/logs</code> pertenece a <code>root</code>, pero el proceso corre como <code>appuser</code>.</p> <p><strong>DiagnÃ³stico</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># Verificar permisos</span>
<a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>&lt;container&gt;<span class=w> </span>ls<span class=w> </span>-la<span class=w> </span>/app
<a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=c1># Â¿El owner es appuser o root?</span>
<a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>
<a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=c1># Verificar usuario actual</span>
<a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>&lt;container&gt;<span class=w> </span>whoami
<a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=c1># Esperado: appuser</span>
</code></pre></div></p> <p><strong>SoluciÃ³n</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=c># ANTES de USER appuser, crear directorios y asignar permisos</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>-p<span class=w> </span>logs<span class=w> </span>data<span class=w> </span>models<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=w>    </span>chown<span class=w> </span>-R<span class=w> </span>appuser:appuser<span class=w> </span>/app
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=k>USER</span><span class=w> </span><span class=s>appuser  # â† DESPUÃ‰S de chown</span>
</code></pre></div></p> <hr> <h4 id=error-3-container-unhealthy-pero-la-api-funciona>Error 3: Container <code>unhealthy</code> pero la API funciona<a class=headerlink href=#error-3-container-unhealthy-pero-la-api-funciona title="Permanent link">&para;</a></h4> <p><strong>CuÃ¡ndo ocurre</strong>: <code>docker ps</code> muestra "(unhealthy)" pero <code>curl localhost:8000/health</code> funciona.</p> <p><strong>Causa raÃ­z</strong>: El HEALTHCHECK usa <code>curl</code> pero <code>curl</code> no estÃ¡ instalado en la imagen.</p> <p><strong>DiagnÃ³stico</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1># Verificar si curl existe</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>docker<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>&lt;container&gt;<span class=w> </span>which<span class=w> </span>curl
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=c1># Si no hay output, curl no estÃ¡ instalado</span>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=c1># Verificar logs del healthcheck</span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>docker<span class=w> </span>inspect<span class=w> </span>&lt;container&gt;<span class=w> </span>--format<span class=o>=</span><span class=s1>&#39;{{json .State.Health}}&#39;</span>
</code></pre></div></p> <p><strong>SoluciÃ³n</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=c># Instalar curl en el runtime stage</span>
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=w>    </span>curl<span class=w> </span><span class=se>\</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
</code></pre></div></p> <hr> <h4 id=error-4-build-tarda-15-minutos-cache-no-funciona>Error 4: Build tarda 15+ minutos (cache no funciona)<a class=headerlink href=#error-4-build-tarda-15-minutos-cache-no-funciona title="Permanent link">&para;</a></h4> <p><strong>CuÃ¡ndo ocurre</strong>: Cada cambio de cÃ³digo dispara reinstalaciÃ³n de pip.</p> <p><strong>Causa raÃ­z</strong>: <code>COPY . .</code> estÃ¡ ANTES de <code>pip install</code>.</p> <p><strong>DiagnÃ³stico</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1># Observar output del build</span>
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>docker<span class=w> </span>build<span class=w> </span>-t<span class=w> </span><span class=nb>test</span><span class=w> </span>.
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=c1># Â¿Ves &quot;CACHED&quot; en el step de pip install?</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=c1># Si no, el cache estÃ¡ roto</span>
</code></pre></div></p> <p><strong>SoluciÃ³n</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c># âŒ MALO: Cualquier cambio invalida todo</span>
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=c># âœ… BUENO: requirements primero, cÃ³digo despuÃ©s</span>
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.<span class=w>  </span>#<span class=w> </span>â†<span class=w> </span>Cambios<span class=w> </span>aquÃ­<span class=w> </span>NO<span class=w> </span>invalidan<span class=w> </span>pip
</code></pre></div></p> <hr> <h4 id=error-5-imagen-de-15gb-despues-del-multi-stage>Error 5: Imagen de 1.5GB despuÃ©s del multi-stage<a class=headerlink href=#error-5-imagen-de-15gb-despues-del-multi-stage title="Permanent link">&para;</a></h4> <p><strong>CuÃ¡ndo ocurre</strong>: Usaste multi-stage pero la imagen sigue enorme.</p> <p><strong>Causa raÃ­z</strong>: El <code>.dockerignore</code> no excluye datos, notebooks, o <code>.git</code>.</p> <p><strong>DiagnÃ³stico</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1># Ver historial de layers</span>
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>docker<span class=w> </span><span class=nb>history</span><span class=w> </span>bankchurn:latest<span class=w> </span>--format<span class=w> </span><span class=s2>&quot;{{.Size}}\t{{.CreatedBy}}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-20
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=c1># Â¿Hay layers de 500MB+? Â¿QuÃ© comando las creÃ³?</span>
<a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a>
<a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=c1># Verificar quÃ© estÃ¡ copiando</span>
<a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>docker<span class=w> </span>build<span class=w> </span>-t<span class=w> </span><span class=nb>test</span><span class=w> </span>.<span class=w> </span><span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span><span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s2>&quot;COPY&quot;</span>
</code></pre></div></p> <p><strong>SoluciÃ³n</strong>: Crear/actualizar <code>.dockerignore</code>: <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a># .dockerignore - CRÃTICO para imÃ¡genes pequeÃ±as
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>.git
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>.gitignore
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>data/
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a>notebooks/
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a>tests/
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a>*.md
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a>*.ipynb
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a>__pycache__
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a>.venv/
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a>mlruns/
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a>.dvc/
</code></pre></div></p> <hr> <h3 id=1375-checklist-de-replicacion-completa>13.7.5 ğŸ“‹ Checklist de ReplicaciÃ³n Completa<a class=headerlink href=#1375-checklist-de-replicacion-completa title="Permanent link">&para;</a></h3> <p>Usa esta lista para verificar que tu Dockerfile replica correctamente el del portafolio:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=gh># Checklist: Dockerfile BankChurn-Predictor</span>
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=gu>## Arquitectura</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=k>- [ ]</span> Multi-stage build (builder + runtime)
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=k>- [ ]</span> Base image: python:3.11-slim (NO alpine, NO full)
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=k>- [ ]</span> Builder: instala gcc, build-essential
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=k>- [ ]</span> Runtime: NO tiene compiladores
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=gu>## OptimizaciÃ³n</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=k>- [ ]</span> .dockerignore excluye: .git, data/, tests/, notebooks/, <span class=gs>__pycache__</span>
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=k>- [ ]</span> COPY requirements.txt ANTES de COPY cÃ³digo
<a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=k>- [ ]</span> pip install --no-cache-dir
<a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=k>- [ ]</span> rm -rf /var/lib/apt/lists/* despuÃ©s de apt-get
<a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a><span class=k>- [ ]</span> Imagen final &lt; 500MB (verificar con docker images)
<a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a>
<a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a><span class=gu>## Seguridad</span>
<a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a><span class=k>- [ ]</span> Usuario non-root creado (appuser con UID 1000)
<a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a><span class=k>- [ ]</span> USER appuser DESPUÃ‰S de crear directorios
<a id=__codelineno-44-19 name=__codelineno-44-19 href=#__codelineno-44-19></a><span class=k>- [ ]</span> --chown=appuser:appuser en COPY
<a id=__codelineno-44-20 name=__codelineno-44-20 href=#__codelineno-44-20></a><span class=k>- [ ]</span> Directorios logs/, data/, models/ con permisos correctos
<a id=__codelineno-44-21 name=__codelineno-44-21 href=#__codelineno-44-21></a>
<a id=__codelineno-44-22 name=__codelineno-44-22 href=#__codelineno-44-22></a><span class=gu>## Observabilidad</span>
<a id=__codelineno-44-23 name=__codelineno-44-23 href=#__codelineno-44-23></a><span class=k>- [ ]</span> HEALTHCHECK configurado (interval, timeout, start-period, retries)
<a id=__codelineno-44-24 name=__codelineno-44-24 href=#__codelineno-44-24></a><span class=k>- [ ]</span> curl instalado en runtime (para HEALTHCHECK)
<a id=__codelineno-44-25 name=__codelineno-44-25 href=#__codelineno-44-25></a><span class=k>- [ ]</span> EXPOSE 8000 documentado
<a id=__codelineno-44-26 name=__codelineno-44-26 href=#__codelineno-44-26></a>
<a id=__codelineno-44-27 name=__codelineno-44-27 href=#__codelineno-44-27></a><span class=gu>## VerificaciÃ³n Final</span>
<a id=__codelineno-44-28 name=__codelineno-44-28 href=#__codelineno-44-28></a><span class=k>- [ ]</span> docker build completa sin errores
<a id=__codelineno-44-29 name=__codelineno-44-29 href=#__codelineno-44-29></a><span class=k>- [ ]</span> docker run levanta el contenedor
<a id=__codelineno-44-30 name=__codelineno-44-30 href=#__codelineno-44-30></a><span class=k>- [ ]</span> curl localhost:8000/health retorna 200
<a id=__codelineno-44-31 name=__codelineno-44-31 href=#__codelineno-44-31></a><span class=k>- [ ]</span> docker exec &lt;container&gt; whoami retorna &quot;appuser&quot;
<a id=__codelineno-44-32 name=__codelineno-44-32 href=#__codelineno-44-32></a><span class=k>- [ ]</span> container aparece como &quot;healthy&quot; en docker ps
</code></pre></div> <hr> <h3 id=1376-anatomia-del-dockerignore-real-del-portafolio>13.7.6 ğŸ“ AnatomÃ­a del <code>.dockerignore</code> Real del Portafolio<a class=headerlink href=#1376-anatomia-del-dockerignore-real-del-portafolio title="Permanent link">&para;</a></h3> <p>El archivo <code>.dockerignore</code> es TAN importante como el <code>Dockerfile</code>. Sin Ã©l, tu imagen puede pasar de 350MB a 2GB.</p> <p><strong>Archivo</strong>: <code>BankChurn-Predictor/.dockerignore</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a># .dockerignore del Portafolio - Comentado lÃ­nea por lÃ­nea
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>
<a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a># SecciÃ³n 1: Control de Versiones
<a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a># .git
<a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a>#   â”œâ”€ Excluye el directorio .git completo (~50-500MB en proyectos grandes)
<a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a>#   â”œâ”€ El historial de commits NO es necesario en el contenedor
<a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Imagen 500MB mÃ¡s grande sin beneficio
<a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a>.git
<a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a>.gitignore
<a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a>.dvc
<a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a>.dvcignore
<a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a># â†‘ DVC tambiÃ©n tiene su propio directorio pesado con cache de datos
<a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a>
<a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a># SecciÃ³n 2: Python - Archivos Generados
<a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a># __pycache__
<a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a>#   â”œâ”€ Bytecode compilado de Python (*.pyc)
<a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a>#   â”œâ”€ Se regenera automÃ¡ticamente cuando Python importa el mÃ³dulo
<a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Archivos innecesarios + posibles conflictos de versiÃ³n
<a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a>__pycache__
<a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a>*.pyc
<a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a>*.pyo
<a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a>*.pyd
<a id=__codelineno-45-27 name=__codelineno-45-27 href=#__codelineno-45-27></a>.Python
<a id=__codelineno-45-28 name=__codelineno-45-28 href=#__codelineno-45-28></a>
<a id=__codelineno-45-29 name=__codelineno-45-29 href=#__codelineno-45-29></a># SecciÃ³n 3: Entornos Virtuales
<a id=__codelineno-45-30 name=__codelineno-45-30 href=#__codelineno-45-30></a># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<a id=__codelineno-45-31 name=__codelineno-45-31 href=#__codelineno-45-31></a># env/, venv/, .venv/
<a id=__codelineno-45-32 name=__codelineno-45-32 href=#__codelineno-45-32></a>#   â”œâ”€ El virtualenv del HOST no debe ir al contenedor
<a id=__codelineno-45-33 name=__codelineno-45-33 href=#__codelineno-45-33></a>#   â”œâ”€ El contenedor tiene su PROPIO venv en /opt/venv
<a id=__codelineno-45-34 name=__codelineno-45-34 href=#__codelineno-45-34></a>#   â”œâ”€ TamaÃ±o tÃ­pico: 200MB-1GB dependiendo de las dependencias
<a id=__codelineno-45-35 name=__codelineno-45-35 href=#__codelineno-45-35></a>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Conflictos de rutas + imagen enorme
<a id=__codelineno-45-36 name=__codelineno-45-36 href=#__codelineno-45-36></a>env/
<a id=__codelineno-45-37 name=__codelineno-45-37 href=#__codelineno-45-37></a>venv/
<a id=__codelineno-45-38 name=__codelineno-45-38 href=#__codelineno-45-38></a>.venv/
<a id=__codelineno-45-39 name=__codelineno-45-39 href=#__codelineno-45-39></a>pip-log.txt
<a id=__codelineno-45-40 name=__codelineno-45-40 href=#__codelineno-45-40></a>pip-delete-this-directory.txt
<a id=__codelineno-45-41 name=__codelineno-45-41 href=#__codelineno-45-41></a>
<a id=__codelineno-45-42 name=__codelineno-45-42 href=#__codelineno-45-42></a># SecciÃ³n 4: Testing y Calidad de CÃ³digo
<a id=__codelineno-45-43 name=__codelineno-45-43 href=#__codelineno-45-43></a># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<a id=__codelineno-45-44 name=__codelineno-45-44 href=#__codelineno-45-44></a># tests/
<a id=__codelineno-45-45 name=__codelineno-45-45 href=#__codelineno-45-45></a>#   â”œâ”€ Los tests NO se ejecutan en producciÃ³n
<a id=__codelineno-45-46 name=__codelineno-45-46 href=#__codelineno-45-46></a>#   â”œâ”€ pytest, coverage, etc. solo para desarrollo/CI
<a id=__codelineno-45-47 name=__codelineno-45-47 href=#__codelineno-45-47></a>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ CÃ³digo innecesario en producciÃ³n (attack surface mayor)
<a id=__codelineno-45-48 name=__codelineno-45-48 href=#__codelineno-45-48></a>.tox/
<a id=__codelineno-45-49 name=__codelineno-45-49 href=#__codelineno-45-49></a>.coverage
<a id=__codelineno-45-50 name=__codelineno-45-50 href=#__codelineno-45-50></a>.coverage.*
<a id=__codelineno-45-51 name=__codelineno-45-51 href=#__codelineno-45-51></a>.cache
<a id=__codelineno-45-52 name=__codelineno-45-52 href=#__codelineno-45-52></a>nosetests.xml
<a id=__codelineno-45-53 name=__codelineno-45-53 href=#__codelineno-45-53></a>coverage.xml
<a id=__codelineno-45-54 name=__codelineno-45-54 href=#__codelineno-45-54></a>*.cover
<a id=__codelineno-45-55 name=__codelineno-45-55 href=#__codelineno-45-55></a>*.log
<a id=__codelineno-45-56 name=__codelineno-45-56 href=#__codelineno-45-56></a>.pytest_cache/
<a id=__codelineno-45-57 name=__codelineno-45-57 href=#__codelineno-45-57></a>.mypy_cache/
<a id=__codelineno-45-58 name=__codelineno-45-58 href=#__codelineno-45-58></a>.flake8
<a id=__codelineno-45-59 name=__codelineno-45-59 href=#__codelineno-45-59></a>tests/
<a id=__codelineno-45-60 name=__codelineno-45-60 href=#__codelineno-45-60></a># â†‘ IMPORTANTE: Excluir tests/ reduce imagen Y attack surface
<a id=__codelineno-45-61 name=__codelineno-45-61 href=#__codelineno-45-61></a>
<a id=__codelineno-45-62 name=__codelineno-45-62 href=#__codelineno-45-62></a># SecciÃ³n 5: Datos y Artefactos Pesados
<a id=__codelineno-45-63 name=__codelineno-45-63 href=#__codelineno-45-63></a># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<a id=__codelineno-45-64 name=__codelineno-45-64 href=#__codelineno-45-64></a># data/, models/, results/, mlruns/
<a id=__codelineno-45-65 name=__codelineno-45-65 href=#__codelineno-45-65></a>#   â”œâ”€ Datos se montan como VOLÃšMENES, no se copian a la imagen
<a id=__codelineno-45-66 name=__codelineno-45-66 href=#__codelineno-45-66></a>#   â”œâ”€ models/ se monta en runtime: -v ./models:/app/models:ro
<a id=__codelineno-45-67 name=__codelineno-45-67 href=#__codelineno-45-67></a>#   â”œâ”€ mlruns/ es el directorio de MLflow (puede ser GB de experimentos)
<a id=__codelineno-45-68 name=__codelineno-45-68 href=#__codelineno-45-68></a>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Imagen de 5GB+ con datos de entrenamiento
<a id=__codelineno-45-69 name=__codelineno-45-69 href=#__codelineno-45-69></a>data/
<a id=__codelineno-45-70 name=__codelineno-45-70 href=#__codelineno-45-70></a>models/
<a id=__codelineno-45-71 name=__codelineno-45-71 href=#__codelineno-45-71></a>results/
<a id=__codelineno-45-72 name=__codelineno-45-72 href=#__codelineno-45-72></a>mlruns/
<a id=__codelineno-45-73 name=__codelineno-45-73 href=#__codelineno-45-73></a>
<a id=__codelineno-45-74 name=__codelineno-45-74 href=#__codelineno-45-74></a># SecciÃ³n 6: Notebooks y DocumentaciÃ³n
<a id=__codelineno-45-75 name=__codelineno-45-75 href=#__codelineno-45-75></a># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
<a id=__codelineno-45-76 name=__codelineno-45-76 href=#__codelineno-45-76></a># notebooks/, *.ipynb
<a id=__codelineno-45-77 name=__codelineno-45-77 href=#__codelineno-45-77></a>#   â”œâ”€ Notebooks son para exploraciÃ³n, no para producciÃ³n
<a id=__codelineno-45-78 name=__codelineno-45-78 href=#__codelineno-45-78></a>#   â”œâ”€ Pueden contener outputs pesados (imÃ¡genes, tablas)
<a id=__codelineno-45-79 name=__codelineno-45-79 href=#__codelineno-45-79></a>#   â””â”€ Â¿QuÃ© pasa sin esto? â†’ Notebooks de 50MB+ innecesarios en imagen
<a id=__codelineno-45-80 name=__codelineno-45-80 href=#__codelineno-45-80></a>notebooks/
<a id=__codelineno-45-81 name=__codelineno-45-81 href=#__codelineno-45-81></a>docs/
<a id=__codelineno-45-82 name=__codelineno-45-82 href=#__codelineno-45-82></a>*.md
<a id=__codelineno-45-83 name=__codelineno-45-83 href=#__codelineno-45-83></a># â†‘ Excluimos .md EXCEPTO README.md si lo necesitas (ver patrÃ³n negativo abajo)
<a id=__codelineno-45-84 name=__codelineno-45-84 href=#__codelineno-45-84></a># Para incluir README.md: aÃ±adir lÃ­nea &quot;!README.md&quot; DESPUÃ‰S de &quot;*.md&quot;
</code></pre></div> <p><strong>Patrones Avanzados de <code>.dockerignore</code></strong>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a># PatrÃ³n 1: Excluir TODO excepto algo especÃ­fico
<a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>*.md
<a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a>!README.md
<a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a># â†‘ Excluye todos los .md EXCEPTO README.md
<a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a>
<a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a># PatrÃ³n 2: Excluir subdirectorios pero no el directorio mismo
<a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>data/*
<a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a>!data/.gitkeep
<a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a># â†‘ Excluye contenido de data/ pero mantiene el directorio
<a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>
<a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a># PatrÃ³n 3: Excluir por profundidad
<a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a>**/__pycache__
<a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a># â†‘ Excluye __pycache__ en CUALQUIER nivel de profundidad
<a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>
<a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a># PatrÃ³n 4: Excluir archivos temporales
<a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a>*.tmp
<a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a>*.temp
<a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a>*~
<a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a>.DS_Store
<a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a># â†‘ Archivos del sistema operativo que no deben ir al contenedor
</code></pre></div> <hr> <h3 id=1377-conexion-docker-kubernetes-de-imagen-a-produccion>13.7.7 ğŸ”— ConexiÃ³n Docker â†’ Kubernetes: De Imagen a ProducciÃ³n<a class=headerlink href=#1377-conexion-docker-kubernetes-de-imagen-a-produccion title="Permanent link">&para;</a></h3> <p>El Dockerfile que construyes es solo el primer paso. En producciÃ³n, esa imagen se despliega en Kubernetes. Veamos cÃ³mo se conectan:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a>â”‚                    FLUJO: DOCKERFILE â†’ KUBERNETES                               â”‚
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
<a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>â”‚                                                                                 â”‚
<a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a>â”‚  1. BUILD                          2. PUSH                        3. DEPLOY     â”‚
<a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€       â”‚
<a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a>â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
<a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a>â”‚  â”‚ Dockerfile   â”‚  docker build   â”‚ Image        â”‚  docker push â”‚ K8s        â”‚  â”‚
<a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a>â”‚  â”‚              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ bankchurn    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Deployment â”‚  â”‚
<a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a>â”‚  â”‚ Multi-stage  â”‚                 â”‚ :v2.0.0      â”‚              â”‚            â”‚  â”‚
<a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a>â”‚  â”‚ ~350MB       â”‚                 â”‚              â”‚              â”‚ 3 replicas â”‚  â”‚
<a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a>â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
<a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a>â”‚                                           â”‚                            â”‚        â”‚
<a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a>â”‚  BankChurn-Predictor/                     â”‚                            â”‚        â”‚
<a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a>â”‚  Dockerfile                        Registry                   k8s/bankchurn-    â”‚
<a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a>â”‚                                   (DockerHub/                 deployment.yaml   â”‚
<a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a>â”‚                                    GitHub)                                      â”‚
<a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a>â”‚                                                                                 â”‚
<a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div> <p><strong>Extracto de <code>k8s/bankchurn-deployment.yaml</code> del Portafolio</strong>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=c1># k8s/bankchurn-deployment.yaml - CÃ³mo Kubernetes usa tu imagen Docker</span>
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=c1># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a>
<a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bankchurn-predictor</span>
<a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-portfolio</span>
<a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=w>  </span><span class=c1># â†‘ namespace: aÃ­sla recursos del resto del cluster</span>
<a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=w>  </span><span class=c1># â†‘ replicas: 3 instancias del contenedor para alta disponibilidad</span>
<a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class=w>  </span><span class=c1>#   Â¿Por quÃ© 3? â†’ Tolerancia a fallos: si 1 cae, quedan 2</span>
<a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a>
<a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span>
<a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
<a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a><span class=w>    </span><span class=nt>rollingUpdate</span><span class=p>:</span>
<a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a><span class=w>      </span><span class=nt>maxSurge</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w>       </span><span class=c1># â† MÃ¡ximo 1 pod extra durante update</span>
<a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a><span class=w>      </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class=w> </span><span class=c1># â† MÃ¡ximo 1 pod no disponible durante update</span>
<a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a><span class=w>    </span><span class=c1># â†‘ RollingUpdate: depliegue sin downtime (pods se actualizan uno a uno)</span>
<a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a>
<a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-48-23 name=__codelineno-48-23 href=#__codelineno-48-23></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-48-24 name=__codelineno-48-24 href=#__codelineno-48-24></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-48-25 name=__codelineno-48-25 href=#__codelineno-48-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bankchurn-api</span>
<a id=__codelineno-48-26 name=__codelineno-48-26 href=#__codelineno-48-26></a><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">duqueom/bankchurn-predictor:v2.0.0</span>
<a id=__codelineno-48-27 name=__codelineno-48-27 href=#__codelineno-48-27></a><span class=w>        </span><span class=c1># â†‘ ESTA es la imagen que construiste con tu Dockerfile</span>
<a id=__codelineno-48-28 name=__codelineno-48-28 href=#__codelineno-48-28></a><span class=w>        </span><span class=c1>#   El tag :v2.0.0 permite rollback a versiones anteriores</span>
<a id=__codelineno-48-29 name=__codelineno-48-29 href=#__codelineno-48-29></a>
<a id=__codelineno-48-30 name=__codelineno-48-30 href=#__codelineno-48-30></a><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<a id=__codelineno-48-31 name=__codelineno-48-31 href=#__codelineno-48-31></a><span class=w>        </span><span class=c1># â†‘ Always: siempre descarga la imagen (Ãºtil para latest o CI/CD)</span>
<a id=__codelineno-48-32 name=__codelineno-48-32 href=#__codelineno-48-32></a><span class=w>        </span><span class=c1>#   IfNotPresent: solo si no existe localmente (mÃ¡s rÃ¡pido)</span>
<a id=__codelineno-48-33 name=__codelineno-48-33 href=#__codelineno-48-33></a>
<a id=__codelineno-48-34 name=__codelineno-48-34 href=#__codelineno-48-34></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-48-35 name=__codelineno-48-35 href=#__codelineno-48-35></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<a id=__codelineno-48-36 name=__codelineno-48-36 href=#__codelineno-48-36></a><span class=w>          </span><span class=c1># â†‘ Mismo puerto que EXPOSE 8000 en Dockerfile</span>
<a id=__codelineno-48-37 name=__codelineno-48-37 href=#__codelineno-48-37></a>
<a id=__codelineno-48-38 name=__codelineno-48-38 href=#__codelineno-48-38></a><span class=w>        </span><span class=nt>env</span><span class=p>:</span>
<a id=__codelineno-48-39 name=__codelineno-48-39 href=#__codelineno-48-39></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MODEL_PATH</span>
<a id=__codelineno-48-40 name=__codelineno-48-40 href=#__codelineno-48-40></a><span class=w>          </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/app/models/model.pkl&quot;</span>
<a id=__codelineno-48-41 name=__codelineno-48-41 href=#__codelineno-48-41></a><span class=w>          </span><span class=c1># â†‘ Variables de entorno inyectadas en runtime (no hardcodeadas en imagen)</span>
<a id=__codelineno-48-42 name=__codelineno-48-42 href=#__codelineno-48-42></a>
<a id=__codelineno-48-43 name=__codelineno-48-43 href=#__codelineno-48-43></a><span class=w>        </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-48-44 name=__codelineno-48-44 href=#__codelineno-48-44></a><span class=w>          </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-48-45 name=__codelineno-48-45 href=#__codelineno-48-45></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;512Mi&quot;</span><span class=w>  </span><span class=c1># â† MÃ­nimo garantizado de RAM</span>
<a id=__codelineno-48-46 name=__codelineno-48-46 href=#__codelineno-48-46></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;250m&quot;</span><span class=w>      </span><span class=c1># â† MÃ­nimo garantizado de CPU (250 millicores = 0.25 cores)</span>
<a id=__codelineno-48-47 name=__codelineno-48-47 href=#__codelineno-48-47></a><span class=w>          </span><span class=nt>limits</span><span class=p>:</span>
<a id=__codelineno-48-48 name=__codelineno-48-48 href=#__codelineno-48-48></a><span class=w>            </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1Gi&quot;</span><span class=w>    </span><span class=c1># â† MÃ¡ximo permitido de RAM</span>
<a id=__codelineno-48-49 name=__codelineno-48-49 href=#__codelineno-48-49></a><span class=w>            </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1000m&quot;</span><span class=w>     </span><span class=c1># â† MÃ¡ximo permitido de CPU (1 core)</span>
<a id=__codelineno-48-50 name=__codelineno-48-50 href=#__codelineno-48-50></a><span class=w>          </span><span class=c1># â†‘ resources: K8s usa esto para scheduling y evitar que un pod &quot;mate&quot; al nodo</span>
<a id=__codelineno-48-51 name=__codelineno-48-51 href=#__codelineno-48-51></a>
<a id=__codelineno-48-52 name=__codelineno-48-52 href=#__codelineno-48-52></a><span class=w>        </span><span class=nt>livenessProbe</span><span class=p>:</span>
<a id=__codelineno-48-53 name=__codelineno-48-53 href=#__codelineno-48-53></a><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span>
<a id=__codelineno-48-54 name=__codelineno-48-54 href=#__codelineno-48-54></a><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/health</span><span class=w>    </span><span class=c1># â† Mismo endpoint que HEALTHCHECK en Dockerfile</span>
<a id=__codelineno-48-55 name=__codelineno-48-55 href=#__codelineno-48-55></a><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<a id=__codelineno-48-56 name=__codelineno-48-56 href=#__codelineno-48-56></a><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span><span class=w>  </span><span class=c1># â† Espera 30s antes del primer check</span>
<a id=__codelineno-48-57 name=__codelineno-48-57 href=#__codelineno-48-57></a><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class=w>        </span><span class=c1># â† Cada 10s</span>
<a id=__codelineno-48-58 name=__codelineno-48-58 href=#__codelineno-48-58></a><span class=w>          </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w>      </span><span class=c1># â† 3 fallos = reinicia el pod</span>
<a id=__codelineno-48-59 name=__codelineno-48-59 href=#__codelineno-48-59></a><span class=w>          </span><span class=c1># â†‘ livenessProbe: K8s reinicia el pod si /health no responde</span>
<a id=__codelineno-48-60 name=__codelineno-48-60 href=#__codelineno-48-60></a>
<a id=__codelineno-48-61 name=__codelineno-48-61 href=#__codelineno-48-61></a><span class=w>        </span><span class=nt>readinessProbe</span><span class=p>:</span>
<a id=__codelineno-48-62 name=__codelineno-48-62 href=#__codelineno-48-62></a><span class=w>          </span><span class=nt>httpGet</span><span class=p>:</span>
<a id=__codelineno-48-63 name=__codelineno-48-63 href=#__codelineno-48-63></a><span class=w>            </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/health</span>
<a id=__codelineno-48-64 name=__codelineno-48-64 href=#__codelineno-48-64></a><span class=w>            </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
<a id=__codelineno-48-65 name=__codelineno-48-65 href=#__codelineno-48-65></a><span class=w>          </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class=w>  </span><span class=c1># â† Menos tiempo que liveness</span>
<a id=__codelineno-48-66 name=__codelineno-48-66 href=#__codelineno-48-66></a><span class=w>          </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<a id=__codelineno-48-67 name=__codelineno-48-67 href=#__codelineno-48-67></a><span class=w>          </span><span class=c1># â†‘ readinessProbe: K8s no envÃ­a trÃ¡fico hasta que el pod estÃ© ready</span>
<a id=__codelineno-48-68 name=__codelineno-48-68 href=#__codelineno-48-68></a>
<a id=__codelineno-48-69 name=__codelineno-48-69 href=#__codelineno-48-69></a><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-48-70 name=__codelineno-48-70 href=#__codelineno-48-70></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-storage</span>
<a id=__codelineno-48-71 name=__codelineno-48-71 href=#__codelineno-48-71></a><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/app/models</span><span class=w>  </span><span class=c1># â† Misma ruta que MODEL_PATH</span>
<a id=__codelineno-48-72 name=__codelineno-48-72 href=#__codelineno-48-72></a><span class=w>          </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w>          </span><span class=c1># â† Solo lectura (seguridad)</span>
<a id=__codelineno-48-73 name=__codelineno-48-73 href=#__codelineno-48-73></a><span class=w>          </span><span class=c1># â†‘ volumeMounts: modelos NO van en la imagen, se montan en runtime</span>
<a id=__codelineno-48-74 name=__codelineno-48-74 href=#__codelineno-48-74></a>
<a id=__codelineno-48-75 name=__codelineno-48-75 href=#__codelineno-48-75></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-48-76 name=__codelineno-48-76 href=#__codelineno-48-76></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">model-storage</span>
<a id=__codelineno-48-77 name=__codelineno-48-77 href=#__codelineno-48-77></a><span class=w>        </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span>
<a id=__codelineno-48-78 name=__codelineno-48-78 href=#__codelineno-48-78></a><span class=w>          </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ml-models-pvc</span>
<a id=__codelineno-48-79 name=__codelineno-48-79 href=#__codelineno-48-79></a><span class=w>          </span><span class=c1># â†‘ PVC: almacenamiento persistente para modelos (sobrevive a reinicios)</span>
</code></pre></div> <p><strong>Conexiones clave Dockerfile â†” K8s</strong>:</p> <table> <thead> <tr> <th>Dockerfile</th> <th>Kubernetes Deployment</th> </tr> </thead> <tbody> <tr> <td><code>EXPOSE 8000</code></td> <td><code>containerPort: 8000</code></td> </tr> <tr> <td><code>HEALTHCHECK</code></td> <td><code>livenessProbe</code> + <code>readinessProbe</code></td> </tr> <tr> <td><code>USER appuser</code></td> <td><code>securityContext.runAsUser: 1000</code></td> </tr> <tr> <td><code>ENV MODEL_PATH</code></td> <td><code>env: - name: MODEL_PATH</code></td> </tr> <tr> <td><code>CMD ["uvicorn"...]</code></td> <td>(hereda del Dockerfile)</td> </tr> <tr> <td><code>mkdir -p models</code></td> <td><code>volumeMounts.mountPath: /app/models</code></td> </tr> </tbody> </table> <hr> <h3 id=1378-metricas-de-exito-como-saber-que-lo-hiciste-bien>13.7.8 ğŸ“Š MÃ©tricas de Ã‰xito: Â¿CÃ³mo Saber que lo Hiciste Bien?<a class=headerlink href=#1378-metricas-de-exito-como-saber-que-lo-hiciste-bien title="Permanent link">&para;</a></h3> <p>DespuÃ©s de completar el laboratorio, verifica estas mÃ©tricas:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=c1># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=c1># Script de verificaciÃ³n: check_docker_quality.sh</span>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=c1># Ejecuta despuÃ©s de construir tu imagen</span>
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=c1># â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</span>
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a>
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=c1>#!/bin/bash</span>
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=c1># Script para verificar la calidad de tu imagen Docker</span>
<a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=c1># Uso: bash check_docker_quality.sh bankchurn:latest</span>
<a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a>
<a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=nv>IMAGE_NAME</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=s2>&quot;bankchurn:latest&quot;</span><span class=si>}</span>
<a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a>
<a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸ” Verificando imagen: </span><span class=nv>$IMAGE_NAME</span><span class=s2>&quot;</span>
<a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•&quot;</span>
<a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a>
<a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class=c1># 1. Verificar tamaÃ±o de imagen</span>
<a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class=c1># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=nv>SIZE</span><span class=o>=</span><span class=k>$(</span>docker<span class=w> </span>images<span class=w> </span><span class=nv>$IMAGE_NAME</span><span class=w> </span>--format<span class=w> </span><span class=s2>&quot;{{.Size}}&quot;</span><span class=k>)</span>
<a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸ“¦ TamaÃ±o de imagen: </span><span class=nv>$SIZE</span><span class=s2>&quot;</span>
<a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a><span class=c1># Objetivo: &lt; 500MB para imÃ¡genes de ML</span>
<a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a>
<a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a><span class=c1># 2. Verificar que NO tiene compiladores</span>
<a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a><span class=c1># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸ”§ Verificando ausencia de compiladores...&quot;</span>
<a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a>docker<span class=w> </span>run<span class=w> </span>--rm<span class=w> </span><span class=nv>$IMAGE_NAME</span><span class=w> </span>which<span class=w> </span>gcc<span class=w> </span><span class=m>2</span>&gt;/dev/null
<a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$?</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   âŒ PROBLEMA: gcc encontrado en imagen runtime&quot;</span>
<a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=k>else</span>
<a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   âœ… OK: gcc no presente (multi-stage funcionÃ³)&quot;</span>
<a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a><span class=k>fi</span>
<a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a>
<a id=__codelineno-49-32 name=__codelineno-49-32 href=#__codelineno-49-32></a><span class=c1># 3. Verificar usuario non-root</span>
<a id=__codelineno-49-33 name=__codelineno-49-33 href=#__codelineno-49-33></a><span class=c1># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-49-34 name=__codelineno-49-34 href=#__codelineno-49-34></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-49-35 name=__codelineno-49-35 href=#__codelineno-49-35></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸ‘¤ Verificando usuario...&quot;</span>
<a id=__codelineno-49-36 name=__codelineno-49-36 href=#__codelineno-49-36></a><span class=nv>USER</span><span class=o>=</span><span class=k>$(</span>docker<span class=w> </span>run<span class=w> </span>--rm<span class=w> </span><span class=nv>$IMAGE_NAME</span><span class=w> </span>whoami<span class=k>)</span>
<a id=__codelineno-49-37 name=__codelineno-49-37 href=#__codelineno-49-37></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   Usuario actual: </span><span class=nv>$USER</span><span class=s2>&quot;</span>
<a id=__codelineno-49-38 name=__codelineno-49-38 href=#__codelineno-49-38></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$USER</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;appuser&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-49-39 name=__codelineno-49-39 href=#__codelineno-49-39></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   âœ… OK: Corre como non-root&quot;</span>
<a id=__codelineno-49-40 name=__codelineno-49-40 href=#__codelineno-49-40></a><span class=k>else</span>
<a id=__codelineno-49-41 name=__codelineno-49-41 href=#__codelineno-49-41></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   âŒ PROBLEMA: Corre como </span><span class=nv>$USER</span><span class=s2> (deberÃ­a ser appuser)&quot;</span>
<a id=__codelineno-49-42 name=__codelineno-49-42 href=#__codelineno-49-42></a><span class=k>fi</span>
<a id=__codelineno-49-43 name=__codelineno-49-43 href=#__codelineno-49-43></a>
<a id=__codelineno-49-44 name=__codelineno-49-44 href=#__codelineno-49-44></a><span class=c1># 4. Verificar PYTHONPATH</span>
<a id=__codelineno-49-45 name=__codelineno-49-45 href=#__codelineno-49-45></a><span class=c1># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-49-46 name=__codelineno-49-46 href=#__codelineno-49-46></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-49-47 name=__codelineno-49-47 href=#__codelineno-49-47></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸ Verificando PYTHONPATH...&quot;</span>
<a id=__codelineno-49-48 name=__codelineno-49-48 href=#__codelineno-49-48></a><span class=nv>PYPATH</span><span class=o>=</span><span class=k>$(</span>docker<span class=w> </span>run<span class=w> </span>--rm<span class=w> </span><span class=nv>$IMAGE_NAME</span><span class=w> </span>printenv<span class=w> </span>PYTHONPATH<span class=k>)</span>
<a id=__codelineno-49-49 name=__codelineno-49-49 href=#__codelineno-49-49></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   PYTHONPATH: </span><span class=nv>$PYPATH</span><span class=s2>&quot;</span>
<a id=__codelineno-49-50 name=__codelineno-49-50 href=#__codelineno-49-50></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$PYPATH</span><span class=s2>&quot;</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s2>&quot;/app&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-49-51 name=__codelineno-49-51 href=#__codelineno-49-51></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   âœ… OK: PYTHONPATH configurado&quot;</span>
<a id=__codelineno-49-52 name=__codelineno-49-52 href=#__codelineno-49-52></a><span class=k>else</span>
<a id=__codelineno-49-53 name=__codelineno-49-53 href=#__codelineno-49-53></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   âŒ PROBLEMA: PYTHONPATH incorrecto o no configurado&quot;</span>
<a id=__codelineno-49-54 name=__codelineno-49-54 href=#__codelineno-49-54></a><span class=k>fi</span>
<a id=__codelineno-49-55 name=__codelineno-49-55 href=#__codelineno-49-55></a>
<a id=__codelineno-49-56 name=__codelineno-49-56 href=#__codelineno-49-56></a><span class=c1># 5. Verificar estructura de directorios</span>
<a id=__codelineno-49-57 name=__codelineno-49-57 href=#__codelineno-49-57></a><span class=c1># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-49-58 name=__codelineno-49-58 href=#__codelineno-49-58></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-49-59 name=__codelineno-49-59 href=#__codelineno-49-59></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸ“ Verificando estructura...&quot;</span>
<a id=__codelineno-49-60 name=__codelineno-49-60 href=#__codelineno-49-60></a>docker<span class=w> </span>run<span class=w> </span>--rm<span class=w> </span><span class=nv>$IMAGE_NAME</span><span class=w> </span>ls<span class=w> </span>-la<span class=w> </span>/app<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-10
<a id=__codelineno-49-61 name=__codelineno-49-61 href=#__codelineno-49-61></a>
<a id=__codelineno-49-62 name=__codelineno-49-62 href=#__codelineno-49-62></a><span class=c1># 6. Verificar healthcheck</span>
<a id=__codelineno-49-63 name=__codelineno-49-63 href=#__codelineno-49-63></a><span class=c1># â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<a id=__codelineno-49-64 name=__codelineno-49-64 href=#__codelineno-49-64></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-49-65 name=__codelineno-49-65 href=#__codelineno-49-65></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;ğŸ’“ Verificando HEALTHCHECK configurado...&quot;</span>
<a id=__codelineno-49-66 name=__codelineno-49-66 href=#__codelineno-49-66></a><span class=nv>HEALTH</span><span class=o>=</span><span class=k>$(</span>docker<span class=w> </span>inspect<span class=w> </span><span class=nv>$IMAGE_NAME</span><span class=w> </span>--format<span class=o>=</span><span class=s1>&#39;{{.Config.Healthcheck}}&#39;</span><span class=k>)</span>
<a id=__codelineno-49-67 name=__codelineno-49-67 href=#__codelineno-49-67></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$HEALTH</span><span class=s2>&quot;</span><span class=w> </span>!<span class=o>=</span><span class=w> </span><span class=s2>&quot;&lt;nil&gt;&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-49-68 name=__codelineno-49-68 href=#__codelineno-49-68></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   âœ… OK: HEALTHCHECK presente&quot;</span>
<a id=__codelineno-49-69 name=__codelineno-49-69 href=#__codelineno-49-69></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   ConfiguraciÃ³n: </span><span class=nv>$HEALTH</span><span class=s2>&quot;</span>
<a id=__codelineno-49-70 name=__codelineno-49-70 href=#__codelineno-49-70></a><span class=k>else</span>
<a id=__codelineno-49-71 name=__codelineno-49-71 href=#__codelineno-49-71></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;   âŒ PROBLEMA: Sin HEALTHCHECK configurado&quot;</span>
<a id=__codelineno-49-72 name=__codelineno-49-72 href=#__codelineno-49-72></a><span class=k>fi</span>
<a id=__codelineno-49-73 name=__codelineno-49-73 href=#__codelineno-49-73></a>
<a id=__codelineno-49-74 name=__codelineno-49-74 href=#__codelineno-49-74></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<a id=__codelineno-49-75 name=__codelineno-49-75 href=#__codelineno-49-75></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•&quot;</span>
<a id=__codelineno-49-76 name=__codelineno-49-76 href=#__codelineno-49-76></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;âœ… VerificaciÃ³n completada&quot;</span>
</code></pre></div> <p><strong>Tabla de MÃ©tricas Objetivo</strong>:</p> <table> <thead> <tr> <th>MÃ©trica</th> <th>âŒ Malo</th> <th>âš ï¸ Aceptable</th> <th>âœ… Excelente</th> </tr> </thead> <tbody> <tr> <td><strong>TamaÃ±o de imagen</strong></td> <td>&gt; 1GB</td> <td>500MB-1GB</td> <td>&lt; 500MB</td> </tr> <tr> <td><strong>Tiempo de build (con cache)</strong></td> <td>&gt; 5min</td> <td>1-5min</td> <td>&lt; 1min</td> </tr> <tr> <td><strong>Tiempo de build (sin cache)</strong></td> <td>&gt; 15min</td> <td>5-15min</td> <td>&lt; 5min</td> </tr> <tr> <td><strong>Usuario en runtime</strong></td> <td>root</td> <td>-</td> <td>appuser (non-root)</td> </tr> <tr> <td><strong>HEALTHCHECK</strong></td> <td>ausente</td> <td>presente sin start-period</td> <td>completo</td> </tr> <tr> <td><strong>Layers de imagen</strong></td> <td>&gt; 20</td> <td>10-20</td> <td>&lt; 10</td> </tr> </tbody> </table> <hr> <p><a id=errores-habituales></a></p> <h2 id=errores-habituales-y-como-depurarlos-en-docker-para-ml>ğŸ§¨ Errores habituales y cÃ³mo depurarlos en Docker para ML<a class=headerlink href=#errores-habituales-y-como-depurarlos-en-docker-para-ml title="Permanent link">&para;</a></h2> <p>En ML es muy comÃºn tener imÃ¡genes gigantes, problemas de permisos o contenedores que â€œfuncionan en mi mÃ¡quina pero no en producciÃ³nâ€.</p> <p>Si alguno de estos errores te tomÃ³ <strong>&gt;15 minutos</strong>, regÃ­stralo en el <strong><a href=../study_tools/DIARIO_ERRORES/ >Diario de Errores</a></strong> y aplica el flujo de <strong>rescate cognitivo</strong> de <strong><a href=../study_tools/PROTOCOLO_E/ >Protocolo E</a></strong>.</p> <h3 id=1-imagenes-demasiado-grandes>1) ImÃ¡genes demasiado grandes<a class=headerlink href=#1-imagenes-demasiado-grandes title="Permanent link">&para;</a></h3> <p><strong>SÃ­ntomas tÃ­picos</strong></p> <ul> <li><code>docker images</code> muestra tamaÃ±os &gt; 1GB.</li> <li>Push/pull al registry tarda mucho o falla por timeout.</li> </ul> <p><strong>CÃ³mo identificarlo</strong></p> <ul> <li>Compara tu Dockerfile con los ejemplos <code>python:3.11</code> vs <code>python:3.11-slim</code> del mÃ³dulo.</li> <li>Revisa si estÃ¡s copiando todo el repo (<code>COPY . .</code>) sin <code>.dockerignore</code>.</li> </ul> <p><strong>CÃ³mo corregirlo</strong></p> <ul> <li>Usa bases <code>slim</code> y <strong>multi-stage builds</strong>.</li> <li>AÃ±ade un <code>.dockerignore</code> que excluya datos, notebooks, tests y <code>.venv</code>.</li> </ul> <hr> <h3 id=2-errores-de-permisos-al-correr-como-non-root>2) Errores de permisos al correr como non-root<a class=headerlink href=#2-errores-de-permisos-al-correr-como-non-root title="Permanent link">&para;</a></h3> <p><strong>SÃ­ntomas tÃ­picos</strong></p> <ul> <li>El contenedor arranca pero falla al leer modelos, logs o escribir en directorios.</li> <li>Mensajes tipo <code>Permission denied: '/app/models/model.joblib'</code>.</li> </ul> <p><strong>CÃ³mo identificarlo</strong></p> <ul> <li>Verifica que despuÃ©s de copiar archivos hagas <code>chown</code> al usuario de la app.</li> <li>Revisa que <code>USER appuser</code> aparezca <strong>despuÃ©s</strong> de ajustar permisos.</li> </ul> <p><strong>CÃ³mo corregirlo</strong></p> <ul> <li>AsegÃºrate de: <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=k>RUN</span><span class=w> </span>useradd<span class=w> </span>-m<span class=w> </span>-u<span class=w> </span><span class=m>1000</span><span class=w> </span>appuser<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>chown<span class=w> </span>-R<span class=w> </span>appuser:appuser<span class=w> </span>/app
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=k>USER</span><span class=w> </span><span class=s>appuser</span>
</code></pre></div></li> <li>Monta volÃºmenes con permisos compatibles (por ejemplo, propiedad UID 1000 en host).</li> </ul> <hr> <h3 id=3-modelo-o-artefactos-no-encontrados-dentro-del-contenedor>3) Modelo o artefactos no encontrados dentro del contenedor<a class=headerlink href=#3-modelo-o-artefactos-no-encontrados-dentro-del-contenedor title="Permanent link">&para;</a></h3> <p><strong>SÃ­ntomas tÃ­picos</strong></p> <ul> <li>La API levanta pero responde 500 porque no encuentra el modelo (<code>FileNotFoundError</code>).</li> </ul> <p><strong>CÃ³mo identificarlo</strong></p> <ul> <li>Revisa las rutas de <code>COPY</code> en el Dockerfile y las rutas que tu cÃ³digo usa (<code>./models</code>, <code>./artifacts</code>).</li> </ul> <p><strong>CÃ³mo corregirlo</strong></p> <ul> <li>Copia los artefactos a la ruta esperada o monta un volumen de solo lectura: <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./BankChurn-Predictor/models:/app/models:ro</span>
</code></pre></div></li> </ul> <hr> <h3 id=4-contenedores-que-arrancan-pero-el-healthcheck-falla>4) Contenedores que arrancan pero el healthcheck falla<a class=headerlink href=#4-contenedores-que-arrancan-pero-el-healthcheck-falla title="Permanent link">&para;</a></h3> <p><strong>SÃ­ntomas tÃ­picos</strong></p> <ul> <li>El servicio aparece como "unhealthy" en <code>docker ps</code>.</li> </ul> <p><strong>CÃ³mo identificarlo</strong></p> <ul> <li>Examina el <code>HEALTHCHECK</code> y verifica que la URL y puerto sean correctos.</li> </ul> <p><strong>CÃ³mo corregirlo</strong></p> <ul> <li>AsegÃºrate de que el endpoint <code>/health</code> exista y escuche en el mismo puerto que expones.</li> <li>Ajusta tiempos de <code>start-period</code> si el modelo tarda mÃ¡s en cargar.</li> </ul> <hr> <h3 id=5-patron-general-de-debugging-con-docker>5) PatrÃ³n general de debugging con Docker<a class=headerlink href=#5-patron-general-de-debugging-con-docker title="Permanent link">&para;</a></h3> <ol> <li>Inspecciona el contenedor en ejecuciÃ³n con <code>docker exec -it &lt;container&gt; /bin/bash</code>.</li> <li>Navega por <code>/app</code> para verificar que el cÃ³digo, modelos y configs estÃ©n donde esperas.</li> <li>Comprueba permisos (<code>ls -l</code>) y usuario actual (<code>whoami</code>).</li> <li>Si la imagen es muy grande, revisa el historial de capas con <code>docker history</code>.</li> </ol> <p>Con este enfoque, tus imÃ¡genes Docker serÃ¡n reproducibles, ligeras y listas para producciÃ³n.</p> <hr> <p><a id=checkpoint></a></p> <h2 id=checkpoint>âœ… Checkpoint<a class=headerlink href=#checkpoint title="Permanent link">&para;</a></h2> <ul> <li>[ ] Tu Dockerfile usa base <code>slim</code> (o alternativa justificada) y evita <code>COPY . .</code> sin <code>.dockerignore</code></li> <li>[ ] Tienes <code>.dockerignore</code> que excluye <code>data/</code>, <code>notebooks/</code>, <code>tests/</code>, <code>.venv/</code></li> <li>[ ] El contenedor corre como usuario no-root</li> <li>[ ] Puedes construir y correr la imagen (<code>docker build</code> + <code>docker run</code>)</li> <li>[ ] La API responde a <code>/health</code> (o endpoint equivalente)</li> </ul> <hr> <h2 id=consejos-profesionales>ğŸ’¼ Consejos Profesionales<a class=headerlink href=#consejos-profesionales title="Permanent link">&para;</a></h2> <blockquote> <p><strong>Recomendaciones para destacar en entrevistas y proyectos reales</strong></p> </blockquote> <h3 id=para-entrevistas>Para Entrevistas<a class=headerlink href=#para-entrevistas title="Permanent link">&para;</a></h3> <ol> <li> <p><strong>Multi-stage builds</strong>: Explica cÃ³mo reducen tamaÃ±o de imagen.</p> </li> <li> <p><strong>Layer caching</strong>: Por quÃ© el orden de instrucciones importa.</p> </li> <li> <p><strong>Security</strong>: No correr como root, no incluir secrets en imagen.</p> </li> </ol> <h3 id=para-proyectos-reales>Para Proyectos Reales<a class=headerlink href=#para-proyectos-reales title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>SituaciÃ³n</th> <th>Consejo</th> </tr> </thead> <tbody> <tr> <td>ImÃ¡genes grandes</td> <td>Multi-stage + slim base images</td> </tr> <tr> <td>Secrets</td> <td>Usa build args o secrets mounting</td> </tr> <tr> <td>Debugging</td> <td>Usa <code>docker exec -it container bash</code></td> </tr> <tr> <td>ProducciÃ³n</td> <td>Healthchecks obligatorios</td> </tr> </tbody> </table> <h3 id=dockerfile-optimizado>Dockerfile Optimizado<a class=headerlink href=#dockerfile-optimizado title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=c># Stage 1: Build</span>
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>builder</span>
<a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>wheel<span class=w> </span>--no-cache-dir<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a>
<a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=c># Stage 2: Runtime</span>
<a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span>
<a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>/wheels<span class=w> </span>/wheels
<a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--no-cache<span class=w> </span>/wheels/*
<a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class=k>COPY</span><span class=w> </span>src/<span class=w> </span>/app/src/
<a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=k>USER</span><span class=w> </span><span class=s>nobody</span>
<a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=k>HEALTHCHECK</span><span class=w> </span><span class=k>CMD</span><span class=w> </span>curl<span class=w> </span>-f<span class=w> </span>http://localhost:8000/health
</code></pre></div> <hr> <h2 id=recursos-externos-del-modulo>ğŸ“º Recursos Externos del MÃ³dulo<a class=headerlink href=#recursos-externos-del-modulo title="Permanent link">&para;</a></h2> <blockquote> <p>ğŸ·ï¸ Sistema: ğŸ”´ Obligatorio | ğŸŸ¡ Recomendado | ğŸŸ¢ Complementario</p> </blockquote> <h3 id=videos>ğŸ¬ Videos<a class=headerlink href=#videos title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th style="text-align: center;">ğŸ·ï¸</th> <th style="text-align: left;">TÃ­tulo</th> <th style="text-align: left;">Canal</th> <th style="text-align: center;">DuraciÃ³n</th> <th style="text-align: left;">Link</th> </tr> </thead> <tbody> <tr> <td style="text-align: center;">ğŸ”´</td> <td style="text-align: left;"><strong>Docker Tutorial for Beginners</strong></td> <td style="text-align: left;">TechWorld Nana</td> <td style="text-align: center;">2.5h</td> <td style="text-align: left;"><a href="https://www.youtube.com/watch?v=3c-iBn73dDE">YouTube</a></td> </tr> <tr> <td style="text-align: center;">ğŸ”´</td> <td style="text-align: left;"><strong>Multi-stage Docker Builds</strong></td> <td style="text-align: left;">Docker</td> <td style="text-align: center;">15 min</td> <td style="text-align: left;"><a href="https://www.youtube.com/watch?v=zpkqNPwEzac">YouTube</a></td> </tr> <tr> <td style="text-align: center;">ğŸŸ¡</td> <td style="text-align: left;"><strong>Docker Compose Tutorial</strong></td> <td style="text-align: left;">TechWorld Nana</td> <td style="text-align: center;">1h</td> <td style="text-align: left;"><a href="https://www.youtube.com/watch?v=HG6yIjZapSA">YouTube</a></td> </tr> </tbody> </table> <h3 id=documentacion>ğŸ“„ DocumentaciÃ³n<a class=headerlink href=#documentacion title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th style="text-align: center;">ğŸ·ï¸</th> <th style="text-align: left;">Recurso</th> <th style="text-align: left;">DescripciÃ³n</th> </tr> </thead> <tbody> <tr> <td style="text-align: center;">ğŸ”´</td> <td style="text-align: left;"><a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/ >Dockerfile Best Practices</a></td> <td style="text-align: left;">GuÃ­a oficial</td> </tr> <tr> <td style="text-align: center;">ğŸŸ¡</td> <td style="text-align: left;"><a href=https://docs.docker.com/build/building/multi-stage/ >Multi-stage Builds</a></td> <td style="text-align: left;">OptimizaciÃ³n de imÃ¡genes</td> </tr> </tbody> </table> <hr> <h2 id=decision-tecnica-adr-006-docker-multi-stage>âš–ï¸ DecisiÃ³n TÃ©cnica: ADR-006 Docker Multi-stage<a class=headerlink href=#decision-tecnica-adr-006-docker-multi-stage title="Permanent link">&para;</a></h2> <p><strong>Contexto</strong>: Necesitamos imÃ¡genes Docker pequeÃ±as y seguras para producciÃ³n.</p> <p><strong>DecisiÃ³n</strong>: Usar multi-stage builds con bases slim.</p> <p><strong>Alternativas Consideradas</strong>: - <strong>Single-stage</strong>: MÃ¡s simple pero imÃ¡genes ~2GB - <strong>Distroless</strong>: MÃ¡s seguro pero difÃ­cil de debuggear - <strong>Alpine</strong>: MÃ¡s pequeÃ±o pero problemas con algunas libs Python</p> <p><strong>Consecuencias</strong>: - âœ… ImÃ¡genes de ~500MB vs ~2GB - âœ… Sin herramientas de build en runtime - âœ… MÃ¡s rÃ¡pido de desplegar - âŒ Dockerfiles mÃ¡s complejos</p> <hr> <h2 id=ejercicios-del-modulo>ğŸ”§ Ejercicios del MÃ³dulo<a class=headerlink href=#ejercicios-del-modulo title="Permanent link">&para;</a></h2> <h3 id=ejercicio-131-dockerfile-multi-stage>Ejercicio 13.1: Dockerfile Multi-stage<a class=headerlink href=#ejercicio-131-dockerfile-multi-stage title="Permanent link">&para;</a></h3> <p><strong>Objetivo</strong>: Crear Dockerfile optimizado para ML API. <strong>Dificultad</strong>: â­â­â­</p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=c># TU TAREA: Crear Dockerfile que:</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=c># 1. Use multi-stage build</span>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=c># 2. Instale dependencias en stage 1</span>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=c># 3. Copie solo lo necesario a stage 2</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=c># 4. Use usuario non-root</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=c># 5. Incluya healthcheck</span>
</code></pre></div> <details> <summary>ğŸ’¡ Ver soluciÃ³n</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=c># Stage 1: Builder</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>builder</span>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/build</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a>
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=c># Instalar dependencias de build</span>
<a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=k>RUN</span><span class=w> </span>apt-get<span class=w> </span>update<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>apt-get<span class=w> </span>install<span class=w> </span>-y<span class=w> </span>--no-install-recommends<span class=w> </span><span class=se>\</span>
<a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=w>    </span>build-essential<span class=w> </span><span class=se>\</span>
<a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=w>    </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/var/lib/apt/lists/*
<a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a>
<a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=c># Copiar solo requirements primero (mejor cache)</span>
<a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>wheel<span class=w> </span>--no-cache-dir<span class=w> </span>--wheel-dir<span class=w> </span>/wheels<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a>
<a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a><span class=c># Stage 2: Runtime</span>
<a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span>
<a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a>
<a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-54-19 name=__codelineno-54-19 href=#__codelineno-54-19></a>
<a id=__codelineno-54-20 name=__codelineno-54-20 href=#__codelineno-54-20></a><span class=c># Instalar wheels pre-compilados</span>
<a id=__codelineno-54-21 name=__codelineno-54-21 href=#__codelineno-54-21></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>/wheels<span class=w> </span>/wheels
<a id=__codelineno-54-22 name=__codelineno-54-22 href=#__codelineno-54-22></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--no-cache-dir<span class=w> </span>/wheels/*<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/wheels
<a id=__codelineno-54-23 name=__codelineno-54-23 href=#__codelineno-54-23></a>
<a id=__codelineno-54-24 name=__codelineno-54-24 href=#__codelineno-54-24></a><span class=c># Crear usuario non-root</span>
<a id=__codelineno-54-25 name=__codelineno-54-25 href=#__codelineno-54-25></a><span class=k>RUN</span><span class=w> </span>useradd<span class=w> </span>-m<span class=w> </span>-u<span class=w> </span><span class=m>1000</span><span class=w> </span>appuser<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-54-26 name=__codelineno-54-26 href=#__codelineno-54-26></a><span class=w>    </span>chown<span class=w> </span>-R<span class=w> </span>appuser:appuser<span class=w> </span>/app
<a id=__codelineno-54-27 name=__codelineno-54-27 href=#__codelineno-54-27></a>
<a id=__codelineno-54-28 name=__codelineno-54-28 href=#__codelineno-54-28></a><span class=c># Copiar cÃ³digo</span>
<a id=__codelineno-54-29 name=__codelineno-54-29 href=#__codelineno-54-29></a><span class=k>COPY</span><span class=w> </span>--chown<span class=o>=</span>appuser:appuser<span class=w> </span>src/<span class=w> </span>./src/
<a id=__codelineno-54-30 name=__codelineno-54-30 href=#__codelineno-54-30></a><span class=k>COPY</span><span class=w> </span>--chown<span class=o>=</span>appuser:appuser<span class=w> </span>app/<span class=w> </span>./app/
<a id=__codelineno-54-31 name=__codelineno-54-31 href=#__codelineno-54-31></a><span class=k>COPY</span><span class=w> </span>--chown<span class=o>=</span>appuser:appuser<span class=w> </span>artifacts/<span class=w> </span>./artifacts/
<a id=__codelineno-54-32 name=__codelineno-54-32 href=#__codelineno-54-32></a>
<a id=__codelineno-54-33 name=__codelineno-54-33 href=#__codelineno-54-33></a><span class=c># Cambiar a non-root</span>
<a id=__codelineno-54-34 name=__codelineno-54-34 href=#__codelineno-54-34></a><span class=k>USER</span><span class=w> </span><span class=s>appuser</span>
<a id=__codelineno-54-35 name=__codelineno-54-35 href=#__codelineno-54-35></a>
<a id=__codelineno-54-36 name=__codelineno-54-36 href=#__codelineno-54-36></a><span class=c># Variables de entorno</span>
<a id=__codelineno-54-37 name=__codelineno-54-37 href=#__codelineno-54-37></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONUNBUFFERED</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-54-38 name=__codelineno-54-38 href=#__codelineno-54-38></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONDONTWRITEBYTECODE</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-54-39 name=__codelineno-54-39 href=#__codelineno-54-39></a>
<a id=__codelineno-54-40 name=__codelineno-54-40 href=#__codelineno-54-40></a><span class=c># Puerto</span>
<a id=__codelineno-54-41 name=__codelineno-54-41 href=#__codelineno-54-41></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>8000</span>
<a id=__codelineno-54-42 name=__codelineno-54-42 href=#__codelineno-54-42></a>
<a id=__codelineno-54-43 name=__codelineno-54-43 href=#__codelineno-54-43></a><span class=c># Healthcheck</span>
<a id=__codelineno-54-44 name=__codelineno-54-44 href=#__codelineno-54-44></a><span class=k>HEALTHCHECK</span><span class=w> </span>--interval<span class=o>=</span>30s<span class=w> </span>--timeout<span class=o>=</span>10s<span class=w> </span>--start-period<span class=o>=</span>5s<span class=w> </span>--retries<span class=o>=</span><span class=m>3</span><span class=w> </span><span class=se>\</span>
<a id=__codelineno-54-45 name=__codelineno-54-45 href=#__codelineno-54-45></a><span class=w>    </span>CMD<span class=w> </span>curl<span class=w> </span>-f<span class=w> </span>http://localhost:8000/health<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-54-46 name=__codelineno-54-46 href=#__codelineno-54-46></a>
<a id=__codelineno-54-47 name=__codelineno-54-47 href=#__codelineno-54-47></a><span class=c># Comando</span>
<a id=__codelineno-54-48 name=__codelineno-54-48 href=#__codelineno-54-48></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;uvicorn&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.fastapi_app:app&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--host&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.0.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--port&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;8000&quot;</span><span class=p>]</span>
</code></pre></div> </details> <hr> <h3 id=ejercicio-132-docker-compose-stack>Ejercicio 13.2: Docker Compose Stack<a class=headerlink href=#ejercicio-132-docker-compose-stack title="Permanent link">&para;</a></h3> <p><strong>Objetivo</strong>: Orquestar servicios ML con docker-compose. <strong>Dificultad</strong>: â­â­â­</p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=c1># docker-compose.yml</span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=c1># TU TAREA: Crear stack con:</span>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=c1># - API ML</span>
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=c1># - MLflow server</span>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=c1># - Prometheus</span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=c1># - VolÃºmenes persistentes</span>
</code></pre></div> <details> <summary>ğŸ’¡ Ver soluciÃ³n</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=nt>services</span><span class=p>:</span>
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
<a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8000:8000&quot;</span>
<a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./artifacts:/app/artifacts:ro</span>
<a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
<a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">MLFLOW_TRACKING_URI=http://mlflow:5000</span>
<a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
<a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mlflow</span>
<a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
<a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost:8000/health&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
<a id=__codelineno-56-17 name=__codelineno-56-17 href=#__codelineno-56-17></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
<a id=__codelineno-56-18 name=__codelineno-56-18 href=#__codelineno-56-18></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-56-19 name=__codelineno-56-19 href=#__codelineno-56-19></a>
<a id=__codelineno-56-20 name=__codelineno-56-20 href=#__codelineno-56-20></a><span class=w>  </span><span class=nt>mlflow</span><span class=p>:</span>
<a id=__codelineno-56-21 name=__codelineno-56-21 href=#__codelineno-56-21></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/mlflow/mlflow:v2.9.0</span>
<a id=__codelineno-56-22 name=__codelineno-56-22 href=#__codelineno-56-22></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-56-23 name=__codelineno-56-23 href=#__codelineno-56-23></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;5000:5000&quot;</span>
<a id=__codelineno-56-24 name=__codelineno-56-24 href=#__codelineno-56-24></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-56-25 name=__codelineno-56-25 href=#__codelineno-56-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">mlflow_data:/mlflow</span>
<a id=__codelineno-56-26 name=__codelineno-56-26 href=#__codelineno-56-26></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
<a id=__codelineno-56-27 name=__codelineno-56-27 href=#__codelineno-56-27></a><span class=w>      </span><span class=no>mlflow server</span>
<a id=__codelineno-56-28 name=__codelineno-56-28 href=#__codelineno-56-28></a><span class=w>      </span><span class=no>--host 0.0.0.0</span>
<a id=__codelineno-56-29 name=__codelineno-56-29 href=#__codelineno-56-29></a><span class=w>      </span><span class=no>--port 5000</span>
<a id=__codelineno-56-30 name=__codelineno-56-30 href=#__codelineno-56-30></a><span class=w>      </span><span class=no>--backend-store-uri sqlite:///mlflow/mlflow.db</span>
<a id=__codelineno-56-31 name=__codelineno-56-31 href=#__codelineno-56-31></a><span class=w>      </span><span class=no>--default-artifact-root /mlflow/artifacts</span>
<a id=__codelineno-56-32 name=__codelineno-56-32 href=#__codelineno-56-32></a>
<a id=__codelineno-56-33 name=__codelineno-56-33 href=#__codelineno-56-33></a><span class=w>  </span><span class=nt>prometheus</span><span class=p>:</span>
<a id=__codelineno-56-34 name=__codelineno-56-34 href=#__codelineno-56-34></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:v2.47.0</span>
<a id=__codelineno-56-35 name=__codelineno-56-35 href=#__codelineno-56-35></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
<a id=__codelineno-56-36 name=__codelineno-56-36 href=#__codelineno-56-36></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;9090:9090&quot;</span>
<a id=__codelineno-56-37 name=__codelineno-56-37 href=#__codelineno-56-37></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-56-38 name=__codelineno-56-38 href=#__codelineno-56-38></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./prometheus.yml:/etc/prometheus/prometheus.yml:ro</span>
<a id=__codelineno-56-39 name=__codelineno-56-39 href=#__codelineno-56-39></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prometheus_data:/prometheus</span>
<a id=__codelineno-56-40 name=__codelineno-56-40 href=#__codelineno-56-40></a>
<a id=__codelineno-56-41 name=__codelineno-56-41 href=#__codelineno-56-41></a><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-56-42 name=__codelineno-56-42 href=#__codelineno-56-42></a><span class=w>  </span><span class=nt>mlflow_data</span><span class=p>:</span>
<a id=__codelineno-56-43 name=__codelineno-56-43 href=#__codelineno-56-43></a><span class=w>  </span><span class=nt>prometheus_data</span><span class=p>:</span>
</code></pre></div> </details> <hr> <h2 id=glosario-del-modulo>ğŸ”— Glosario del MÃ³dulo<a class=headerlink href=#glosario-del-modulo title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>TÃ©rmino</th> <th>DefiniciÃ³n</th> </tr> </thead> <tbody> <tr> <td><strong>Multi-stage Build</strong></td> <td>Dockerfile con mÃºltiples FROM para separar build y runtime</td> </tr> <tr> <td><strong>Docker Compose</strong></td> <td>Herramienta para definir y ejecutar multi-container apps</td> </tr> <tr> <td><strong>Non-root User</strong></td> <td>Usuario sin privilegios para mayor seguridad</td> </tr> <tr> <td><strong>Healthcheck</strong></td> <td>Comando que verifica que el contenedor estÃ¡ healthy</td> </tr> </tbody> </table> <hr> <h2 id=la-trampa-errores-comunes-de-este-modulo>ğŸª¤ La Trampa â€” Errores Comunes de Este MÃ³dulo<a class=headerlink href=#la-trampa-errores-comunes-de-este-modulo title="Permanent link">&para;</a></h2> <h3 id=trampa-1-dockerfile-que-solo-funciona-en-tu-maquina>Trampa 1: Dockerfile que solo funciona en tu mÃ¡quina<a class=headerlink href=#trampa-1-dockerfile-que-solo-funciona-en-tu-maquina title="Permanent link">&para;</a></h3> <p><strong>SÃ­ntoma</strong>: Build falla en CI con "No module named 'src'"</p> <p><strong>Causa raÃ­z</strong>: <code>.dockerignore</code> no existe o estÃ¡ mal configurado.</p> <p><strong>SoluciÃ³n</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=c># .dockerignore</span>
<a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>.git
<a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a>.venv
<a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a>__pycache__
<a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a>*.pyc
<a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a>.pytest_cache
</code></pre></div></p> <hr> <h3 id=trampa-2-container-que-muere-sin-logs>Trampa 2: Container que muere sin logs<a class=headerlink href=#trampa-2-container-que-muere-sin-logs title="Permanent link">&para;</a></h3> <p><strong>SÃ­ntoma</strong>: Container se ejecuta y muere inmediatamente, sin output.</p> <p><strong>Causa raÃ­z</strong>: Python bufferea stdout por defecto.</p> <p><strong>SoluciÃ³n</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONUNBUFFERED</span><span class=o>=</span><span class=m>1</span>
</code></pre></div></p> <hr> <h3 id=trampa-3-imagen-docker-gigante-2gb>Trampa 3: Imagen Docker gigante (2GB+)<a class=headerlink href=#trampa-3-imagen-docker-gigante-2gb title="Permanent link">&para;</a></h3> <p><strong>SÃ­ntoma</strong>: <code>docker images</code> muestra 2.3GB.</p> <p><strong>SoluciÃ³n</strong>: <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=c># 1. Base slim</span>
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w>  </span><span class=c># 150MB vs 900MB</span>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a>
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=c># 2. Multi-stage</span>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s>builder</span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>wheel<span class=w> </span>-r<span class=w> </span>requirements.txt<span class=w> </span>-w<span class=w> </span>/wheels
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s>runtime</span>
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>/wheels<span class=w> </span>/wheels
<a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>/wheels/*.whl<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/wheels
</code></pre></div></p> <hr> <h2 id=quiz-del-modulo-semanas-17-18>ğŸ“ Quiz del MÃ³dulo â€” Semanas 17-18<a class=headerlink href=#quiz-del-modulo-semanas-17-18 title="Permanent link">&para;</a></h2> <h3 id=quiz-semana-17-docker>Quiz Semana 17: Docker<a class=headerlink href=#quiz-semana-17-docker title="Permanent link">&para;</a></h3> <h4 id=pregunta-1-25-pts>Pregunta 1 (25 pts)<a class=headerlink href=#pregunta-1-25-pts title="Permanent link">&para;</a></h4> <p>Â¿Por quÃ© usas multi-stage builds en el Dockerfile?</p> <details> <summary>âœ… Respuesta</summary> Multi-stage separa **construcciÃ³n** de **ejecuciÃ³n**: - Stage 1 (builder): Tiene compiladores, herramientas (~900MB) - Stage 2 (runtime): Solo lo necesario (~150MB) **Resultado**: De ~2GB a ~300MB, menor superficie de ataque. </details> <h4 id=pregunta-2-25-pts>Pregunta 2 (25 pts)<a class=headerlink href=#pregunta-2-25-pts title="Permanent link">&para;</a></h4> <p>Â¿Por quÃ© creas un usuario no-root en el Dockerfile?</p> <details> <summary>âœ… Respuesta</summary> Ejecutar como root es un **riesgo de seguridad**: - Si un atacante escapa del container, tiene root en el host - Vulnerabilidades en dependencias pueden ser explotadas <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=k>RUN</span><span class=w> </span>useradd<span class=w> </span>--create-home<span class=w> </span>appuser
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=k>USER</span><span class=w> </span><span class=s>appuser</span>
</code></pre></div> </details> <h4 id=pregunta-3-25-pts>Pregunta 3 (25 pts)<a class=headerlink href=#pregunta-3-25-pts title="Permanent link">&para;</a></h4> <p>Â¿CÃ³mo manejas el caching de dependencias en Docker?</p> <details> <summary>âœ… Respuesta</summary> **Orden de capas importa**. Docker cachea cada capa; si una cambia, invalida las siguientes. <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=c># âœ… BUENO: requirements rara vez cambia</span>
<a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>/app/
<a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
<a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=c># Esta capa se cachea si requirements no cambiÃ³</span>
<a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a>
<a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>/app<span class=w>  </span>#<span class=w> </span>Esta<span class=w> </span>capa<span class=w> </span>cambia<span class=w> </span>frecuentemente
</code></pre></div> </details> <h4 id=ejercicio-practico-25-pts>ğŸ”§ Ejercicio PrÃ¡ctico (25 pts)<a class=headerlink href=#ejercicio-practico-25-pts title="Permanent link">&para;</a></h4> <p>Escribe un Dockerfile multi-stage para una app FastAPI con usuario no-root.</p> <details> <summary>âœ… SoluciÃ³n</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s>builder</span>
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
<a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>wheel<span class=w> </span>--no-cache-dir<span class=w> </span>-r<span class=w> </span>requirements.txt<span class=w> </span>-w<span class=w> </span>/wheels
<a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a>
<a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.11-slim</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s>runtime</span>
<a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
<a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a>
<a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a><span class=k>RUN</span><span class=w> </span>useradd<span class=w> </span>--create-home<span class=w> </span>appuser
<a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>/wheels<span class=w> </span>/wheels
<a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>--no-cache<span class=w> </span>/wheels/*.whl<span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span>rm<span class=w> </span>-rf<span class=w> </span>/wheels
<a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a>
<a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a><span class=k>COPY</span><span class=w> </span>--chown<span class=o>=</span>appuser:appuser<span class=w> </span>.<span class=w> </span>.
<a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a><span class=k>USER</span><span class=w> </span><span class=s>appuser</span>
<a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a>
<a id=__codelineno-62-16 name=__codelineno-62-16 href=#__codelineno-62-16></a><span class=k>ENV</span><span class=w> </span><span class=nv>PYTHONUNBUFFERED</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-62-17 name=__codelineno-62-17 href=#__codelineno-62-17></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>8000</span>
<a id=__codelineno-62-18 name=__codelineno-62-18 href=#__codelineno-62-18></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;uvicorn&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.main:app&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--host&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0.0.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;--port&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;8000&quot;</span><span class=p>]</span>
</code></pre></div> </details> <hr> <div align=center> **Siguiente mÃ³dulo** â†’ [14. FastAPI](14_FASTAPI.md) --- [â† Volver al Ãndice](00_INDICE.md) </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Volver al principio </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 DuqueOM â€” GuÃ­a MLOps v2 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/DuqueOM target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/duqueom target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>